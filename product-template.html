<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Name - Mobile Gaming Store</title>
    <meta
      name="description"
      content="Professional gaming gear for mobile gamers. High-quality controllers, cooling fans, and accessories."
    />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Product Name - Mobile Gaming Store" />
    <meta
      property="og:description"
      content="Professional gaming gear for mobile gamers"
    />
    <meta property="og:image" content="product-image-url" />
    <meta property="og:url" content="https://yourstore.com/product" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico" />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
        color: #ffffff;
        line-height: 1.6;
        overflow-x: hidden;
        padding-top: 80px; /* Account for fixed navbar */
      }

      @keyframes fadeInLogo {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Navbar Styles from Index */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(10px);
        padding: 15px 40px;
        z-index: 1000;
        border-bottom: 1px solid #333;
        transition: all 0.3s ease;
      }

      .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
      }

      .navbar.hidden {
        transform: translateY(-100%);
      }

      .nav-logo a {
        font-size: 1.8rem;
        font-weight: 800;
        color: #25d366;
        text-decoration: none;
        animation: fadeInLogo 1s ease forwards;
      }

      .nav-logo a:hover {
        color: #128c7e;
      }





      .search-container {
        position: relative;
        flex: 1;
        max-width: 500px;
        margin: 0 40px;
      }

      .search-input {
        width: 100%;
        padding: 12px 20px 12px 50px;
        background: #222;
        border: 2px solid #333;
        border-radius: 25px;
        color: #fff;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #25d366;
        background: #2a2a2a;
        box-shadow: 0 0 20px rgba(37, 211, 102, 0.3);
      }

      .search-icon {
        position: absolute;
        left: 18px;
        top: 50%;
        transform: translateY(-50%);
        color: #aaa;
        font-size: 18px;
        transition: all 0.3s ease;
      }

      .search-btn {
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #25d366, #128c7e);
        border: none;
        color: white;
        padding: 8px 12px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .search-btn:hover {
        background: linear-gradient(135deg, #128c7e, #25d366);
        transform: translateY(-50%) scale(1.1);
      }

      .search-input:focus + .search-btn {
        background: linear-gradient(135deg, #128c7e, #25d366);
      }

      /* Advanced Search Suggestions */
      .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #1c1c1c;
        border: 1px solid #333;
        border-radius: 10px;
        margin-top: 5px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1002;
        display: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .search-suggestion-item {
        padding: 12px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.2s ease;
        border-bottom: 1px solid #333;
      }

      .search-suggestion-item:hover {
        background: #333;
        color: #25d366;
      }

      .search-suggestion-item:last-child {
        border-bottom: none;
      }

      .suggestion-icon {
        width: 20px;
        text-align: center;
        color: #25d366;
      }

      .nav-menu {
        display: flex;
        gap: 30px;
        align-items: center;
        list-style: none;
      }

      .nav-menu a {
        color: #fff;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
        animation: fadeInNav 0.8s ease-in-out forwards;
      }

      .nav-menu a:hover {
        color: #25d366;
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .nav-actions .nav-btn {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: #1a1a2e;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        white-space: nowrap;
      }

      .nav-actions .nav-btn:hover {
        background: linear-gradient(135deg, #128c7e, #25d366);
        color: #fff;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
      }

      .login-btn {
        background: transparent !important;
        color: #25d366 !important;
        border: 1px solid #25d366;
      }

      .login-btn:hover {
        background: #25d366 !important;
        color: #1a1a2e !important;
      }

      .cart-btn {
        position: relative;
        background: linear-gradient(135deg, #25d366, #128c7e) !important;
        color: #1a1a2e !important;
      }

      .cart-count {
        background: #ff4757;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 11px;
        font-weight: 700;
        position: absolute;
        top: -6px;
        right: -6px;
        min-width: 16px;
        height: 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #1a1a2e;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Voice Command Animation */
      @keyframes listening {
        0% {
          box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
        }
      }

      .dropdown {
        position: relative;
        display: inline-block;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background-color: #1c1c1c;
        min-width: 200px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 10px 0;
        z-index: 1001;
        border: 1px solid #333;
      }

      .dropdown:hover .dropdown-content {
        display: block;
        animation: dropdownFade 0.3s ease;
      }

      /* Help Dropdown Styles */
      .help-btn {
        background: linear-gradient(135deg, #667eea, #764ba2) !important;
        color: white !important;
        border: none !important;
      }

      .help-btn:hover {
        background: linear-gradient(135deg, #764ba2, #667eea) !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .help-dropdown {
        min-width: 280px;
        padding: 15px;
        background: linear-gradient(135deg, #1c1c1c, #2a2a2a);
        border: 1px solid #333;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
      }

      .help-section {
        margin-bottom: 20px;
      }

      .help-section:last-child {
        margin-bottom: 0;
      }

      .help-section h4 {
        color: #25d366;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .help-item {
        width: 100%;
        background: transparent;
        border: none;
        color: white;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s ease;
        text-align: left;
        font-size: 14px;
        position: relative;
      }

      .help-item:hover {
        background: rgba(37, 211, 102, 0.1);
        color: #25d366;
        transform: translateX(5px);
      }

      .help-item i {
        width: 20px;
        text-align: center;
        font-size: 16px;
      }

      .help-item .compare-badge {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: #ff4757;
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 11px;
        display: none;
        align-items: center;
        justify-content: center;
        font-weight: bold;
      }

      .dropdown-content a {
        color: white;
        padding: 12px 20px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
        transition: background-color 0.3s ease;
      }

      .dropdown-content a:hover {
        background-color: #333;
        color: #25d366;
      }

      .dropdown-content a i {
        width: 16px;
        text-align: center;
      }

      /* Mobile Bottom Navbar Styles */
      .mobile-bottom-navbar {
        display: none;
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        top: auto;
        width: 100%;
        height: 60px;
        min-height: 60px;
        max-height: 60px;
        padding: 0;
        font-size: 0.7rem;
        z-index: 3001;
        border-top: 1px solid #333;
        background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
      }

      .mobile-bottom-navbar .nav-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        height: 100%;
        padding: 0 12px;
      }

      .mobile-bottom-navbar .nav-item {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        position: relative;
        padding: 0 4px;
        min-width: 0;
      }

      .mobile-bottom-navbar .nav-link {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 3px;
        color: #999;
        text-decoration: none;
        font-size: 0.65rem;
        font-weight: 500;
        padding: 6px 4px;
        border-radius: 8px;
        transition: all 0.2s ease;
        width: 100%;
        height: 100%;
        position: relative;
      }

      .mobile-bottom-navbar .nav-link:hover,
      .mobile-bottom-navbar .nav-link.active {
        color: #25d366;
        background: rgba(37, 211, 102, 0.1);
        transform: translateY(-1px);
      }

      .mobile-bottom-navbar .nav-link i {
        font-size: 1.2rem;
        margin-bottom: 2px;
        transition: all 0.2s ease;
      }

      .mobile-bottom-navbar .nav-link:hover i {
        transform: scale(1.1);
      }

      .mobile-bottom-navbar .nav-link span {
        font-size: 0.6rem;
        line-height: 1;
        font-weight: 500;
        letter-spacing: 0.2px;
      }

      .mobile-bottom-navbar .cart-link {
        position: relative;
      }

      .mobile-bottom-navbar .cart-count,
      .mobile-bottom-navbar .message-count {
        position: absolute;
        top: 4px;
        right: 4px;
        background: linear-gradient(135deg, #ff4757, #ff3742);
        color: white;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.55rem;
        font-weight: 700;
        border: 2px solid #1a1a1a;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .mobile-bottom-navbar .user-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
      }

      /* Enhanced dropdown menus */
      .mobile-bottom-navbar .mobile-categories-dropup-menu,
      .mobile-bottom-navbar .mobile-messages-dropup-menu {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
        border: 1px solid #333;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 8px;
        min-width: 180px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .mobile-bottom-navbar .mobile-categories-dropup-menu a,
      .mobile-bottom-navbar .mobile-messages-dropup-menu a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        color: #ccc;
        text-decoration: none;
        border-radius: 6px;
        transition: all 0.2s ease;
        font-size: 0.8rem;
      }

      .mobile-bottom-navbar .mobile-categories-dropup-menu a:hover,
      .mobile-bottom-navbar .mobile-messages-dropup-menu a:hover {
        background: rgba(37, 211, 102, 0.1);
        color: #25d366;
      }

      /* Mobile Messages Specific Styles */
      .mobile-messages-dropup-menu {
        max-height: 400px;
        overflow-y: auto;
        min-width: 280px !important;
        max-width: 320px !important;
      }

      .mobile-messages-dropup-menu .message-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid #333;
      }

      .mobile-messages-dropup-menu .message-header h4 {
        color: #25d366;
        margin: 0;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .mobile-messages-dropup-menu .mark-all-read {
        background: none;
        border: none;
        color: #25d366;
        font-size: 0.7rem;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .mobile-messages-dropup-menu .mark-all-read:hover {
        background: rgba(37, 211, 102, 0.1);
      }

      .mobile-messages-dropup-menu .message-list {
        max-height: 280px;
        overflow-y: auto;
      }

      .mobile-messages-dropup-menu .message-item {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
      }

      .mobile-messages-dropup-menu .message-item:hover {
        background: rgba(37, 211, 102, 0.05);
      }

      .mobile-messages-dropup-menu .message-item.unread {
        background: rgba(37, 211, 102, 0.1);
        border-left-color: #25d366;
      }

      .mobile-messages-dropup-menu .message-icon {
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #25d366;
        font-size: 0.8rem;
      }

      .mobile-messages-dropup-menu .message-content {
        flex: 1;
        min-width: 0;
      }

      .mobile-messages-dropup-menu .message-title {
        color: #fff;
        font-weight: 600;
        font-size: 0.8rem;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .mobile-messages-dropup-menu .message-text {
        color: #ccc;
        font-size: 0.75rem;
        line-height: 1.3;
        margin-bottom: 4px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .mobile-messages-dropup-menu .message-time {
        color: #666;
        font-size: 0.7rem;
      }

      .mobile-messages-dropup-menu .message-footer {
        margin-top: 10px;
        padding-top: 8px;
        border-top: 1px solid #333;
        text-align: center;
      }

      .mobile-messages-dropup-menu .view-all-messages {
        color: #25d366;
        text-decoration: none;
        font-size: 0.8rem;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .mobile-messages-dropup-menu .view-all-messages:hover {
        color: #128c7e;
      }

      /* Mobile responsive navbar display */
      @media (max-width: 768px) {
        .navbar {
          display: none !important;
        }

        .mobile-bottom-navbar {
          display: flex !important;
        }

        body {
          padding-bottom: 70px !important;
        }
        
        /* Hide product description on mobile to reduce padding */
        .product-description {
          display: none;
        }
        
        /* Reduce padding on mobile for better space utilization */
        .product-container {
          padding: 20px 15px;
        }
        
        .product-info {
          padding: 15px 0;
        }
        

      }

      @media (min-width: 769px) {
        .mobile-bottom-navbar {
          display: none !important;
        }

        .navbar {
          display: block !important;
        }
      }

      /* User skeleton loading */
      @keyframes pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.6;
        }
      }

      .user-skeleton {
        background: #222;
        border-radius: 50%;
        width: 38px;
        height: 38px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        animation: pulse 1.2s infinite;
        position: relative;
      }

      .user-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #25d366;
        border-top: 3px solid #fff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Breadcrumb */
      .breadcrumb {
        padding: 120px 20px 20px;
        background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .breadcrumb-container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .breadcrumb a {
        color: #25d366;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .breadcrumb a:hover {
        color: #128c7e;
      }

      .breadcrumb span {
        color: #999;
        margin: 0 10px;
      }

      /* Main Product Container */
      .product-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 80px;
        align-items: start;
      }

      /* Dark Theme Product Images */
      .product-images {
        position: sticky;
        top: 100px;
        max-width: 100%;
      }

      .image-gallery {
        position: relative;
        background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .main-image-container {
        position: relative;
        width: 100%;
        height: 400px;
        background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .main-image {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        transition: transform 0.3s ease;
        cursor: zoom-in;
        user-select: none;
      }

      .main-image:hover {
        transform: scale(1.05);
      }

      .main-image.zoomed {
        transform: scale(1.5);
        cursor: zoom-out;
      }

      .main-image-container.zoomed {
        overflow: visible;
        z-index: 1000;
      }

      .image-overlay {
        position: absolute;
        top: 15px;
        right: 15px;
        display: flex;
        gap: 8px;
      }

      .image-btn {
        background: rgba(37, 211, 102, 0.8);
        border: none;
        color: white;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .image-btn:hover {
        background: rgba(37, 211, 102, 1);
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
      }

      /* Dark Theme Thumbnail Grid */
      .thumbnail-grid {
        display: flex;
        gap: 8px;
        padding: 15px;
        background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .thumbnail-grid::-webkit-scrollbar {
        display: none;
      }

      .thumbnail {
        min-width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        opacity: 0.7;
        background: rgba(255, 255, 255, 0.05);
      }

      .thumbnail:hover {
        opacity: 1;
        border-color: #25d366;
        transform: scale(1.05);
        box-shadow: 0 2px 10px rgba(37, 211, 102, 0.3);
      }

      .thumbnail.active {
        opacity: 1;
        border-color: #25d366;
        box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.3);
        background: rgba(37, 211, 102, 0.1);
      }

      /* Dark Theme Carousel */
      .image-carousel {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      }

      .carousel-container {
        display: flex;
        transition: transform 0.4s ease;
      }

      .carousel-slide {
        min-width: 100%;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 400px;
        background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      }

      .carousel-slide img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .carousel-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(37, 211, 102, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        font-size: 16px;
      }

      .carousel-nav:hover {
        background: rgba(37, 211, 102, 1);
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
      }

      .carousel-prev {
        left: 15px;
      }

      .carousel-next {
        right: 15px;
      }

      .carousel-indicators {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 6px;
        z-index: 10;
        background: rgba(0, 0, 0, 0.7);
        padding: 8px 12px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .carousel-indicator {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .carousel-indicator.active {
        background: #25d366;
        transform: scale(1.2);
        box-shadow: 0 0 8px rgba(37, 211, 102, 0.6);
      }

      /* Lightbox Styles */
      .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 9999;
        display: none;
        justify-content: center;
        align-items: center;
      }

      .lightbox.active {
        display: flex;
      }

      .lightbox-content {
        position: relative;
        max-width: 90%;
        max-height: 90%;
      }

      .lightbox-image {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
      }

      .lightbox-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 8px;
      }

      .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(37, 211, 102, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        font-size: 18px;
        transition: background 0.3s ease;
      }

      .lightbox-nav:hover {
        background: rgba(37, 211, 102, 1);
      }

      .lightbox-prev {
        left: 20px;
      }

      .lightbox-next {
        right: 20px;
      }

      /* Loading States */
      .image-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 500px;
        background: #1a1a1a;
        border-radius: 20px;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #333;
        border-top: 4px solid #25d366;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Mobile Optimizations */
      @media (max-width: 768px) {
        .product-container {
          display: block;
          gap: 30px;
        }

        .product-images {
          position: static;
          margin-bottom: 25px;
        }

        .main-image-container {
          height: 280px;
        }

        .carousel-slide {
          height: 280px;
        }

        .thumbnail-grid {
          padding: 8px;
          gap: 6px;
        }

        .thumbnail {
          min-width: 45px;
          height: 45px;
        }

        .carousel-nav {
          width: 32px;
          height: 32px;
          font-size: 12px;
        }

        .carousel-prev {
          left: 8px;
        }

        .carousel-next {
          right: 8px;
        }

        .carousel-indicators {
          bottom: 10px;
          padding: 6px 10px;
        }

        .carousel-indicator {
          width: 5px;
          height: 5px;
        }

        .lightbox-nav {
          width: 36px;
          height: 36px;
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        .main-image-container {
          height: 250px;
        }

        .carousel-slide {
          height: 250px;
        }

        .thumbnail {
          min-width: 40px;
          height: 40px;
        }

        .carousel-nav {
          width: 28px;
          height: 28px;
          font-size: 10px;
        }

        .image-overlay {
          top: 10px;
          right: 10px;
          gap: 6px;
        }

        .image-btn {
          width: 30px;
          height: 30px;
          padding: 6px;
        }
      }

      /* Product Info */
      .product-info {
        padding: 20px 0;
      }

      .product-category {
        color: #25d366;
        font-weight: 600;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      .product-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 15px;
        line-height: 1.2;
      }

      .product-rating {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
      }

      .stars {
        color: #ffd700;
        font-size: 1.2rem;
      }

      .rating-count {
        color: #999;
        font-size: 0.9rem;
      }

      .rating-link {
        color: #25d366;
        text-decoration: none;
        font-size: 0.9rem;
      }

      /* Pricing */
      .product-price {
        margin-bottom: 30px;
      }

      .price-container {
        display: flex;
        align-items: baseline;
        gap: 15px;
        margin-bottom: 10px;
      }

      .current-price {
        font-size: 2.5rem;
        font-weight: 800;
        color: #25d366;
      }

      .original-price {
        font-size: 1.5rem;
        color: #999;
        text-decoration: line-through;
      }

      .savings {
        background: linear-gradient(135deg, #ff4757, #ff3742);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .price-note {
        color: #999;
        font-size: 0.9rem;
        margin-top: 10px;
      }

      /* Product Options */
      .product-options {
        margin-bottom: 30px;
      }

      .option-group {
        margin-bottom: 20px;
      }

      .option-label {
        font-weight: 600;
        margin-bottom: 10px;
        display: block;
      }

      .option-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .option-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .option-btn:hover,
      .option-btn.selected {
        background: rgba(37, 211, 102, 0.2);
        border-color: #25d366;
        color: #25d366;
      }

      /* Quantity & Add to Cart */
      .quantity-section {
        margin-bottom: 30px;
      }

      .quantity-container {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      .quantity-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.2rem;
      }

      .quantity-btn:hover {
        background: rgba(37, 211, 102, 0.2);
        border-color: #25d366;
      }

      .quantity-input {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        width: 60px;
        height: 40px;
        border-radius: 8px;
        text-align: center;
        font-size: 1rem;
        font-weight: 600;
      }

      .quantity-input:focus {
        outline: none;
        border-color: #25d366;
      }

      .stock-status {
        color: #25d366;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .stock-status.low {
        color: #ffa500;
      }

      .stock-status.out {
        color: #ff4757;
      }

      /* Action Buttons */
      .action-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 15px 20px;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }

      /* Product Details */
      .product-details {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .details-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 20px;
        color: #25d366;
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .detail-item:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: #999;
        font-weight: 500;
      }

      .detail-value {
        color: white;
        font-weight: 600;
      }

      /* Description */
      .product-description {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .description-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: #25d366;
      }

      .description-text {
        color: #ccc;
        line-height: 1.8;
        margin-bottom: 20px;
      }

      .features-list {
        list-style: none;
        margin-top: 20px;
      }

      .features-list li {
        padding: 8px 0;
        color: #ccc;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .features-list li::before {
        content: "âœ“";
        color: #25d366;
        font-weight: bold;
      }

      /* Reviews Section */
      .reviews-section {
        margin-top: 60px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 30px;
      }

      .reviews-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .reviews-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #25d366;
      }

      .write-review-btn {
        background: rgba(37, 211, 102, 0.2);
        border: 1px solid #25d366;
        color: #25d366;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .write-review-btn:hover {
        background: #25d366;
        color: white;
      }

      .review-item {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 20px 0;
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .reviewer-name {
        font-weight: 600;
        color: #25d366;
      }

      .review-date {
        color: #999;
        font-size: 0.9rem;
      }

      .review-rating {
        color: #ffd700;
        margin-bottom: 10px;
      }

      .review-text {
        color: #ccc;
        line-height: 1.6;
      }

      /* Related Products */
      .related-products {
        margin-top: 60px;
        padding: 0 20px;
      }

      .related-products .product-container {
        display: block;
        grid-template-columns: none;
        gap: 0;
        padding: 0;
      }

      .related-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 30px;
        color: #25d366;
        text-align: center;
        position: relative;
      }

      .related-title::after {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #25d366, #1ed760);
        border-radius: 2px;
      }

      .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .related-item {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.05),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 20px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .related-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(37, 211, 102, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .related-item:hover {
        transform: translateY(-8px) scale(1.02);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        border-color: rgba(37, 211, 102, 0.3);
        box-shadow: 0 15px 35px rgba(37, 211, 102, 0.2);
      }

      .related-item:hover::before {
        left: 100%;
      }

      .related-image {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 15px;
        margin-bottom: 15px;
        transition: transform 0.3s ease;
        cursor: pointer;
      }

      .related-item:hover .related-image {
        transform: scale(1.05);
      }

      .related-name {
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .related-name:hover {
        color: #25d366;
      }

      .add-to-cart-btn-small {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 8px;
        width: 100%;
      }

      .add-to-cart-btn-small:hover {
        background: linear-gradient(135deg, #128c7e, #25d366);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
      }

      .related-name {
        font-weight: 600;
        margin-bottom: 12px;
        color: white;
        font-size: 1.1rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .related-price {
        color: #25d366;
        font-weight: 700;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .related-price::before {
        content: "ðŸ’°";
        font-size: 1rem;
      }

      /* Loading state for related products */
      .related-grid.loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .related-grid.loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid rgba(37, 211, 102, 0.3);
        border-top: 3px solid #25d366;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }

      /* Focus styles for accessibility */
      .related-item:focus {
        outline: 2px solid #25d366;
        outline-offset: 2px;
      }

      .related-item:focus:not(:focus-visible) {
        outline: none;
      }

      /* Empty state */
      .related-grid:empty::before {
        content: "No related products available";
        display: block;
        text-align: center;
        color: #999;
        font-style: italic;
        padding: 40px 20px;
        grid-column: 1 / -1;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .product-container {
          grid-template-columns: 1fr;
          gap: 30px;
          padding: 15px;
        }

        .product-images {
          position: static;
        }

        .product-title {
          font-size: 1.8rem;
        }

        .current-price {
          font-size: 1.8rem;
        }

        .action-buttons {
          flex-direction: column;
          gap: 12px;
        }

        .thumbnail-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .nav-container {
          padding: 0 15px;
        }

        .search-container {
          margin: 0 15px;
          max-width: 200px;
        }

        .search-input {
          font-size: 14px;
          padding: 10px 15px 10px 40px;
        }

        .nav-actions {
          gap: 10px;
        }

        .nav-btn {
          padding: 6px 12px;
          font-size: 0.8rem;
        }

        .nav-logo a {
          font-size: 1.4rem;
        }

        .nav-logo i {
          font-size: 1.6rem;
        }

        /* Product details mobile adjustments */
        .product-details,
        .product-description {
          padding: 20px;
        }

        .details-title,
        .description-title {
          font-size: 1.2rem;
        }

        .option-buttons {
          gap: 8px;
        }

        .option-btn {
          padding: 8px 16px;
          font-size: 0.9rem;
        }

        .quantity-container {
          gap: 12px;
        }

        .quantity-btn {
          width: 36px;
          height: 36px;
          font-size: 1.1rem;
        }

        .quantity-input {
          width: 50px;
          height: 36px;
        }

        /* Reviews mobile adjustments */
        .reviews-section {
          margin-top: 40px;
          padding: 20px;
        }

        .reviews-title {
          font-size: 1.3rem;
        }

        /* Related products mobile adjustments */
        .related-products {
          margin-top: 40px;
          padding: 0 15px;
        }

        .related-title {
          font-size: 1.6rem;
          margin-bottom: 25px;
        }

        .related-title::after {
          width: 50px;
          height: 2px;
          bottom: -8px;
        }

        .related-grid {
          grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
          gap: 20px;
        }

        .related-item {
          padding: 18px;
          border-radius: 18px;
        }

        .related-image {
          height: 160px;
          border-radius: 12px;
        }

        .related-name {
          font-size: 1rem;
          margin-bottom: 10px;
        }

        .related-price {
          font-size: 1.1rem;
        }
      }

      /* Mobile Bottom Navbar */
      @media (max-width: 480px) {
        .product-container {
          padding: 10px;
          gap: 20px;
        }

        .product-title {
          font-size: 1.5rem;
        }

        .current-price {
          font-size: 1.5rem;
        }

        .original-price {
          font-size: 1.2rem;
        }

        .product-category {
          font-size: 0.8rem;
        }

        .product-rating {
          flex-wrap: wrap;
          gap: 8px;
        }

        .stars {
          font-size: 1rem;
        }

        .rating-count,
        .rating-link {
          font-size: 0.8rem;
        }

        .option-buttons {
          gap: 6px;
        }

        .option-btn {
          padding: 6px 12px;
          font-size: 0.8rem;
        }

        .quantity-container {
          gap: 8px;
        }

        .quantity-btn {
          width: 32px;
          height: 32px;
          font-size: 1rem;
        }

        .quantity-input {
          width: 45px;
          height: 32px;
          font-size: 0.9rem;
        }

        .btn-primary,
        .btn-secondary {
          padding: 12px 20px;
          font-size: 1rem;
        }

        .product-details,
        .product-description {
          padding: 15px;
        }

        .details-title,
        .description-title {
          font-size: 1.1rem;
        }

        .detail-item {
          padding: 8px 0;
          font-size: 0.9rem;
        }

        .reviews-section {
          margin-top: 30px;
          padding: 15px;
        }

        .reviews-title {
          font-size: 1.2rem;
        }

        .write-review-btn {
          padding: 8px 16px;
          font-size: 0.9rem;
        }

        .related-products {
          margin-top: 30px;
          padding: 0 10px;
        }

        .related-title {
          font-size: 1.4rem;
          margin-bottom: 20px;
        }

        .related-title::after {
          width: 40px;
          height: 2px;
          bottom: -6px;
        }

        .related-grid {
          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
          gap: 15px;
        }

        .related-item {
          padding: 15px;
          border-radius: 15px;
        }

        .related-item:hover {
          transform: translateY(-5px) scale(1.01);
        }

        .related-image {
          height: 140px;
          border-radius: 10px;
        }

        .related-name {
          font-size: 0.9rem;
          margin-bottom: 8px;
          -webkit-line-clamp: 2;
        }

        .related-price {
          font-size: 1rem;
        }

        .related-price::before {
          font-size: 0.9rem;
        }

        /* Navbar adjustments for very small screens */
        .navbar {
          padding: 10px 15px;
        }

        .search-container {
          max-width: 150px;
          margin: 0 10px;
        }

        .search-input {
          font-size: 12px;
          padding: 8px 12px 8px 35px;
        }

        .nav-actions {
          gap: 8px;
        }

        .nav-btn {
          padding: 5px 10px;
          font-size: 0.7rem;
        }

        .nav-logo a {
          font-size: 1.2rem;
        }

        .nav-logo i {
          font-size: 1.4rem;
        }

        /* Hide some navbar elements on very small screens */
        .voice-btn {
          display: none;
        }

        .compare-btn {
          display: none;
        }

        .help-btn {
          display: none;
        }

        .mobile-bottom-navbar {
          display: none;
          position: fixed;
          left: 0;
          right: 0;
          bottom: 0;
          top: auto;
          width: 100%;
          height: 60px;
          min-height: 60px;
          max-height: 60px;
          padding: 0;
          font-size: 0.7rem;
          z-index: 3001;
          border-top: 1px solid #333;
          background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
          box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
          backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
          .mobile-bottom-navbar {
            display: flex !important;
          }

          body {
            padding-bottom: 80px !important;
          }
        }

        .mobile-bottom-navbar .nav-container {
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          height: 100%;
          padding: 0 12px;
        }

        .mobile-bottom-navbar .nav-item {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          height: 100%;
          position: relative;
          padding: 0 2px;
          color: #999;
          text-decoration: none;
          font-size: 0.65rem;
          font-weight: 500;
          transition: all 0.2s ease;
        }

        .mobile-bottom-navbar .nav-item:hover,
        .mobile-bottom-navbar .nav-item.active {
          color: #25d366;
          background: rgba(37, 211, 102, 0.1);
          transform: translateY(-1px);
        }

        .mobile-bottom-navbar .nav-item i {
          font-size: 1.2rem;
          margin-bottom: 2px;
          transition: all 0.2s ease;
        }

        .mobile-bottom-navbar .nav-item:hover i {
          transform: scale(1.1);
        }

        .mobile-bottom-navbar .nav-item span {
          font-size: 0.6rem;
          line-height: 1;
          font-weight: 500;
          letter-spacing: 0.2px;
        }

        .mobile-bottom-navbar .cart-count {
          position: absolute;
          top: 4px;
          right: 4px;
          background: linear-gradient(135deg, #ff4757, #ff3742);
          color: white;
          border-radius: 50%;
          width: 16px;
          height: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.55rem;
          font-weight: 700;
          border: 2px solid #1a1a1a;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Enhanced nav-actions for better spacing */
        @media (max-width: 480px) {
          .mobile-bottom-navbar .nav-actions {
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
            justify-content: center !important;
            min-width: 0 !important;
            flex: 1 !important;
          }
          .mobile-bottom-navbar .nav-btn.cart-btn {
            position: relative !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 1.3rem !important;
            background: none !important;
            border: none !important;
            color: #25d366 !important;
            padding: 8px !important;
            border-radius: 8px !important;
            transition: all 0.2s ease !important;
          }
                  .mobile-bottom-navbar .cart-count {
          background: #ff4757 !important;
          color: white !important;
          border-radius: 50% !important;
          padding: 2px 6px !important;
          font-size: 0.8rem !important;
          font-weight: 700 !important;
          position: absolute !important;
          top: -6px !important;
          right: -6px !important;
          min-width: 16px !important;
          height: 16px !important;
          text-align: center !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          border: 2px solid #1a1a2e !important;
        }

        .mobile-bottom-navbar .message-count {
          background: #25d366 !important;
          color: white !important;
          border-radius: 50% !important;
          padding: 2px 6px !important;
          font-size: 0.7rem !important;
          font-weight: 700 !important;
          position: absolute !important;
          top: -6px !important;
          right: -6px !important;
          min-width: 16px !important;
          height: 16px !important;
          text-align: center !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          border: 2px solid #1a1a2e !important;
        }
          .mobile-bottom-navbar #user-area-mobile {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 100% !important;
            height: 100% !important;
            padding: 4px !important;
          }

          .mobile-bottom-navbar #user-area-mobile .user-avatar {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 32px !important;
            height: 32px !important;
            border-radius: 50% !important;
            background: #25d366 !important;
            color: #111 !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            text-decoration: none !important;
            transition: all 0.2s ease !important;
          }

          .mobile-bottom-navbar #user-area-mobile .login-btn {
            background: transparent !important;
            color: #999 !important;
            border: none !important;
            font-size: 0.65rem !important;
            padding: 4px 2px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            gap: 2px !important;
          }

          .mobile-bottom-navbar #user-area-mobile .login-btn:hover {
            color: #25d366 !important;
            background: transparent !important;
          }
        }

        /* Force hide main navbar on mobile */
        @media (max-width: 768px) {
          .navbar,
          .top-navbar,
          header nav {
            display: none !important;
          }

          .mobile-bottom-navbar {
            display: flex !important;
          }

          body {
            padding-bottom: 80px !important;
          }
        }

        /* Breadcrumb adjustments */
        .breadcrumb {
          padding: 100px 15px 15px;
        }

        .breadcrumb a,
        .breadcrumb span {
          font-size: 0.9rem;
        }

        /* Touch-friendly improvements */
        .main-image {
          height: 300px;
        }

        .thumbnail {
          height: 60px;
        }

        .image-btn {
          padding: 12px;
          font-size: 1.1rem;
        }

        /* User area styles for main navbar */
        #user-area {
          min-width: 110px;
          margin-left: 16px;
          display: flex;
          align-items: center;
          justify-content: flex-end;
        }

        .user-skeleton {
          background: #222;
          border-radius: 50%;
          width: 38px;
          height: 38px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          animation: pulse 1.2s infinite;
          position: relative;
        }

        .user-spinner {
          display: inline-block;
          width: 20px;
          height: 20px;
          border: 3px solid #25d366;
          border-top: 3px solid #fff;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
        }

        @keyframes pulse {
          0% {
            opacity: 0.6;
          }
          50% {
            opacity: 1;
          }
          100% {
            opacity: 0.6;
          }
        }

        /* Review improvements */
        .review-item {
          padding: 15px 0;
        }

        .review-header {
          margin-bottom: 8px;
        }

        .reviewer-name {
          font-size: 0.9rem;
        }

        .review-date {
          font-size: 0.8rem;
        }

        .review-text {
          font-size: 0.9rem;
          line-height: 1.6;
        }
      }

      /* Loading Animation */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #25d366;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Success/Error Messages */
      .message {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: 600;
      }

      .message.success {
        background: rgba(37, 211, 102, 0.2);
        border: 1px solid #25d366;
        color: #25d366;
      }

      .message.error {
        background: rgba(255, 71, 87, 0.2);
        border: 1px solid #ff4757;
        color: #ff4757;
      }

      .product-main.upgraded {
        max-width: 1200px;
        margin: 40px auto 60px;
        padding: 0 20px;
      }
      .product-details-upgraded {
        display: flex;
        flex-wrap: wrap;
        gap: 48px;
        background: linear-gradient(135deg, #181c1b 0%, #23272a 100%);
        border-radius: 32px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
        padding: 40px 32px;
        margin-bottom: 48px;
      }
      .product-image-gallery {
        flex: 1 1 350px;
        min-width: 320px;
        max-width: 480px;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }
      .main-image.upgraded {
        width: 100%;
        max-width: 420px;
        height: 420px;
        object-fit: cover;
        border-radius: 24px;
        box-shadow: 0 4px 24px rgba(37, 211, 102, 0.08);
        background: #111;
        margin-bottom: 18px;
        transition: transform 0.3s;
      }
      .main-image.upgraded:hover {
        transform: scale(1.04);
      }
      .image-thumbnails {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }
      .image-thumbnails img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 12px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: border 0.2s;
      }
      .image-thumbnails img.selected {
        border: 2px solid #25d366;
      }
      .discount-badge-upgraded {
        position: absolute;
        top: 18px;
        left: 18px;
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: #fff;
        padding: 8px 18px;
        border-radius: 18px;
        font-weight: 700;
        font-size: 1rem;
        box-shadow: 0 2px 8px rgba(37, 211, 102, 0.15);
        z-index: 2;
        display: none;
      }
      .stock-badge-upgraded {
        position: absolute;
        top: 18px;
        right: 18px;
        background: #ff4757;
        color: #fff;
        padding: 8px 18px;
        border-radius: 18px;
        font-weight: 700;
        font-size: 1rem;
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.15);
        z-index: 2;
        display: none;
      }
      .product-info-upgraded {
        flex: 2 1 400px;
        min-width: 320px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }
      .product-title-upgraded {
        font-size: 2.2rem;
        font-weight: 800;
        color: #25d366;
        margin-bottom: 8px;
      }
      .product-meta-upgraded {
        display: flex;
        gap: 18px;
        font-size: 1rem;
        color: #aaa;
      }
      .product-price-upgraded {
        display: flex;
        align-items: baseline;
        gap: 16px;
      }
      .original-price-upgraded {
        text-decoration: line-through;
        color: #888;
        font-size: 1.2rem;
      }
      .discount-price-upgraded {
        color: #25d366;
        font-size: 2rem;
        font-weight: 700;
      }
      .selectors-upgraded {
        display: flex;
        gap: 24px;
        margin: 12px 0;
      }
      .color-selector-upgraded,
      .size-selector-upgraded {
        display: flex;
        gap: 10px;
      }
      .option-btn {
        padding: 8px 18px;
        border-radius: 12px;
        border: 2px solid #333;
        background: #181c1b;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .option-btn.selected,
      .option-btn:hover {
        border-color: #25d366;
        background: #23272a;
        color: #25d366;
      }
      .quantity-add-upgraded {
        display: flex;
        align-items: center;
        gap: 24px;
        margin: 18px 0 0 0;
      }
      .quantity-selector-upgraded {
        display: flex;
        align-items: center;
        gap: 8px;
        background: #23272a;
        border-radius: 10px;
        padding: 6px 12px;
      }
      .qty-btn-upgraded {
        background: #181c1b;
        color: #25d366;
        border: none;
        font-size: 1.3rem;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .qty-btn-upgraded:hover {
        background: #25d366;
        color: #181c1b;
      }
      .qty-input-upgraded {
        width: 48px;
        text-align: center;
        font-size: 1.1rem;
        border: none;
        background: transparent;
        color: #fff;
      }
      .add-to-cart-btn-upgraded {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: #fff;
        border: none;
        padding: 16px 36px;
        border-radius: 14px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 2px 12px rgba(37, 211, 102, 0.1);
        display: flex;
        align-items: center;
        gap: 12px;
        transition: background 0.2s, transform 0.2s;
      }
      .add-to-cart-btn-upgraded:hover {
        background: linear-gradient(135deg, #128c7e, #25d366);
        transform: translateY(-2px) scale(1.03);
      }
      .add-to-cart-btn-upgraded:active {
        background: #25d366;
      }
      .product-description-upgraded {
        margin-top: 18px;
        color: #ccc;
        font-size: 1.1rem;
        line-height: 1.7;
      }
      .related-products-upgraded {
        margin-top: 48px;
      }
      .related-products-upgraded h2 {
        color: #25d366;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 18px;
      }
      .related-products-grid-upgraded {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 24px;
      }
      .related-product-card-upgraded {
        background: #181c1b;
        border-radius: 18px;
        box-shadow: 0 2px 12px rgba(37, 211, 102, 0.07);
        padding: 18px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .related-product-card-upgraded:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 8px 24px rgba(37, 211, 102, 0.13);
      }
      .related-product-image-upgraded {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 12px;
      }
      .related-product-title-upgraded {
        font-size: 1.1rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 6px;
        text-align: center;
      }
      .related-product-price-upgraded {
        color: #25d366;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 10px;
      }
      .related-add-btn-upgraded {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: #fff;
        border: none;
        padding: 8px 18px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s, transform 0.2s;
      }
      .related-add-btn-upgraded:hover {
        background: linear-gradient(135deg, #128c7e, #25d366);
        transform: scale(1.05);
      }
      @media (max-width: 900px) {
        .product-details-upgraded {
          flex-direction: column;
          align-items: stretch;
          padding: 24px 10px;
        }
        .main-image.upgraded {
          max-width: 100%;
          height: 320px;
        }
      }
      @media (max-width: 600px) {
        .product-main.upgraded {
          padding: 0 4px;
        }
        .product-details-upgraded {
          padding: 12px 2px;
          border-radius: 12px;
        }
        .main-image.upgraded {
          height: 200px;
          border-radius: 10px;
        }
        .product-title-upgraded {
          font-size: 1.3rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Unified Navbar Container -->
    <div id="navbar-container"></div>

    <!-- Mobile Bottom Navbar -->
    <nav class="mobile-bottom-navbar" id="mobile-bottom-navbar" style="display: none;">
      <div class="nav-container">
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="index.html" class="nav-link">
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
          </li>
          <li class="nav-item mobile-categories-dropup">
            <a href="#" class="nav-link" id="mobile-categories-btn">
              <i class="fas fa-th-large"></i>
              <span>Categories</span>
            </a>
            <div
              class="mobile-categories-dropup-menu"
              id="mobile-categories-dropup-menu"
            >
              <a href="category.html?cat=Controllers">
                <i class="fas fa-gamepad"></i>
                Controllers
              </a>
              <a href="category.html?cat=Triggers">
                <i class="fas fa-bullseye"></i>
                Triggers
              </a>
              <a href="category.html?cat=Holders">
                <i class="fas fa-mobile-alt"></i>
                Holders
              </a>
              <a href="category.html?cat=Cooling Fans">
                <i class="fas fa-fan"></i>
                Cooling Fans
              </a>
              <a href="category.html?cat=Joystick">
                <i class="fas fa-dot-circle"></i>
                Joystick
              </a>
              <a href="category.html?cat=Accessories">
                <i class="fas fa-headphones"></i>
                Accessories
              </a>
            </div>
          </li>

          <li class="nav-item mobile-messages-dropup">
            <a href="#" class="nav-link" id="mobile-messages-btn">
              <i class="fas fa-envelope"></i>
              <span>Messages</span>
              <span class="message-count" id="message-count-mobile"></span>
            </a>
            <div
              class="mobile-messages-dropup-menu"
              id="mobile-messages-dropup-menu"
            >
              <div class="message-header">
                <h4>Messages</h4>
                <button class="mark-all-read">Mark all read</button>
              </div>
              <div class="message-list" id="mobile-messages-list">
                <!-- Messages will be loaded here -->
              </div>
              <div class="message-footer">
                <a href="message-center.html" class="view-all-messages">View all messages</a>
              </div>
            </div>
          </li>
        </ul>
        <div class="nav-actions">
          <a href="cart.html" class="nav-btn cart-btn">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cart-count-mobile"></span>
          </a>
          <div id="user-area-mobile" class="user-link">
            <div class="user-skeleton">
              <span class="user-spinner"></span>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Load unified navbar component -->
    <script src="components/navbar-loader.js"></script>
    
    <script>
      // Mobile navbar visibility management
      function updateNavbarVisibility() {
        const mobileNavbar = document.getElementById('mobile-bottom-navbar');
        const desktopNavbar = document.querySelector('.navbar');
        
        if (window.innerWidth <= 768) {
          // Mobile view
          if (mobileNavbar) {
            mobileNavbar.style.display = 'flex';
          }
          if (desktopNavbar) {
            desktopNavbar.style.display = 'none';
          }
        } else {
          // Desktop view
          if (mobileNavbar) {
            mobileNavbar.style.display = 'none';
          }
          if (desktopNavbar) {
            desktopNavbar.style.display = 'flex';
          }
        }
      }
      
      // Update on load and resize
      document.addEventListener('DOMContentLoaded', updateNavbarVisibility);
      window.addEventListener('resize', updateNavbarVisibility);
    </script>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <div class="breadcrumb-container">
        <a href="index.html">Home</a>
        <span>></span>
        <a href="category.html" id="category-link">Category</a>
        <span>></span>
        <span id="product-name">Product Name</span>
      </div>
    </div>

    <!-- Main Product Container -->
    <div class="product-container">
      <!-- Product Images -->
      <div class="product-images">
        <div class="image-gallery">
          <div class="main-image-container">
            <img
              class="main-image"
              id="main-image"
              src=""
              alt="Product Image"
            />
            <div class="image-overlay">
              <button class="image-btn" onclick="openLightbox()">
                <i class="fas fa-expand"></i>
              </button>
              <button class="image-btn" onclick="shareProduct()">
                <i class="fas fa-share"></i>
              </button>
            </div>
          </div>

          <!-- Carousel for multiple images -->
          <div class="image-carousel" id="image-carousel" style="display: none">
            <div class="carousel-container" id="carousel-container">
              <!-- Carousel slides will be populated by JavaScript -->
            </div>
            <button
              class="carousel-nav carousel-prev"
              onclick="previousSlide()"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="carousel-nav carousel-next" onclick="nextSlide()">
              <i class="fas fa-chevron-right"></i>
            </button>
            <div class="carousel-indicators" id="carousel-indicators">
              <!-- Indicators will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <div class="thumbnail-grid" id="thumbnail-grid">
          <!-- Thumbnails will be loaded dynamically -->
        </div>
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <div class="product-category" id="product-category">Category</div>
        <h1 class="product-title" id="product-title">Product Name</h1>

        <div class="product-rating">
          <div class="stars" id="product-stars">â­â­â­â­â­</div>
          <span class="rating-count" id="rating-count">(0 reviews)</span>
          <a href="#reviews" class="rating-link">Write a review</a>
        </div>

        <div class="product-price" id="product-price">
          <div class="price-container">
            <span class="current-price" id="current-price">$0.00</span>
            <span
              class="original-price"
              id="original-price"
              style="display: none"
              >$0.00</span
            >
            <span class="savings" id="savings" style="display: none"
              >Save $0</span
            >
          </div>
          <div class="price-note">Free shipping on orders over $50</div>

          <!-- Temu-style info box -->
          <div class="temu-info-box" style="margin: 14px 0 12px 0; border: 1px solid #333; border-radius: 12px; background: #121417; color: #e5e7eb;">
            <div style="display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 10px; padding: 14px 14px 4px 14px;">
              <div style="display:flex; align-items:flex-start; gap:8px;">
                <i class="fas fa-shipping-fast" style="color:#25d366; margin-top:2px;"></i>
                <div>
                  <div style="font-weight:700;">Fastest delivery in 5 business days</div>
                  <div style="font-size:0.85rem; color:#9ca3af;">Min. order value: $10.00</div>
                </div>
              </div>
              <div style="display:flex; align-items:flex-start; gap:8px;">
                <i class="fas fa-lock" style="color:#25d366; margin-top:2px;"></i>
                <div>
                  <div style="font-weight:700;">Safe payments</div>
                  <div style="font-size:0.85rem; color:#9ca3af;">Secure privacy</div>
                </div>
              </div>
              <div style="display:flex; align-items:flex-start; gap:8px; cursor:pointer;" onclick="openOrderGuaranteeModal()">
                <i class="fas fa-shield-alt" style="color:#25d366; margin-top:2px;"></i>
                <div>
                  <div style="font-weight:700; color:#25d366;">Order guarantee</div>
                  <div style="font-size:0.85rem; color:#9ca3af;">Click to view details</div>
                </div>
              </div>
              <div style="display:flex; align-items:flex-start; gap:8px;">
                <i class="fas fa-box-open" style="color:#25d366; margin-top:2px;"></i>
                <div>
                  <div style="font-weight:700;">What's included</div>
                  <div style="font-size:0.85rem; color:#9ca3af;">See product details below</div>
                </div>
              </div>
            </div>
            <div style="display:flex; align-items:center; gap:8px; padding: 6px 14px 12px 14px; color:#9ca3af; font-size:0.85rem; border-top: 1px dashed #2a2f36; margin-top: 8px;">
              <i class="fas fa-globe" style="color:#25d366;"></i>
              <span>Sourced from trusted partners, procured by Mobile Gear Hub</span>
            </div>
          </div>
        </div>

        <!-- Quantity Section -->
        <div class="quantity-section">
          <div class="quantity-container">
            <label class="quantity-label">Quantity:</label>
            <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
            <input
              type="number"
              class="quantity-input"
              id="quantity"
              value="1"
              min="1"
              max="99"
            />
            <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
          </div>
          <div class="stock-status" id="stock-status">In Stock</div>
        </div>



        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-primary" id="add-to-cart-btn">
            <i class="fas fa-shopping-cart"></i>
            Add to Cart
          </button>
          <button class="btn-secondary" onclick="addToWishlist()">
            <i class="fas fa-heart"></i>
            Wishlist
          </button>
        </div>

        <!-- Product Details -->
        <div class="product-details">
          <h3 class="details-title">Product Details</h3>
          <div class="detail-item">
            <span class="detail-label">Brand:</span>
            <span class="detail-value" id="product-brand">Brand Name</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Model:</span>
            <span class="detail-value" id="product-model">Model Number</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Warranty:</span>
            <span class="detail-value">1 Year</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Shipping:</span>
            <span class="detail-value">Free on orders $50+</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Return Policy:</span>
            <span class="detail-value">30 Days</span>
          </div>
        </div>

        <!-- Product Description -->
        <div class="product-description">
          <h3 class="description-title">Description</h3>
          <p class="description-text" id="product-description">
            Professional gaming gear designed for mobile gamers. This product
            offers superior performance, comfort, and durability for extended
            gaming sessions.
          </p>
          <ul class="features-list" id="features-list">
            <li>High-quality materials</li>
            <li>Ergonomic design</li>
            <li>Compatible with all devices</li>
            <li>Long battery life</li>
            <li>Quick setup</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="reviews-section" id="reviews">
      <div class="reviews-header">
        <h3 class="reviews-title">Customer Reviews</h3>
      </div>
      <div id="reviews-container">
        <!-- Reviews will be loaded dynamically -->
      </div>
    </div>

    <!-- Related Products -->
    <section class="related-products">
      <div class="product-container">
        <h2 class="related-title">Related Products</h2>
        <div
          class="related-grid"
          id="related-products"
          role="grid"
          aria-label="Related products"
        >
          <!-- Related products will be loaded dynamically -->
        </div>
        
        <!-- Related Products Footer -->
        <div class="related-products-footer" style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 12px; text-align: center;">
          <h3 style="color: #25d366; margin: 0 0 15px 0; font-size: 1.2rem;">More Gaming Gear</h3>
          <p style="color: #ccc; margin: 0 0 20px 0; font-size: 0.95rem;">Discover more amazing products in our collection</p>
          <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <a href="category.html?cat=Controllers" style="background: rgba(37, 211, 102, 0.1); color: #25d366; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; border: 1px solid rgba(37, 211, 102, 0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(37, 211, 102, 0.2)'; this.style.borderColor='#25d366';" onmouseout="this.style.background='rgba(37, 211, 102, 0.1)'; this.style.borderColor='rgba(37, 211, 102, 0.3)';">
              ðŸŽ® Controllers
            </a>
            <a href="category.html?cat=Cooling Fans" style="background: rgba(37, 211, 102, 0.1); color: #25d366; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; border: 1px solid rgba(37, 211, 102, 0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(37, 211, 102, 0.2)'; this.style.borderColor='#25d366';" onmouseout="this.style.background='rgba(37, 211, 102, 0.1)'; this.style.borderColor='rgba(37, 211, 102, 0.3)';">
              â„ï¸ Cooling Fans
            </a>
            <a href="category.html?cat=Accessories" style="background: rgba(37, 211, 102, 0.1); color: #25d366; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; border: 1px solid rgba(37, 211, 102, 0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(37, 211, 102, 0.2)'; this.style.borderColor='#25d366';" onmouseout="this.style.background='rgba(37, 211, 102, 0.1)'; this.style.borderColor='rgba(37, 211, 102, 0.3)';">
              ðŸŽ§ Accessories
            </a>
            <a href="index.html" style="background: rgba(37, 211, 102, 0.1); color: #25d366; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; border: 1px solid rgba(37, 211, 102, 0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(37, 211, 102, 0.2)'; this.style.borderColor='#25d366';" onmouseout="this.style.background='rgba(37, 211, 102, 0.1)'; this.style.borderColor='rgba(37, 211, 102, 0.3)';">
              ðŸ  All Products
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer
      style="
        background: #0a0a0a;
        padding: 40px 20px;
        margin-top: 60px;
        text-align: center;
        color: #999;
      "
    >
      <p>&copy; 2024 Mobile Gaming Store. All rights reserved.</p>
    </footer>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

    <!-- Cart System -->
    <script src="assets/js/cart.js"></script>
    <script>
      // Verify cart.js loaded
      console.log("Cart.js loading check:");
      console.log("- window.addToCart:", typeof window.addToCart);
      console.log("- window.loadCart:", typeof window.loadCart);
      console.log("- window.cart:", window.cart);
    </script>

    <script>
      // Initialize cart system like homepage
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("Product Template: Initializing cart system...");
        


        // Initialize Supabase client
        const supabaseUrl = "https://kokntkhxkymllafuubun.supabase.co";
        const supabaseKey =
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtva250a2h4a3ltbGxhZnV1YnVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3NzYxODcsImV4cCI6MjA2ODM1MjE4N30.Ekc6HLszFSYTIgsvzTdKJWr85nFMUH2HQBQrg_uqXRc";

        console.log("Product Template: Creating Supabase client...");
        console.log("window.supabase available:", typeof window.supabase);

        let supabaseClient = null;
        if (window.supabase && typeof window.supabase.createClient === 'function') {
          supabaseClient = window.supabase.createClient(
          supabaseUrl,
          supabaseKey
        );
          window.supabaseClient = supabaseClient;
          window._ptSupabaseClient = supabaseClient;
          console.log("Product Template: Supabase client created:", typeof supabaseClient);
        } else if (window.supabaseClient) {
          supabaseClient = window.supabaseClient;
          window._ptSupabaseClient = supabaseClient;
          console.log("Product Template: Using existing Supabase client");
        } else {
          console.warn("Supabase SDK not ready; proceeding without client for now");
        }

        // Replace global assignment to avoid clobbering the SDK namespace
        window.supabaseClient = supabaseClient;
        window._ptSupabaseClient = supabaseClient;

        console.log(
          "Product Template: Supabase client created:",
          typeof supabaseClient
        );
        console.log(
          "Product Template: Supabase auth available:",
          typeof supabaseClient.auth
        );

        // Optimized user area update function
        let userUpdateTimeout = null;
        
        async function updateUserArea() {
          console.log("updateUserArea called from product-template.html");
          
          try {
          const {
            data: { user },
          } = await supabaseClient.auth.getUser();
          console.log(
            "User from product-template.html:",
            user ? user.email : "No user"
          );

            // Store user data globally for other functions to use
            window.currentUser = user;
            window.currentUserId = user ? user.id : null;

            // Clear any existing timeout
            if (userUpdateTimeout) {
              clearTimeout(userUpdateTimeout);
            }

            // Update user area with retry mechanism
            function attemptUserUpdate() {
          // Update desktop navbar
          const userNameElement = document.getElementById("user-name");
          const userProfileElement = document.getElementById("user-profile");
              const userAreaElement = document.getElementById("user-area");

          // Update mobile navbar
              const mobileUserNameElement = document.getElementById("mobile-user-name");
              const mobileUserProfileElement = document.getElementById("mobile-user-profile");
              const userAreaMobileElement = document.getElementById("user-area-mobile");

              // Check if any user elements exist
              const hasUserElements = userNameElement || userProfileElement || userAreaElement || 
                                    mobileUserNameElement || mobileUserProfileElement || userAreaMobileElement;

              console.log("User elements found:", {
                userNameElement: !!userNameElement,
                userProfileElement: !!userProfileElement,
                userAreaElement: !!userAreaElement,
                mobileUserNameElement: !!mobileUserNameElement,
                mobileUserProfileElement: !!mobileUserProfileElement,
                userAreaMobileElement: !!userAreaMobileElement,
                hasUserElements: hasUserElements
              });

              if (hasUserElements) {
          if (user) {
            // User is logged in
            const displayName = user.email.split("@")[0];

            // Update desktop navbar
            if (userNameElement) userNameElement.textContent = displayName;
            if (userProfileElement) {
              userProfileElement.style.background = "rgba(37, 211, 102, 0.2)";
              userProfileElement.style.color = "#25d366";
            }

            // Update mobile navbar
                  if (mobileUserNameElement) mobileUserNameElement.textContent = displayName;
            if (mobileUserProfileElement) {
                    mobileUserProfileElement.style.background = "rgba(37, 211, 102, 0.2)";
              mobileUserProfileElement.style.color = "#25d366";
            }

                  console.log("âœ… User profile updated:", displayName);
                  return true;
          } else {
            // Guest mode
            if (userNameElement) userNameElement.textContent = "Guest";
            if (userProfileElement) {
              userProfileElement.style.background = "rgba(255, 255, 255, 0.1)";
              userProfileElement.style.color = "#fff";
            }

                  if (mobileUserNameElement) mobileUserNameElement.textContent = "Guest";
            if (mobileUserProfileElement) {
                    mobileUserProfileElement.style.background = "rgba(255, 255, 255, 0.1)";
              mobileUserProfileElement.style.color = "#fff";
            }

                  console.log("âœ… User profile updated: Guest");
                  return true;
                }
              } else {
                console.log("User elements not found, will retry...");
                return false;
              }
            }

            // Try to update immediately
            if (!attemptUserUpdate()) {
              // If elements not found, retry with exponential backoff
              let retryCount = 0;
              const maxRetries = 8;
              
              function retryUserUpdate() {
                if (retryCount >= maxRetries) {
                  console.log("Failed to update user area after retries");
                  return;
                }
                
                retryCount++;
                const delay = Math.min(1000 * Math.pow(2, retryCount - 1), 5000); // Exponential backoff, max 5s
                
                console.log(`Retrying user update (${retryCount}/${maxRetries}) in ${delay}ms`);
                
                userUpdateTimeout = setTimeout(() => {
                  if (attemptUserUpdate()) {
                    console.log("âœ… User area updated successfully on retry");
                  } else {
                    retryUserUpdate();
                  }
                }, delay);
              }
              
              retryUserUpdate();
            }

          } catch (error) {
            console.error("Error updating user area:", error);
          }
        }

        // Initialize cart system with cart.js
        if (typeof initializeCart === "function") {
          console.log("Product Template: Initializing cart with cart.js");
          initializeCart(supabaseClient);
        } else {
          console.log(
            "Product Template: cart.js not available, using fallback"
          );

          // Check current user authentication with retry
          let userCheckRetries = 0;
          const maxUserCheckRetries = 5;

          async function checkUserAuthentication() {
            try {
              const {
                data: { user },
                error,
              } = await supabaseClient.auth.getUser();

              if (error) {
                console.log("Product Template: Auth error:", error.message);
                window.currentUserId = null;
              } else if (user) {
                console.log(
                  "Product Template: User authenticated:",
                  user.id,
                  user.email
                );
                window.currentUserId = user.id;
                showNotification(`Logged in as ${user.email}`, "success");
              } else {
                console.log("Product Template: No authenticated user");
                window.currentUserId = null;
                showNotification("Guest mode - cart saved locally", "info");
              }
            } catch (error) {
              console.log("Product Template: Auth check failed:", error);
              window.currentUserId = null;

              // Retry if we haven't exceeded max retries
              if (userCheckRetries < maxUserCheckRetries) {
                userCheckRetries++;
                console.log(
                  `Product Template: Retrying auth check (${userCheckRetries}/${maxUserCheckRetries})`
                );
                setTimeout(checkUserAuthentication, 500);
              }
            }
          }

          // Initial user check with delay to ensure Supabase is ready
          setTimeout(async () => {
            await checkUserAuthentication();

            // Update UI after authentication check with delay to ensure navbar is loaded
            setTimeout(async () => {
              await updateUserArea();
            updateNavbarCartCount();
            }, 2000);
          }, 1000);
        }

        // Optimized cart system initialization
        function initializeCartOptimized() {
          console.log("Product Template: Initializing cart system...");
          
          // Try the fastest method first - direct localStorage access
          const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
          
          // Update cart count immediately
          updateCartCount(cart);
          console.log("Cart count updated immediately from localStorage");
          
          // Initialize cart system if available (non-blocking)
          if (typeof initializeCart === "function") {
            console.log("Product Template: Using initializeCart");
            initializeCart(supabaseClient);
          } else if (typeof handleCartAuthChange === "function") {
            console.log("Product Template: Using handleCartAuthChange");
            handleCartAuthChange(supabaseClient);
          } else if (typeof window.loadCart === "function") {
            console.log("Product Template: Using window.loadCart");
            window.loadCart();
            } else {
            console.log("Product Template: Using localStorage-only cart system");
          }
          
          console.log("Cart system initialization complete");
        }

        // Initialize cart system immediately for better performance
        initializeCartOptimized();
        
        // Initialize user area immediately
        updateUserArea();

        // Listen for auth state changes
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
          console.log(
            "Product Template: Auth state changed:",
            event,
            session?.user?.id
          );

          if (session?.user) {
            window.currentUserId = session.user.id;
            console.log(
              "Product Template: User logged in:",
              session.user.email
            );
            showNotification(`Logged in as ${session.user.email}`, "success");

            // Update user area immediately
            await updateUserArea();

            // Update navbar
            await updateUserProfile();
            updateNavbarCartCount();

            // Update navbar user area
            if (
              typeof window.navbarLoader !== "undefined" &&
              window.navbarLoader.initializeUserAuth
            ) {
              await window.navbarLoader.initializeUserAuth();
            }
          } else {
            window.currentUserId = null;
            console.log("Product Template: User logged out");
            showNotification("Logged out - cart saved locally", "info");

            // Update user area immediately
            await updateUserArea();

            // Update navbar
            await updateUserProfile();
            updateNavbarCartCount();

            // Update navbar user area
            if (
              typeof window.navbarLoader !== "undefined" &&
              window.navbarLoader.initializeUserAuth
            ) {
              await window.navbarLoader.initializeUserAuth();
            }
          }

          if (typeof window.handleCartAuthChange === "function") {
            window.handleCartAuthChange(supabaseClient);
          }
        });
        
        // Listen for navbar loading completion
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'childList') {
              const userElements = document.querySelectorAll('#user-name, #user-profile, #user-area, #mobile-user-name, #mobile-user-profile, #user-area-mobile');
              if (userElements.length > 0) {
                console.log("Navbar user elements detected, updating user area...");
                updateUserArea();
                observer.disconnect(); // Stop observing once elements are found
              }
            }
          });
        });
        
        // Start observing the navbar container
        const navbarContainer = document.getElementById('navbar-container');
        if (navbarContainer) {
          observer.observe(navbarContainer, { childList: true, subtree: true });
        }

        // Update cart count after initialization
        setTimeout(async () => {
          // Force update cart UI from cart.js
          if (typeof window.updateCartUI === "function") {
            window.updateCartUI();
          }

          // Also try to load cart from localStorage directly
          const cartKey = window.currentUserId
            ? `cart_user_${window.currentUserId}`
            : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
          const totalItems = cart.reduce(
            (sum, item) => sum + (item.quantity || 0),
            0
          );

          // Update all cart count elements
          const cartCountElements = document.querySelectorAll(
            ".cart-count, #cart-count, #mobile-cart-count"
          );
          cartCountElements.forEach((element) => {
            element.textContent = totalItems;
            element.style.display = totalItems > 0 ? "flex" : "none";
          });

          // Update navbar
          await updateUserProfile();
          updateNavbarCartCount();

          // Load mobile navbar based on screen size
          loadMobileNavbar();

          console.log("Product Template: Cart system initialization complete");
          console.log("Cart items found:", totalItems);

          // Debug: Check cart system status
          console.log("=== Product Template Cart Debug ===");
          console.log("window.addToCart:", typeof window.addToCart);
          console.log("window.getCartCount:", typeof window.getCartCount);
          console.log("window.currentUserId:", window.currentUserId);
          console.log("window.cart:", window.cart);

          // Test cart functionality
          if (typeof window.addToCart === "function") {
            console.log("âœ… Cart system is working");
          } else {
            console.log("âŒ Cart system is not working");
          }
        }, 500);

        // Initialize product page
        await initializeProduct();
        
        // Initialize cart count immediately for better performance
        const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
        const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
        updateCartCount(cart);
        console.log("Cart count initialized immediately");

        // Add test function for debugging
        window.testProductCart = function () {
          console.log("=== Testing Product Cart ===");
          console.log("productData:", productData);
          console.log("window.addToCart:", typeof window.addToCart);
          console.log("window.currentUserId:", window.currentUserId);

          if (productData && typeof window.addToCart === "function") {
            const testProduct = {
              id: productData.id,
              name: productData.name,
              price: productData.price,
              image: productImages[currentImageIndex] || productData.image,
              quantity: 1,
              color: "default",
              size: "default",
              added_at: new Date().toISOString(),
            };

            console.log("Testing with product:", testProduct);
            window.addToCart(testProduct);
            console.log("âœ… Test completed");
          } else {
            console.log(
              "âŒ Cannot test - missing productData or addToCart function"
            );
          }
        };

        // Add Supabase connection test
        window.testSupabaseConnection = async function () {
          console.log("=== Testing Supabase Connection ===");

          try {
            const supabaseClient = window.supabase.createClient(
              SUPABASE_URL,
              SUPABASE_ANON_KEY
            );

            // Test authentication
            const {
              data: { user },
              error: authError,
            } = await supabaseClient.auth.getUser();
            if (authError) {
              console.log("âŒ Auth error:", authError.message);
              showNotification("Authentication error", "error");
            } else if (user) {
              console.log("âœ… User authenticated:", user.email);
              showNotification(`Logged in as ${user.email}`, "success");
            } else {
              console.log("â„¹ï¸ No user logged in");
              showNotification("Not logged in (guest mode)", "info");
            }

            // Test database connection
            const { data: dbTest, error: dbError } = await supabaseClient
              .from("carts")
              .select("count")
              .limit(1);

            if (dbError) {
              if (dbError.code === "42P01") {
                console.log("âš ï¸ Carts table doesn't exist");
                showNotification("Database table not found", "warning");
              } else {
                console.log("âŒ Database error:", dbError.message);
                showNotification("Database connection error", "error");
              }
            } else {
              console.log("âœ… Database connection successful");
              showNotification("Database connected successfully", "success");
            }
          } catch (error) {
            console.log("âŒ Connection test failed:", error);
            showNotification("Connection test failed", "error");
          }
        };

        // Add cart status check
        window.checkCartStatus = function () {
          console.log("=== Cart Status Check ===");

          const cartKey = window.currentUserId
            ? `cart_user_${window.currentUserId}`
            : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");

          console.log("Cart key:", cartKey);
          console.log("Cart items:", cart.length);
          console.log("Cart contents:", cart);

          if (cart.length > 0) {
            const totalItems = cart.reduce(
              (sum, item) => sum + item.quantity,
              0
            );
            
            console.log("Total items in cart:", totalItems);
          }
        };
        
        // Add function to show cart info
        window.showCartInfo = function() {
          const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
          
          if (cart.length > 0) {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            showNotification(`Cart has ${totalItems} items`, "info");
          } else {
            showNotification("Cart is empty", "info");
          }
        };
        
        // Add function to manually load cart
        window.forceLoadCart = function() {
          console.log("=== Force Loading Cart ===");
          
          if (typeof window.loadCart === "function") {
            console.log("Calling window.loadCart...");
            window.loadCart();
            console.log("âœ… Cart loaded successfully");
          } else {
            console.log("âŒ window.loadCart not available");
          }
          
          // Check cart state after loading
          setTimeout(() => {
            console.log("Cart state after force load:", window.cart);
            const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
            const localStorageCart = JSON.parse(localStorage.getItem(cartKey) || "[]");
            console.log("LocalStorage cart after force load:", localStorageCart);
          }, 1000);
        };
        
                // Add simple test function
        window.testAddToCart = function() {
          console.log("=== Testing Add to Cart ===");
          
          if (!productData) {
            console.log("âŒ No product data available");
            return;
          }
          
          // Call the global addToCart function
          console.log("Calling window.addToCart function...");
          if (typeof window.addToCart === "function") {
            window.addToCart();
          } else {
            console.log("âŒ window.addToCart function not available");
          }
          
          // Check result after 1 second
          setTimeout(() => {
            const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
            const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
            console.log("Final cart contents:", cart);
            console.log("Total items:", cart.reduce((sum, item) => sum + (item.quantity || 0), 0));
          }, 1000);
        };
        
        // Add function to check cart contents
        window.checkCart = function() {
          console.log("=== Checking Cart Contents ===");
          
          const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
          
          console.log("Cart key:", cartKey);
          console.log("Cart items:", cart.length);
          console.log("Cart contents:", cart);
          console.log("Total items:", cart.reduce((sum, item) => sum + (item.quantity || 0), 0));
          
          return cart;
        };
        
        // Add function to clear cart
        window.clearCart = function() {
          console.log("=== Clearing Cart ===");
          
          const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
          localStorage.removeItem(cartKey);
          
          // Update cart count
          updateCartCount([]);
          
          console.log("âœ… Cart cleared");
        };
        
        // Add performance monitoring function
        window.checkCartPerformance = function() {
          console.log("=== Cart Performance Check ===");
          
          const startTime = performance.now();
          
          // Test cart loading speed
          const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
          const loadTime = performance.now() - startTime;
          
          console.log(`Cart load time: ${loadTime.toFixed(2)}ms`);
          console.log(`Cart items: ${cart.length}`);
          console.log(`Total quantity: ${cart.reduce((sum, item) => sum + (item.quantity || 0), 0)}`);
          
          // Test cart update speed
          const updateStartTime = performance.now();
          updateCartCount(cart);
          const updateTime = performance.now() - updateStartTime;
          
          console.log(`Cart update time: ${updateTime.toFixed(2)}ms`);
          
          return {
            loadTime: loadTime.toFixed(2),
            updateTime: updateTime.toFixed(2),
            items: cart.length,
            totalQuantity: cart.reduce((sum, item) => sum + (item.quantity || 0), 0)
          };
        };
        
        // Add function to test user account loading
        window.testUserAccount = async function() {
          console.log("=== Testing User Account Loading ===");
          
          // Check Supabase connection
          console.log("1. Checking Supabase connection...");
          try {
            const { data: { user }, error } = await supabaseClient.auth.getUser();
            if (error) {
              console.log("âŒ Supabase auth error:", error.message);
            } else if (user) {
              console.log("âœ… User found:", user.email);
            } else {
              console.log("â„¹ï¸ No user logged in");
            }
          } catch (error) {
            console.log("âŒ Supabase connection failed:", error);
          }
          
          // Check navbar status
          console.log("2. Checking navbar status...");
          window.checkNavbarStatus();
          
          // Try to update user area
          console.log("3. Testing user area update...");
          await window.forceUpdateUserArea();
          
          console.log("âœ… User account test completed");
        };

        // Add function to check and update authentication status
        window.checkAuthStatus = async function () {
          console.log("=== Checking Authentication Status ===");

          try {
            const {
              data: { user },
              error,
            } = await supabaseClient.auth.getUser();

            if (error) {
              console.log("âŒ Auth error:", error.message);
              showNotification("Authentication error", "error");
              return false;
            } else if (user) {
              console.log("âœ… User authenticated:", user.id, user.email);
              window.currentUserId = user.id;
              showNotification(`Logged in as ${user.email}`, "success");
              return true;
            } else {
              console.log("â„¹ï¸ No user logged in");
              window.currentUserId = null;
              showNotification("Guest mode", "info");
              return false;
            }
          } catch (error) {
            console.log("âŒ Auth check failed:", error);
            showNotification("Authentication check failed", "error");
            return false;
          }
        };
        
        // Add function to manually update user area
        window.forceUpdateUserArea = async function() {
          console.log("=== Force Updating User Area ===");
          
          try {
            await updateUserArea();
            console.log("âœ… User area update completed");
          } catch (error) {
            console.error("âŒ User area update failed:", error);
          }
        };
        
        // Add function to check user account status
        window.checkUserAccount = async function() {
          console.log("=== Checking User Account Status ===");
          
          try {
            // Check Supabase connection
            console.log("1. Checking Supabase connection...");
            const { data: { user }, error } = await supabaseClient.auth.getUser();
            
            if (error) {
              console.log("âŒ Supabase auth error:", error.message);
              return false;
            } else if (user) {
              console.log("âœ… User authenticated:", user.email);
              console.log("User ID:", user.id);
            } else {
              console.log("â„¹ï¸ No user logged in (guest mode)");
            }
            
            // Check navbar elements
            console.log("2. Checking navbar elements...");
            const navbarElements = {
              userName: document.getElementById("user-name"),
              userProfile: document.getElementById("user-profile"),
              userArea: document.getElementById("user-area"),
              mobileUserName: document.getElementById("mobile-user-name"),
              mobileUserProfile: document.getElementById("mobile-user-profile"),
              userAreaMobile: document.getElementById("user-area-mobile")
            };
            
            console.log("Navbar elements found:", navbarElements);
            
            // Check global user variables
            console.log("3. Checking global user variables...");
            console.log("window.currentUser:", window.currentUser);
            console.log("window.currentUserId:", window.currentUserId);
            
            return {
              authenticated: !!user,
              user: user,
              navbarElements: navbarElements,
              globalUser: window.currentUser,
              globalUserId: window.currentUserId
            };
            
          } catch (error) {
            console.error("âŒ User account check failed:", error);
            return false;
          }
        };
        
        // Add function to login/logout test
        window.testUserAuth = async function() {
          console.log("=== Testing User Authentication ===");
          
          try {
            const { data: { user }, error } = await supabaseClient.auth.getUser();
            
            if (user) {
              console.log("âœ… User is logged in:", user.email);
              console.log("Testing logout...");
              await supabaseClient.auth.signOut();
              console.log("âœ… Logged out successfully");
            } else {
              console.log("â„¹ï¸ No user logged in");
              console.log("Testing guest mode...");
            }
            
            // Update user area after auth change
            await updateUserArea();
            
          } catch (error) {
            console.error("âŒ Auth test failed:", error);
          }
        };
        
        // Add function to check navbar loading status
        window.checkNavbarStatus = function() {
          console.log("=== Checking Navbar Status ===");
          
          const navbarContainer = document.getElementById("navbar-container");
          const navbar = document.querySelector(".navbar");
          const userArea = document.getElementById("user-area");
          const userAreaMobile = document.getElementById("user-area-mobile");
          
          console.log("Navbar elements:", {
            navbarContainer: !!navbarContainer,
            navbar: !!navbar,
            userArea: !!userArea,
            userAreaMobile: !!userAreaMobile
          });
          
          if (navbarContainer) {
            console.log("Navbar container HTML:", navbarContainer.innerHTML.substring(0, 200) + "...");
          }
          
          return {
            navbarContainer: !!navbarContainer,
            navbar: !!navbar,
            userArea: !!userArea,
            userAreaMobile: !!userAreaMobile
          };
        };

        // Add function to force refresh authentication
        window.refreshAuth = async function () {
          console.log("=== Refreshing Authentication ===");
          await checkUserAuthentication();

          if (typeof window.handleCartAuthChange === "function") {
            window.handleCartAuthChange(supabaseClient);
          }

          showNotification("Authentication refreshed", "info");
        };

        // Notification system (enhanced)
        function showNotification(message, type = "info") {
          console.log(`Notification: ${type} - ${message}`);

          // Remove any existing notifications
          const existingNotifications =
            document.querySelectorAll(".notification");
          existingNotifications.forEach((notification) =>
            notification.remove()
          );

          // Create notification element
          const notification = document.createElement("div");
          notification.className = `notification notification-${type}`;
          notification.innerHTML = `
            <div class="notification-content">
              <div class="notification-icon">
                ${
                  type === "success"
                    ? "âœ…"
                    : type === "error"
                    ? "âŒ"
                    : type === "warning"
                    ? "âš ï¸"
                    : "â„¹ï¸"
                }
              </div>
              <div class="notification-message">${message}</div>
              <button class="notification-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
            </div>
          `;

          // Add styles if not already present
          if (!document.getElementById("notification-styles")) {
            const style = document.createElement("style");
            style.id = "notification-styles";
            style.textContent = `
              .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 400px;
                background: #1a1a1a;
                border: 1px solid #333;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                animation: slideInRight 0.3s ease-out;
              }
              
              .notification-success {
                border-left: 4px solid #25d366;
              }
              
              .notification-error {
                border-left: 4px solid #ff4757;
              }
              
              .notification-warning {
                border-left: 4px solid #ffc107;
              }
              
              .notification-info {
                border-left: 4px solid #3742fa;
              }
              
              .notification-content {
                display: flex;
                align-items: center;
                padding: 15px 20px;
                color: #fff;
              }
              
              .notification-icon {
                font-size: 20px;
                margin-right: 12px;
              }
              
              .notification-message {
                flex: 1;
                font-size: 14px;
                line-height: 1.4;
              }
              
              .notification-close {
                background: none;
                border: none;
                color: #999;
                font-size: 20px;
                cursor: pointer;
                padding: 0;
                margin-left: 10px;
                line-height: 1;
              }
              
              .notification-close:hover {
                color: #fff;
              }
              
              @keyframes slideInRight {
                from {
                  transform: translateX(100%);
                  opacity: 0;
                }
                to {
                  transform: translateX(0);
                  opacity: 1;
                }
              }
            `;
            document.head.appendChild(style);
          }

          document.body.appendChild(notification);

          // Auto-remove after 4 seconds
          setTimeout(() => {
            if (notification.parentNode) {
              notification.style.animation = "slideOutRight 0.3s ease-out";
              setTimeout(() => {
                if (notification.parentNode) {
                  notification.parentNode.removeChild(notification);
                }
              }, 300);
            }
          }, 4000);

          // Add slideOutRight animation if not present
          if (!document.querySelector("#notification-styles")) {
            const existingStyle = document.getElementById(
              "notification-styles"
            );
            if (existingStyle) {
              existingStyle.textContent += `
                @keyframes slideOutRight {
                  from {
                    transform: translateX(0);
                    opacity: 1;
                  }
                  to {
                    transform: translateX(100%);
                    opacity: 0;
                  }
                }
              `;
            }
          }
        }

        // Function to update cart icon count (legacy function for compatibility)
        function updateCartIconCount() {
          // Use cart.js updateCartUI if available
          if (typeof window.updateCartUI === "function") {
            console.log("Using cart.js updateCartUI");
            window.updateCartUI();
          } else {
            console.log("Using fallback updateNavbarCartCount");
            updateNavbarCartCount();
          }
        }

        // Make function globally available
        window.updateCartIconCount = updateCartIconCount;

        // Debug function to test cart count
        window.debugCartCount = function () {
          console.log("=== Debug Cart Count ===");
          const cartKey = window.currentUserId
            ? `cart_user_${window.currentUserId}`
            : "cart_guest";
          const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
          const totalItems = cart.reduce(
            (sum, item) => sum + (item.quantity || 0),
            0
          );

          console.log("Cart key:", cartKey);
          console.log("Cart items:", cart);
          console.log("Total items:", totalItems);
          console.log("Current user ID:", window.currentUserId);

          // Update navbar cart count
          if (
            typeof window.navbarLoader !== "undefined" &&
            window.navbarLoader.updateCartCount
          ) {
            window.navbarLoader.updateCartCount();
            console.log("Navbar cart count updated");
          }

          // Also test the navbar loader's test function
          if (typeof window.testCartCount === "function") {
            window.testCartCount();
          }
        };

        // Test function to add a test item to cart
        window.testAddToCart = function () {
          const testProduct = {
            id: 999,
            name: "Test Product",
            price: 29.99,
            image: "assets/images/products/default.jpg",
            quantity: 1,
            added_at: new Date().toISOString(),
          };

          if (typeof window.addToCart === "function") {
            window.addToCart(testProduct);
            console.log("Test product added to cart");
          } else {
            console.log("addToCart function not available");
          }
        };

        // Function to check and sync cart data between pages
        window.syncCartData = function () {
          console.log("=== Syncing Cart Data ===");

          // Check all cart keys in localStorage
          const cartKeys = Object.keys(localStorage).filter((key) =>
            key.includes("cart")
          );
          console.log("All cart keys:", cartKeys);

          cartKeys.forEach((key) => {
            const cart = JSON.parse(localStorage.getItem(key) || "[]");
            const totalItems = cart.reduce(
              (sum, item) => sum + (item.quantity || 0),
              0
            );
            console.log(`${key}: ${totalItems} items`, cart);
          });

          // Force update navbar cart count
          if (
            typeof window.navbarLoader !== "undefined" &&
            window.navbarLoader.updateCartCount
          ) {
            window.navbarLoader.updateCartCount();
          }

          // Also update cart UI if available
          if (typeof window.updateCartUI === "function") {
            window.updateCartUI();
          }
        };

        // Test function to check if addToCart is working
        window.testAddToCart = function () {
          console.log("=== Testing Add to Cart ===");
          console.log("addToCart function exists:", typeof addToCart);
          console.log("productData exists:", !!productData);
          console.log("productData:", productData);

          if (typeof addToCart === "function") {
            console.log("Calling addToCart function...");
            addToCart();
          } else {
            console.error("addToCart function not found!");
          }
        };

        // Make addToCart globally available as fallback (only if not already defined)
        if (typeof window.addToCart !== "function") {
          window.addToCart = addToCart;
        }

        // Function to load mobile navbar dynamically
        function loadMobileNavbar() {
          if (window.innerWidth <= 768) {
            // Only load mobile navbar on mobile devices
            const mobileNavbar = document.querySelector(
              ".mobile-bottom-navbar"
            );
            if (mobileNavbar) {
              mobileNavbar.style.display = "block";
              console.log("Mobile navbar loaded for mobile device");
            }
          } else {
            // Hide mobile navbar on desktop
            const mobileNavbar = document.querySelector(
              ".mobile-bottom-navbar"
            );
            if (mobileNavbar) {
              mobileNavbar.style.display = "none";
              console.log("Mobile navbar hidden on desktop");
            }
          }
        }

        // Listen for cart changes in localStorage
        window.addEventListener("storage", function (e) {
          if (e.key && (e.key.includes("cart") || e.key.includes("user"))) {
            setTimeout(() => {
              updateCartIconCount();
            }, 100);
          }
        });

        // Load mobile navbar on page load and resize
        document.addEventListener("DOMContentLoaded", function () {
          loadMobileNavbar();
        });

        window.addEventListener("resize", function () {
          loadMobileNavbar();
        });

        // Add function to force authentication check and show detailed status
        window.forceAuthCheck = async function () {
          console.log("=== Force Authentication Check ===");
          console.log("Supabase client:", typeof supabaseClient);
          console.log("Supabase auth:", typeof supabaseClient.auth);

          try {
            const {
              data: { user },
              error,
            } = await supabaseClient.auth.getUser();

            console.log("Auth result:", { user, error });

            if (error) {
              console.log("âŒ Auth error:", error);
              showNotification(`Auth error: ${error.message}`, "error");
            } else if (user) {
              console.log("âœ… User found:", user);
              window.currentUserId = user.id;
              showNotification(
                `Force check: Logged in as ${user.email}`,
                "success"
              );
            } else {
              console.log("â„¹ï¸ No user found");
              window.currentUserId = null;
              showNotification("Force check: Guest mode", "info");
            }
          } catch (error) {
            console.log("âŒ Force auth check failed:", error);
            showNotification(`Force check failed: ${error.message}`, "error");
          }
        };
      });
    </script>

    <script>
      // Initialize Supabase with correct configuration
      const SUPABASE_URL = "https://kokntkhxkymllafuubun.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtva250a2h4a3ltbGxhZnV1YnVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3NzYxODcsImV4cCI6MjA2ODM1MjE4N30.Ekc6HLszFSYTIgsvzTdKJWr85nFMUH2HQBQrg_uqXRc";

      // Create Supabase client properly
      let supabaseClient;
      if (
        typeof window.supabase !== "undefined" &&
        typeof window.supabase.createClient === 'function'
      ) {
        try {
          supabaseClient = window.supabase.createClient(
            SUPABASE_URL,
            SUPABASE_ANON_KEY
          );
          window.supabaseClient = supabaseClient;
          window._ptSupabaseClient = supabaseClient;
          console.log("âœ… Supabase client created successfully");
        } catch (error) {
          console.error("âŒ Error creating Supabase client:", error);
          supabaseClient = null;
        }
      } else if (window.supabaseClient) {
        supabaseClient = window.supabaseClient;
        window._ptSupabaseClient = supabaseClient;
        console.log("âœ… Using existing Supabase client");
      } else {
        console.warn("âŒ Supabase not loaded yet, will initialize when available");
        supabaseClient = null;
      }

      // Get product ID from URL parameter
      function getProductIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id") || urlParams.get("product") || "1";
      }

      // Load product data from JSON file
      async function loadProductData(productId) {
        try {
              console.log("ðŸ” Fetching products from server...");
    // Fetch the products from server
    const response = await fetch("/products");
          if (!response.ok) {
            throw new Error("Failed to load products.json");
          }

          const products = await response.json();
          console.log("ðŸ“‹ Total products loaded:", products.length);

          // Find the product by ID
          const product = products.find((p) => p.id == productId);
          console.log("ðŸ”Ž Searching for product ID:", productId);
          console.log("ðŸŽ¯ Found product:", product);

          if (product) {
            console.log("âœ… Product found in JSON, returning:", product.name);
            return product;
          } else {
            console.warn(
              `Product with ID ${productId} not found, using fallback`
            );
            return getFallbackProductData(productId);
          }
        } catch (error) {
          console.error("âŒ Error loading product data:", error);
          return getFallbackProductData(productId);
        }
      }

      // Fallback product data using the actual JSON structure
      function getFallbackProductData(productId) {
        const fallbackProducts = {
          1: {
            id: 1,
            name: "Gaming Controller",
            price: 119.99,
            originalPrice: 149.99,
            discount: 20,
            image:
              "assets/images/products/gaming-controller/616dt-2Ei8L._SL1080_.jpg",
            images: [
              "assets/images/products/gaming-controller/616dt-2Ei8L._SL1080_.jpg",
              "assets/images/products/gaming-controller/71DgF+r3-yL._SL1500_.jpg",
              "assets/images/products/gaming-controller/71f0rKNIpYL._SL1500_.jpg",
              "assets/images/products/gaming-controller/71Rt7RTkIkL._SL1500_.jpg",
              "assets/images/products/gaming-controller/81FiSb2XWuL._SL1500_.jpg",
            ],
            category: "Controllers",
            description:
              "Premium Bluetooth gaming controller with customizable buttons and ergonomic design. Perfect for mobile gaming enthusiasts who demand precision and comfort. Features include responsive analog sticks, programmable buttons, vibration feedback, and long battery life. Compatible with most mobile devices and gaming platforms.",
            stock: 8,
            rating: 4.8,
            reviews: 234,
            features: [],
          },
          2: {
            id: 2,
            name: "SY830 Gaming Headset",
            price: 69.99,
            originalPrice: 89.99,
            discount: 22,
            image:
              "assets/images/products/sy830-headset/H1bcda6093e7a4c0aa83db4b0b8ce7993l.jpg",
            images: [
              "assets/images/products/sy830-headset/H1bcda6093e7a4c0aa83db4b0b8ce7993l.jpg",
              "assets/images/products/sy830-headset/H1bfa672758624d0db33dbe0a740e3defn.jpg",
              "assets/images/products/sy830-headset/H2e8825b2ac7b4c77b17601ca58ff3cceW.jpg",
              "assets/images/products/sy830-headset/H1bcda6093e7a4c0aa83db4b0b8ce7993l.jpg",
              "assets/images/products/sy830-headset/H1bfa672758624d0db33dbe0a740e3defn.jpg",
            ],
            category: "Audio",
            description:
              "SY830 Premium wireless gaming headset with noise cancellation and crystal clear audio. Perfect for mobile gaming enthusiasts who demand immersive sound quality and comfort. Features include active noise cancellation, 7.1 surround sound, long battery life, and comfortable memory foam ear cushions for extended gaming sessions.",
            stock: 12,
            rating: 4.6,
            reviews: 156,
            features: [],
          },
          3: {
            id: 3,
            name: "Mobile Cooling Fan Dual",
            price: 24,
            originalPrice: 30,
            discount: 20,
            image:
              "assets/images/products/cooling-fan/H0241f2900db54b95bae5c333db25251aR.png_720x720q50.avif",
            images: [
              "assets/images/products/cooling-fan/H0241f2900db54b95bae5c333db25251aR.png_720x720q50.avif",
              "assets/images/products/cooling-fan/H36c0700f5206400db20ab6520edda136T.png_720x720q50.avif",
              "assets/images/products/cooling-fan/H40c8c2bc7a004c7bb3ad2fec57fc53e4U.jpg_720x720q50.avif",
              "assets/images/products/cooling-fan/Heaee4ea8b7414ef7942d0ea0d170c7bbe.jpg_720x720q50.avif",
              "assets/images/products/cooling-fan/Hb4c9fce6b00741d6a70810063a439d54w.png_720x720q50.avif",
            ],
            category: "Cooling",
            description:
              "USB-powered mobile cooling fan designed to prevent overheating during intense gaming sessions. Perfect for mobile gaming enthusiasts who demand optimal performance. Features include high-speed cooling, quiet operation, adjustable speed settings, and universal USB compatibility for all mobile devices and gaming setups.",
            stock: 18,
            rating: 4.3,
            reviews: 0,
            features: [],
          },
          4: {
            id: 4,
            name: "Gaming Keyboard RGB",
            price: 89.99,
            originalPrice: 119.99,
            discount: 25,
            image:
              "assets/images/products/gaming-keyboard/614eKiff8nL._AC_SL1500_.jpg",
            images: [
              "assets/images/products/gaming-keyboard/614eKiff8nL._AC_SL1500_.jpg",
              "assets/images/products/gaming-keyboard/61Krm31YGfL._AC_SL1500_.jpg",
              "assets/images/products/gaming-keyboard/61mFL8GY6kL._AC_SL1500_ (1).jpg",
              "assets/images/products/gaming-keyboard/H66caee659ade4b2bb008bc38e4d24936t.jpg_720x720q50.avif",
              "assets/images/products/gaming-keyboard/H61mFL8GY6kL._AC_SL1500_.jpg_720x720q50.avif",
            ],
            category: "Keyboards",
            description:
              "RGB mechanical gaming keyboard with customizable backlighting and responsive switches. Perfect for mobile gaming enthusiasts who demand precision and style. Features include programmable macro keys, anti-ghosting technology, ergonomic design, and USB-C connectivity for seamless gaming experience.",
            stock: 15,
            rating: 4.7,
            reviews: 189,
            features: [],
          },
          5: {
            id: 5,
            name: "Gaming Mouse Pad RGB",
            price: 29.99,
            originalPrice: 39.99,
            discount: 25,
            image:
              "assets/images/products/mouse-pad/61N8MClHp3L._AC_SL1500_.jpg",
            images: [
              "assets/images/products/mouse-pad/61N8MClHp3L._AC_SL1500_.jpg",
              "assets/images/products/mouse-pad/711KDiqWMpL._AC_SL1500_.jpg",
              "assets/images/products/mouse-pad/916tCPIveHL._AC_SL1500_.jpg",
              "assets/images/products/mouse-pad/91usrmFBeNL._AC_SL1500_.jpg",
              "assets/images/products/mouse-pad/61N8MClHp3L._AC_SL1500_.jpg",
            ],
            category: "Accessories",
            description:
              "RGB gaming mouse pad with customizable lighting and smooth surface. Perfect for mobile gaming enthusiasts who demand precision and style. Features include anti-slip rubber base, stitched edges, RGB lighting effects, and large surface area for optimal mouse movement.",
            stock: 35,
            rating: 4.4,
            reviews: 156,
            features: [],
          },
        };

        return fallbackProducts[productId] || fallbackProducts["1"];
      }

      // Global product data variable
      let productData = null;

      // Initialize product page
      async function initializeProduct() {
        console.log("ðŸš€ Initializing product page...");
        const productId = getProductIdFromUrl();
        console.log("ðŸ“¦ Product ID from URL:", productId);

        // Load product data
        console.log("ðŸ“¥ Loading product data...");
        productData = await loadProductData(productId);
        console.log("âœ… Product data loaded:", productData);

        if (!productData) {
          console.error("âŒ Product data is null or undefined");
          showMessage("Product not found!", "error");
          return;
        }

        // Update page title
        document.title = `${productData.name} - Mobile Gaming Store`;

        // Update breadcrumb
        console.log("ðŸ”„ Updating breadcrumb...");
        const productNameEl = document.getElementById("product-name");
        const categoryLinkEl = document.getElementById("category-link");

        if (productNameEl) {
          productNameEl.textContent = productData.name;
          console.log("âœ… Product name updated:", productData.name);
        } else {
          console.error("âŒ Product name element not found");
        }

        if (categoryLinkEl) {
          categoryLinkEl.textContent = productData.category;
          categoryLinkEl.href = `../category.html?cat=${productData.category}`;
          console.log("âœ… Category link updated:", productData.category);
        } else {
          console.error("âŒ Category link element not found");
        }

        // Update product info
        console.log("ðŸ”„ Updating product info...");
        const productTitleEl = document.getElementById("product-title");
        const productCategoryEl = document.getElementById("product-category");
        const productBrandEl = document.getElementById("product-brand");
        const productModelEl = document.getElementById("product-model");
        const productDescEl = document.getElementById("product-description");

        if (productTitleEl) {
          productTitleEl.textContent = productData.name;
          console.log("âœ… Product title updated:", productData.name);
        } else {
          console.error("âŒ Product title element not found");
        }

        if (productCategoryEl) {
          productCategoryEl.textContent = productData.category;
          console.log("âœ… Product category updated:", productData.category);
        } else {
          console.error("âŒ Product category element not found");
        }

        if (productBrandEl) {
          productBrandEl.textContent = productData.category;
          console.log("âœ… Product brand updated:", productData.category);
        } else {
          console.error("âŒ Product brand element not found");
        }

        if (productModelEl) {
          productModelEl.textContent = `Model ${productData.id}`;
          console.log("âœ… Product model updated: Model", productData.id);
        } else {
          console.error("âŒ Product model element not found");
        }

        if (productDescEl) {
          productDescEl.textContent = productData.description;
          console.log("âœ… Product description updated");
        } else {
          console.error("âŒ Product description element not found");
        }

        // Update pricing
        const currentPriceEl = document.getElementById("current-price");
        const originalPriceEl = document.getElementById("original-price");
        const savingsEl = document.getElementById("savings");

        currentPriceEl.textContent = `$${productData.price.toFixed(2)}`;

        if (productData.originalPrice > productData.price) {
          originalPriceEl.textContent = `$${productData.originalPrice.toFixed(
            2
          )}`;
          originalPriceEl.style.display = "inline";
          savingsEl.textContent = `Save $${(
            productData.originalPrice - productData.price
          ).toFixed(2)}`;
          savingsEl.style.display = "inline";
        }

        // Update rating
        document.getElementById("product-stars").innerHTML = "â­".repeat(
          Math.round(productData.rating)
        );
        document.getElementById(
          "rating-count"
        ).textContent = `(${productData.reviews} reviews)`;

        // Update stock status
        const stockStatus = document.getElementById("stock-status");
        if (productData.stock > 10) {
          stockStatus.textContent = "In Stock";
          stockStatus.className = "stock-status";
        } else if (productData.stock > 0) {
          stockStatus.textContent = `Only ${productData.stock} left`;
          stockStatus.className = "stock-status low";
        } else {
          stockStatus.textContent = "Out of Stock";
          stockStatus.className = "stock-status out";
        }

        // Load images
        loadProductImages();
        setupImageZoom(); // Call setupImageZoom here

        // Load reviews
        loadReviews();

        // Load related products
        loadRelatedProducts().catch((error) => {
          console.error("Error loading related products:", error);
        });
      }

      // Enhanced image gallery variables
      let currentImageIndex = 0;
      let productImages = [];
      let carouselInterval = null;

      // Load product images with enhanced features
      function loadProductImages() {
        const mainImage = document.getElementById("main-image");
        const mainImageContainer = document.querySelector(
          ".main-image-container"
        );
        const thumbnailGrid = document.getElementById("thumbnail-grid");
        const imageCarousel = document.getElementById("image-carousel");
        const carouselContainer = document.getElementById("carousel-container");

        // Show loading state
        mainImage.style.display = "none";
        const loadingDiv = document.createElement("div");
        loadingDiv.className = "image-loading";
        loadingDiv.innerHTML = '<div class="loading-spinner"></div>';
        mainImage.parentNode.insertBefore(loadingDiv, mainImage);

        // Prepare images array
        if (
          productData.images &&
          Array.isArray(productData.images) &&
          productData.images.length > 1
        ) {
          productImages = productData.images;
          // Show carousel for multiple images and hide main image container
          imageCarousel.style.display = "block";
          mainImageContainer.style.display = "none";
          setupCarousel();
        } else {
          productImages = [productData.image];
          imageCarousel.style.display = "none";
          mainImageContainer.style.display = "block";
        }

        // Load main image with lazy loading
        const img = new Image();
        img.onload = function () {
          mainImage.src = productImages[0];
          mainImage.alt = `${productData.name} - Main View`;
          mainImage.style.display = "block";
          loadingDiv.remove();

          // Setup image features
          setupImageZoom();
          setupLightbox();
          loadThumbnails();
        };
        img.onerror = function () {
          // Fallback to placeholder
          mainImage.src =
            "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBVbmF2YWlsYWJsZTwvdGV4dD48L3N2Zz4=";
          mainImage.alt = "Image not available";
          mainImage.style.display = "block";
          loadingDiv.remove();
        };
        img.src = productImages[0];
      }

      // Setup carousel for multiple images
      function setupCarousel() {
        const carouselContainer = document.getElementById("carousel-container");
        const indicators = document.getElementById("carousel-indicators");

        // Create carousel slides
        carouselContainer.innerHTML = productImages
          .map(
            (image, index) => `
          <div class="carousel-slide">
            <img src="${image}" alt="${productData.name} View ${index + 1}" />
          </div>
        `
          )
          .join("");

        // Create indicators
        indicators.innerHTML = productImages
          .map(
            (_, index) => `
          <div class="carousel-indicator ${index === 0 ? "active" : ""}" 
               onclick="goToSlide(${index})"></div>
        `
          )
          .join("");

        // Auto-advance carousel
        startCarouselAutoAdvance();
      }

      // Carousel navigation
      function nextSlide() {
        currentImageIndex = (currentImageIndex + 1) % productImages.length;
        updateCarousel();
      }

      function previousSlide() {
        currentImageIndex =
          (currentImageIndex - 1 + productImages.length) % productImages.length;
        updateCarousel();
      }

      function goToSlide(index) {
        currentImageIndex = index;
        updateCarousel();
      }

      function updateCarousel() {
        const carouselContainer = document.getElementById("carousel-container");
        const indicators = document.querySelectorAll(".carousel-indicator");
        const mainImage = document.getElementById("main-image");

        // Update carousel position
        carouselContainer.style.transform = `translateX(-${
          currentImageIndex * 100
        }%)`;

        // Update main image
        mainImage.src = productImages[currentImageIndex];
        mainImage.alt = `${productData.name} - View ${currentImageIndex + 1}`;

        // Update indicators
        indicators.forEach((indicator, index) => {
          indicator.classList.toggle("active", index === currentImageIndex);
        });

        // Update thumbnails
        updateThumbnailSelection();
      }

      function startCarouselAutoAdvance() {
        if (productImages.length > 1) {
          carouselInterval = setInterval(nextSlide, 5000); // Auto-advance every 5 seconds
        }
      }

      function stopCarouselAutoAdvance() {
        if (carouselInterval) {
          clearInterval(carouselInterval);
          carouselInterval = null;
        }
      }

      // Load thumbnails with lazy loading
      function loadThumbnails() {
        const thumbnailGrid = document.getElementById("thumbnail-grid");

        thumbnailGrid.innerHTML = productImages
          .map(
            (image, index) => `
          <img class="thumbnail ${index === 0 ? "active" : ""}" 
               src="${image}" 
               alt="${productData.name} View ${index + 1}" 
               onclick="selectImage(${index})" 
               loading="lazy" />
        `
          )
          .join("");
      }

      function selectImage(index) {
        currentImageIndex = index;
        const mainImage = document.getElementById("main-image");
        mainImage.src = productImages[index];
        mainImage.alt = `${productData.name} - View ${index + 1}`;
        updateThumbnailSelection();

        // Update carousel if visible
        if (productImages.length > 1) {
          updateCarousel();
        }
      }

      function updateThumbnailSelection() {
        const thumbnails = document.querySelectorAll(".thumbnail");
        thumbnails.forEach((thumb, index) => {
          thumb.classList.toggle("active", index === currentImageIndex);
        });
      }

      // Lightbox functionality
      function setupLightbox() {
        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightbox-image");

        // Close lightbox on background click
        lightbox.addEventListener("click", function (e) {
          if (e.target === lightbox) {
            closeLightbox();
          }
        });

        // Close lightbox on escape key
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            closeLightbox();
          }
        });
      }

      function openLightbox() {
        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightbox-image");

        lightboxImage.src = productImages[currentImageIndex];
        lightboxImage.alt = `${productData.name} - View ${
          currentImageIndex + 1
        }`;

        lightbox.classList.add("active");
        document.body.style.overflow = "hidden"; // Prevent background scrolling

        // Stop carousel auto-advance when lightbox is open
        stopCarouselAutoAdvance();
      }

      function closeLightbox() {
        const lightbox = document.getElementById("lightbox");
        lightbox.classList.remove("active");
        document.body.style.overflow = ""; // Restore scrolling

        // Restart carousel auto-advance
        if (productImages.length > 1) {
          startCarouselAutoAdvance();
        }
      }

      function nextLightboxImage() {
        currentImageIndex = (currentImageIndex + 1) % productImages.length;
        const lightboxImage = document.getElementById("lightbox-image");
        lightboxImage.src = productImages[currentImageIndex];
        lightboxImage.alt = `${productData.name} - View ${
          currentImageIndex + 1
        }`;
      }

      function previousLightboxImage() {
        currentImageIndex =
          (currentImageIndex - 1 + productImages.length) % productImages.length;
        const lightboxImage = document.getElementById("lightbox-image");
        lightboxImage.src = productImages[currentImageIndex];
        lightboxImage.alt = `${productData.name} - View ${
          currentImageIndex + 1
        }`;
      }

      // Enhanced image zoom functionality
      function setupImageZoom() {
        const mainImage = document.getElementById("main-image");
        const imageContainer = document.querySelector(".main-image-container");

        if (!mainImage || !imageContainer) return;

        let isZoomed = false;

        mainImage.addEventListener("click", function (e) {
          // Don't zoom if clicking on overlay buttons
          if (e.target.closest(".image-overlay")) return;

          if (!isZoomed) {
            // Zoom in
            mainImage.classList.add("zoomed");
            imageContainer.classList.add("zoomed");
            isZoomed = true;
          } else {
            // Zoom out
            mainImage.classList.remove("zoomed");
            imageContainer.classList.remove("zoomed");
            isZoomed = false;
          }
        });

        // Reset zoom on container click
        imageContainer.addEventListener("click", function (e) {
          if (
            e.target !== mainImage &&
            !e.target.closest(".image-overlay") &&
            isZoomed
          ) {
            mainImage.classList.remove("zoomed");
            imageContainer.classList.remove("zoomed");
            isZoomed = false;
          }
        });

        // Reset zoom on escape key
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && isZoomed) {
            mainImage.classList.remove("zoomed");
            imageContainer.classList.remove("zoomed");
            isZoomed = false;
          }
        });

        // Touch support for mobile
        let touchStartY = 0;
        mainImage.addEventListener("touchstart", function (e) {
          touchStartY = e.touches[0].clientY;
        });

        mainImage.addEventListener("touchend", function (e) {
          const touchEndY = e.changedTouches[0].clientY;
          const touchDiff = Math.abs(touchEndY - touchStartY);

          // If it's a tap (not a swipe), toggle zoom
          if (touchDiff < 10) {
            if (!isZoomed) {
              mainImage.classList.add("zoomed");
              imageContainer.classList.add("zoomed");
              isZoomed = true;
            } else {
              mainImage.classList.remove("zoomed");
              imageContainer.classList.remove("zoomed");
              isZoomed = false;
            }
          }
        });
      }

      // Quantity controls
      function changeQuantity(delta) {
        const quantityInput = document.getElementById("quantity");
        let currentQty = parseInt(quantityInput.value);
        let newQty = currentQty + delta;

        if (newQty >= 1 && newQty <= 99) {
          quantityInput.value = newQty;
        }
      }

      // Simple and reliable cart system
      let isAddingToCart = false; // Prevent multiple rapid clicks
      
      // Make product page add-to-cart function local (do not override cart.js)
      function addToCartProductPage() {
        if (isAddingToCart) {
          console.log("Already adding to cart, please wait...");
          return;
        }
        isAddingToCart = true;
        console.log("=== addToCart (product page) called ===");

        if (!productData || !productData.id) {
          console.error("No product data available");
          isAddingToCart = false;
            alert("Product not loaded");
          return;
        }

        // Normalize quantity
        let quantity = 1;
        try {
          const qtyElement = document.getElementById("quantity");
          if (qtyElement && qtyElement.value) {
            quantity = Math.max(1, parseInt(qtyElement.value, 10) || 1);
          }
        } catch {}

        // Selected options
        const selectedColor =
          document.querySelector("#color-options .option-btn.selected")?.dataset.value || "default";
        const selectedSize =
          document.querySelector("#size-options .option-btn.selected")?.dataset.value || "default";

        // Normalize product fields to match homepage/category
        const normalizedId = isNaN(Number(productData.id)) ? productData.id : Number(productData.id);
        const normalizedPrice = isNaN(Number(productData.price)) ? 0 : Number(productData.price);
        const normalizedImage =
          (Array.isArray(productImages) && productImages[currentImageIndex]) || productData.image || "";

        const product = {
          id: normalizedId,
          name: productData.name || "Product",
          price: normalizedPrice,
          image: normalizedImage,
          color: selectedColor,
          size: selectedSize,
          quantity,
          added_at: new Date().toISOString(),
        };

        console.log("Normalized product:", product);

        // Try to delegate to cart.js with a short retry window (so DB merge/UI stay consistent)
        let attempts = 0;
        const maxAttempts = 10; // ~2s total
        const tryDelegate = () => {
          attempts += 1;
          if (typeof window._mainAddToCart === "function") {
            console.log("Delegating to _mainAddToCart");
            window._mainAddToCart(product);
            showSuccessMessage("Product added to cart!");
            setTimeout(() => (isAddingToCart = false), 300);
            return true;
          }
          if (
            typeof window.addToCart === "function" &&
            window.addToCart !== addToCartProductPage // ensure not self
          ) {
            console.log("Delegating to window.addToCart (cart.js)");
          window.addToCart(product);
            showSuccessMessage("Product added to cart!");
            setTimeout(() => (isAddingToCart = false), 300);
            return true;
          }
          if (attempts < maxAttempts) {
            setTimeout(tryDelegate, 200);
            return false;
          }
          // After retries, fallback to localStorage
          fallbackAdd();
          return false;
        };

        const fallbackAdd = async () => {
          try {
            // Ensure we use the correct key if user is authenticated
            if (typeof supabaseClient !== "undefined" && supabaseClient?.auth) {
              try {
                const { data: { user } = {} } = await supabaseClient.auth.getUser();
                if (user && user.id) {
                  window.currentUserId = user.id;
                }
              } catch {}
            }
            const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
            let cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
            const idx = cart.findIndex((item) => item.id === product.id);
            if (idx >= 0) {
              cart[idx].quantity = Number(cart[idx].quantity || 0) + quantity;
        } else {
              cart.push(product);
            }
            localStorage.setItem(cartKey, JSON.stringify(cart));
            updateCartCount(cart);
            showSuccessMessage("Product added to cart!");
            console.log("âœ… Added via localStorage fallback using key:", cartKey);
          } finally {
            setTimeout(() => (isAddingToCart = false), 300);
          }
        };

        tryDelegate();
      }
      
      // Optimized cart count update function
      let cartUpdateTimeout = null;
      
      function updateCartCount(cart) {
        const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
        
        // Debounce cart count updates to prevent excessive DOM manipulation
        if (cartUpdateTimeout) {
          clearTimeout(cartUpdateTimeout);
        }
        
        cartUpdateTimeout = setTimeout(() => {
          // Update all cart count elements efficiently
          const cartCountElements = document.querySelectorAll(".cart-count, #cart-count, #cart-count-mobile");
          cartCountElements.forEach(element => {
            if (element.textContent !== totalItems.toString()) {
              element.textContent = totalItems;
              element.style.display = totalItems > 0 ? "flex" : "none";
            }
          });
          
          // Update navbar cart count if available (only if needed)
          if (typeof window.navbarLoader !== "undefined" && window.navbarLoader.updateCartCount) {
            window.navbarLoader.updateCartCount();
          }
          
          // Update mobile navbar to ensure cart count is synced
          if (typeof updateMobileBottomNav === "function") {
            updateMobileBottomNav();
          }
          
          console.log("Cart count updated:", totalItems);
        }, 100); // Small delay to batch updates
      }
      
      // Optimized success message function
      let notificationTimeout = null;
      
      function showSuccessMessage(message) {
        // Remove existing notification if present
        const existingNotification = document.querySelector('.cart-notification');
        if (existingNotification) {
          existingNotification.remove();
        }
        
        // Clear existing timeout
        if (notificationTimeout) {
          clearTimeout(notificationTimeout);
        }
        
        // Create optimized notification
        const notification = document.createElement("div");
        notification.className = 'cart-notification';
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: linear-gradient(135deg, #25d366, #128c7e);
          color: white;
          padding: 15px 25px;
          border-radius: 10px;
          font-weight: 600;
          z-index: 10000;
          transform: translateX(0);
          box-shadow: 0 5px 20px rgba(37, 211, 102, 0.3);
          animation: slideIn 0.2s ease;
        `;
        notification.textContent = `âœ… ${message}`;
        
        // Add CSS animation
        if (!document.getElementById('cart-notification-styles')) {
          const style = document.createElement('style');
          style.id = 'cart-notification-styles';
          style.textContent = `
            @keyframes slideIn {
              from { transform: translateX(100%); }
              to { transform: translateX(0); }
            }
          `;
          document.head.appendChild(style);
        }
        
        document.body.appendChild(notification);
        
        // Auto-remove after 2 seconds (faster)
        notificationTimeout = setTimeout(() => {
          if (document.body.contains(notification)) {
            notification.remove();
          }
        }, 2000);
      }

      // Add related product to cart (for related products section)
      function addRelatedProductToCart(
        productId,
        productName,
        productPrice,
        productImage
      ) {
        console.log("=== addRelatedProductToCart called ===");

        const product = {
          id: productId,
          name: productName,
          price: productPrice,
          image: productImage,
          quantity: 1,
          added_at: new Date().toISOString(),
        };

        console.log("Adding related product:", product);

        try {
          // Use cart.js system if available
          if (typeof window.addToCart === "function") {
            console.log("Using cart.js addToCart function for related product");
            window.addToCart(product);
            console.log("âœ… Related product added to cart via cart.js!");
          } else {
            console.log(
              "cart.js not available, using fallback for related product"
            );

            // Fallback to direct localStorage
            const cartKey = window.currentUserId
              ? `cart_user_${window.currentUserId}`
              : "cart_guest";
            const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");

            // Check if item exists
            const existingIndex = cart.findIndex(
              (item) => item.id === product.id
            );

            if (existingIndex >= 0) {
              cart[existingIndex].quantity += 1;
              showNotification(`Updated ${product.name} quantity`, "success");
            } else {
              cart.push(product);
              showNotification(`${product.name} added to cart!`, "success");
            }

            // Save to localStorage
            localStorage.setItem(cartKey, JSON.stringify(cart));
            console.log("Cart saved:", cart);

            // Update cart UI
            if (typeof window.updateCartUI === "function") {
              window.updateCartUI();
            }

            // Update navbar cart count
            if (
              typeof window.navbarLoader !== "undefined" &&
              window.navbarLoader.updateCartCount
            ) {
              window.navbarLoader.updateCartCount();
            }

            console.log("âœ… Related product added to cart via fallback!");
          }
        } catch (error) {
          console.error("âŒ Add related product to cart failed:", error);
          showNotification("Failed to add related product to cart", "error");
        }
      }

      // Handle option button selection (color, size, etc.)
      function selectOption(optionType, value) {
        console.log(`Selecting ${optionType}: ${value}`);

        // Remove selected class from all buttons in the group
        const buttons = document.querySelectorAll(
          `#${optionType}-options .option-btn`
        );
        buttons.forEach((btn) => btn.classList.remove("selected"));

        // Add selected class to clicked button
        const selectedButton = document.querySelector(
          `#${optionType}-options .option-btn[data-value="${value}"]`
        );
        if (selectedButton) {
          selectedButton.classList.add("selected");
        }

        console.log(`${optionType} option selected: ${value}`);
      }

      // Add to wishlist
      function addToWishlist() {
        const wishlist = JSON.parse(
          localStorage.getItem("wishlistItems") || "[]"
        );

        const wishlistItem = {
          id: productData.id,
          name: productData.name,
          price: productData.price,
          image: productImages[currentImageIndex], // Use current image
        };

        wishlist.push(wishlistItem);
        localStorage.setItem("wishlistItems", JSON.stringify(wishlist));

        // Update wishlist count in navbar
        if (
          window.navbar &&
          typeof window.navbar.updateWishlistCount === "function"
        ) {
          window.navbar.updateWishlistCount();
        }

        showMessage("Product added to wishlist!", "success");
      }

      // Update cart count
      function updateCartCount() {
        const cartKey = window.currentUserId
          ? `cart_user_${window.currentUserId}`
          : "cart_guest";
        const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
        const cartCount = document.getElementById("cart-count");

        const totalItems = cart.reduce(
          (total, item) => total + item.quantity,
          0
        );
        cartCount.textContent = totalItems;
        cartCount.style.display = totalItems > 0 ? "flex" : "none";
      }

      // Legacy showMessage function for compatibility
      function showMessage(text, type) {
        return showNotification(text, type);
      }

      // Load reviews
      function loadReviews() {
        const reviewsContainer = document.getElementById("reviews-container");

        // Reviews will be loaded dynamically from database or API
        // For now, show a message that reviews are coming soon
        reviewsContainer.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: #999;">
            <i class="fas fa-comments" style="font-size: 2rem; margin-bottom: 15px; color: #25d366;"></i>
            <h4 style="margin-bottom: 10px; color: #25d366;">Customer Reviews</h4>
            <p>Reviews will be available soon. Be the first to review this product!</p>
            <button class="write-review-btn" onclick="writeReview()" style="margin-top: 15px;">
              <i class="fas fa-pen"></i>
              Write First Review
            </button>
          </div>
        `;
      }

      // Load related products
      async function loadRelatedProducts() {
        const relatedContainer = document.getElementById("related-products");

        // Add loading state
        relatedContainer.classList.add("loading");
        relatedContainer.style.position = "relative";

        try {
              // Fetch products from server
    const response = await fetch("/products");
          if (!response.ok) {
            throw new Error("Failed to load products.json");
          }

          const products = await response.json();

          // Get related products (excluding current product)
          const currentProductId = productData.id;
          const relatedProducts = products
            .filter((p) => p.id !== currentProductId)
            .slice(0, 4); // Get first 4 related products

          // Remove loading state
          relatedContainer.classList.remove("loading");

          if (relatedProducts.length === 0) {
            relatedContainer.innerHTML =
              '<div style="text-align: center; color: #999; padding: 40px 20px; grid-column: 1 / -1;">No related products found</div>';
            return;
          }

          relatedContainer.innerHTML = relatedProducts
            .map(
              (product) => `
                  <article class="related-item" role="gridcell" tabindex="0" 
                    aria-label="View ${product.name} - $${product.price.toFixed(
                2
              )}">
                      <img class="related-image" src="${product.image}" alt="${
                product.name
              }" loading="lazy" onclick="window.location.href='product-template.html?id=${
                product.id
              }'">
                      <div class="related-name" onclick="window.location.href='product-template.html?id=${
                        product.id
                      }'">${product.name}</div>
                      <div class="related-price">$${product.price.toFixed(
                        2
                      )}</div>
                      <button class="add-to-cart-btn-small" 
                        onclick="event.stopPropagation(); addRelatedProductToCart(${
                          product.id
                        }, '${product.name}', ${product.price}, '${
                product.image
              }')"
                        style="
                          background: linear-gradient(135deg, #25d366, #128c7e);
                          color: white;
                          border: none;
                          padding: 8px 12px;
                          border-radius: 8px;
                          font-size: 0.8rem;
                          font-weight: 600;
                          cursor: pointer;
                          transition: all 0.3s ease;
                          margin-top: 8px;
                          width: 100%;
                        "
                        onmouseover="this.style.background='linear-gradient(135deg, #128c7e, #25d366)'"
                        onmouseout="this.style.background='linear-gradient(135deg, #25d366, #128c7e)'">
                        <i class="fas fa-shopping-cart"></i> Add to Cart
                      </button>
                  </article>
              `
            )
            .join("");
        } catch (error) {
          console.error("Error loading related products:", error);

          // Remove loading state
          relatedContainer.classList.remove("loading");

          // Fallback related products
          const fallbackRelatedProducts = [
            {
              id: 2,
              name: "SY830 Gaming Headset",
              price: 69.99,
              image: "assets/images/H97ff2d0642fe4b1f8685204f9b958fc0L.jpg",
            },
            {
              id: 3,
              name: "Mobile Cooling Fan Dual",
              price: 24,
              image:
                "assets/images/products/cooling-fan/Hb4c9fce6b00741d6a70810063a439d54w.png_720x720q50.avif",
            },
            {
              id: 10,
              name: "Gaming Trigger Controller",
              price: 15,
              image:
                "assets/images/products/phone-mount/H71f88868c45744b88e471e0342d7877c0.jpg_720x720q50.avif",
            },
            {
              id: 11,
              name: "Twolf One Handed Keyboard",
              price: 19,
              image:
                "assets/images/products/gaming-keyboard/H66caee659ade4b2bb008bc38e4d24936t.jpg_720x720q50.avif",
            },
          ];

          relatedContainer.innerHTML = fallbackRelatedProducts
            .map(
              (product) => `
                  <article class="related-item" role="gridcell" tabindex="0" 
                    aria-label="View ${product.name} - $${product.price.toFixed(
                2
              )}">
                      <img class="related-image" src="${product.image}" alt="${
                product.name
              }" loading="lazy" onclick="window.location.href='product-template.html?id=${
                product.id
              }'">
                      <div class="related-name" onclick="window.location.href='product-template.html?id=${
                        product.id
                      }'">${product.name}</div>
                      <div class="related-price">$${product.price.toFixed(
                        2
                      )}</div>
                      <button class="add-to-cart-btn-small" 
                        onclick="event.stopPropagation(); addRelatedProductToCart(${
                          product.id
                        }, '${product.name}', ${product.price}, '${
                product.image
              }')"
                        style="
                          background: linear-gradient(135deg, #25d366, #128c7e);
                          color: white;
                          border: none;
                          padding: 8px 12px;
                          border-radius: 8px;
                          font-size: 0.8rem;
                          font-weight: 600;
                          cursor: pointer;
                          transition: all 0.3s ease;
                          margin-top: 8px;
                          width: 100%;
                        "
                        onmouseover="this.style.background='linear-gradient(135deg, #128c7e, #25d366)'"
                        onmouseout="this.style.background='linear-gradient(135deg, #25d366, #128c7e)'">
                        <i class="fas fa-shopping-cart"></i> Add to Cart
                      </button>
                  </article>
              `
            )
            .join("");
        }
      }

      // Utility functions
      function zoomImage() {
        const mainImage = document.getElementById("main-image");
        if (mainImage.style.transform === "scale(1.5)") {
          mainImage.style.transform = "scale(1)";
          mainImage.style.cursor = "zoom-in";
        } else {
          mainImage.style.transform = "scale(1.5)";
          mainImage.style.cursor = "zoom-out";
        }
      }

      function shareProduct() {
        if (navigator.share) {
          navigator.share({
            title: productData.name,
            text: productData.description,
            url: window.location.href,
          });
        } else {
          // Fallback: copy URL to clipboard
          navigator.clipboard.writeText(window.location.href);
          showMessage("Link copied to clipboard!", "success");
        }
      }

      function writeReview() {
        // This would open a review modal or redirect to review page
        showMessage("Review feature coming soon!", "success");
      }



      // Header scroll effect
      window.addEventListener("scroll", () => {
        const header = document.getElementById("header");
        if (!header) return;
        if (window.scrollY > 100) {
          header.classList.add("scrolled");
        } else {
          header.classList.remove("scrolled");
        }
      });

      // Navbar helper functions
      function toggleCart() {
        window.location.href = "cart.html";
      }

      function toggleWishlist() {
        // Show wishlist modal or redirect
        showMessage("Wishlist feature coming soon!", "success");
      }

      function toggleCompare() {
        // Show comparison modal
        showMessage("Product comparison coming soon!", "success");
      }

      function openLiveChat() {
        showMessage("Live chat feature coming soon!", "success");
      }

      function openFAQ() {
        window.open("faq.html", "_blank");
      }

      function openGuide() {
        window.open("guide.html", "_blank");
      }

      function openComparison() {
        showMessage("Product comparison feature coming soon!", "success");
      }

      // Mobile navbar functions
      function setActiveNavItem() {
        const currentPage = window.location.pathname;
        const navItems = document.querySelectorAll(
          ".mobile-bottom-navbar .nav-item"
        );

        navItems.forEach((item) => {
          item.classList.remove("active");
          const href = item.getAttribute("href");
          if (href && currentPage.includes(href.replace("../", ""))) {
            item.classList.add("active");
          }
        });
      }

      function showMobileNavbar() {
        const mobileNavbar = document.querySelector(".mobile-bottom-navbar");
        const mainNavbar = document.querySelector(".navbar");
        console.log(
          "showMobileNavbar called, window.innerWidth:",
          window.innerWidth
        );

        if (mobileNavbar) {
          // Show on mobile devices (tablets and phones)
          if (window.innerWidth <= 768) {
            mobileNavbar.style.display = "block";
            // Hide main navbar on mobile
            if (mainNavbar) {
              mainNavbar.style.display = "none";
            }
            setActiveNavItem();
            console.log("Mobile navbar displayed, main navbar hidden");

            // Add click event listeners to mobile navbar links
            const mobileNavLinks = mobileNavbar.querySelectorAll("a");
            mobileNavLinks.forEach((link) => {
              link.addEventListener("click", (e) => {
                console.log("Mobile nav link clicked:", link.href);
                // Allow default navigation
              });
            });
          } else {
            mobileNavbar.style.display = "none";
            // Show main navbar on desktop
            if (mainNavbar) {
              mainNavbar.style.display = "block";
            }
            console.log("Mobile navbar hidden, main navbar shown");
          }
        } else {
          console.log("Mobile navbar element not found");
        }
      }

      // Manual toggle function for testing
      function toggleMobileNavbar() {
        const mobileNavbar = document.querySelector(".mobile-bottom-navbar");
        if (mobileNavbar) {
          const currentDisplay = window.getComputedStyle(mobileNavbar).display;
          mobileNavbar.style.display =
            currentDisplay === "none" ? "block" : "none";
          console.log("Mobile navbar toggled to:", mobileNavbar.style.display);
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", async () => {
        console.log("DOMContentLoaded event fired");
        console.log("window.innerWidth:", window.innerWidth);

        await initializeProduct();
        updateCartCount();

        // Initialize mobile navbar - wait for navbar.js to load first
        console.log("Waiting for navbar component...");
        const waitForNavbar = setInterval(() => {
          if (window.navbar && typeof updateMobileBottomNav === 'function') {
            clearInterval(waitForNavbar);
            console.log("Navbar component ready, initializing mobile navbar...");
            
            // Use the navbar component's update system
            updateMobileBottomNav();
            
            // Also update the user area specifically
            if (typeof window.updateMobileNavDirect === 'function') {
              setTimeout(() => window.updateMobileNavDirect(), 500);
            }
            
            showMobileNavbar();
            window.addEventListener("resize", showMobileNavbar);
            console.log("Mobile navbar initialization complete");
          }
        }, 100);
        
        // Fallback timeout
        setTimeout(() => {
          clearInterval(waitForNavbar);
          if (!window.navbar) {
            console.log("Navbar component not found, using fallback initialization");
            showMobileNavbar();
            window.addEventListener("resize", showMobileNavbar);
          }
        }, 3000);

        // Handle page visibility changes to refresh mobile navbar
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden && window.navbar && typeof updateMobileBottomNav === 'function') {
            console.log("Page became visible, refreshing mobile navbar...");
            setTimeout(() => {
              updateMobileBottomNav();
              if (typeof window.updateMobileNavDirect === 'function') {
                window.updateMobileNavDirect();
              }
            }, 200);
          }
        });

        // Test mobile navbar element
        const mobileNavbar = document.querySelector(".mobile-bottom-navbar");
        console.log("Mobile navbar element found:", !!mobileNavbar);
        if (mobileNavbar) {
          console.log(
            "Mobile navbar current display:",
            mobileNavbar.style.display
          );
          console.log(
            "Mobile navbar computed display:",
            window.getComputedStyle(mobileNavbar).display
          );

          // Add manual toggle for testing (remove in production)
          window.toggleMobileNavbar = toggleMobileNavbar;
          console.log("Manual toggle available: window.toggleMobileNavbar()");
        }

        // Debug: Check for multiple navbar elements
        const allNavbars = document.querySelectorAll(
          "nav, .navbar, .mobile-bottom-navbar"
        );
        console.log("Total navbar elements found:", allNavbars.length);
        allNavbars.forEach((nav, index) => {
          console.log(
            `Navbar ${index + 1}:`,
            nav.className,
            nav.id,
            nav.style.display
          );
        });

        // Check existing authentication and sync navbar
        try {
          const {
            data: { user },
            error,
          } = await supabaseClient.auth.getUser();
          if (user) {
            console.log("âœ… User already logged in:", user.email);
            window.currentUserId = user.id;

            // Force navbar update with existing session
            if (
              typeof window.navbarLoader !== "undefined" &&
              window.navbarLoader.initializeUserAuth
            ) {
              await window.navbarLoader.initializeUserAuth();
              console.log("Navbar synced with existing user session");
            }
          } else {
            console.log("â„¹ï¸ No existing user session found");
          }
        } catch (error) {
          console.error("Error checking existing auth:", error);
        }

        // Force refresh navbar data (cart count, user area, etc.)
        setTimeout(async () => {
          if (
            typeof window.navbarLoader !== "undefined" &&
            window.navbarLoader.refreshNavbarData
          ) {
            await window.navbarLoader.refreshNavbarData();
            console.log("Navbar data refreshed (cart count, user area)");
          }
        }, 500);

        // Initialize navbar user area after a short delay to ensure navbar is loaded
        setTimeout(async () => {
          if (
            typeof window.navbarLoader !== "undefined" &&
            window.navbarLoader.initializeUserAuth
          ) {
            await window.navbarLoader.initializeUserAuth();
            console.log("Navbar user area initialized");
          }
        }, 1000);

        console.log("Page initialization complete");

        // Listen for cart changes and update navbar
        window.addEventListener("storage", function (e) {
          if (e.key && (e.key.includes("cart") || e.key.includes("user"))) {
            setTimeout(() => {
              if (
                typeof window.navbarLoader !== "undefined" &&
                window.navbarLoader.refreshNavbarData
              ) {
                window.navbarLoader.refreshNavbarData();
                console.log("Navbar updated due to storage change:", e.key);
              }
            }, 100);
          }
        });
      });
    </script>

    <!-- Unified Navbar Component -->
    <script>
      // Additional navbar initialization for product pages
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for navbar to load, then refresh data
        setTimeout(() => {
          if (window.navbarLoader && window.navbarLoader.refreshNavbarData) {
            window.navbarLoader.refreshNavbarData();
            console.log("Product page navbar data refreshed");
          }
        }, 1500);

        // Listen for localStorage changes
        window.addEventListener("storage", function (e) {
          if (
            e.key === "cart" ||
            e.key === "cart_guest" ||
            e.key === "user" ||
            e.key === "currentUser"
          ) {
            setTimeout(() => {
              if (
                window.navbarLoader &&
                window.navbarLoader.refreshNavbarData
              ) {
                window.navbarLoader.refreshNavbarData();
                console.log(
                  "Navbar updated due to localStorage change:",
                  e.key
                );
              }
            }, 100);
          }
        });
      });
    </script>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
      <div class="lightbox-content">
        <button class="lightbox-close" onclick="closeLightbox()">
          <i class="fas fa-times"></i>
        </button>
        <img
          class="lightbox-image"
          id="lightbox-image"
          src=""
          alt="Product Image"
        />
        <button
          class="lightbox-nav lightbox-prev"
          onclick="previousLightboxImage()"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
        <button
          class="lightbox-nav lightbox-next"
          onclick="nextLightboxImage()"
        >
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <!-- Add to Cart button handler (use delegated click to be resilient to re-renders)
    <script>
              // Attach the addToCart function to the button
      document.addEventListener("DOMContentLoaded", function () {
        var btn = document.getElementById("add-to-cart-btn");
        if (btn) {
            // Remove any existing event listeners to prevent duplicates
            btn.onclick = null;
            
            // Attach the addToCart function immediately
            btn.onclick = addToCartProductPage;
            console.log("Add to cart button event handler attached (delegates to cart.js)");
            
            // Add visual feedback
            btn.addEventListener("click", function() {
              console.log("Add to cart button clicked");
            });
          } else {
            console.log("Add to cart button not found");
          }
          
          // Debug: Check if cart system is loaded
          setTimeout(() => {
            console.log("=== Cart System Debug ===");
            console.log("window.addToCart:", typeof window.addToCart);
            console.log("window.cart:", window.cart);
            console.log("window.currentUserId:", window.currentUserId);
            console.log("window.loadCart:", typeof window.loadCart);
            
            // Check localStorage
            const cartKey = window.currentUserId ? `cart_user_${window.currentUserId}` : "cart_guest";
            const localStorageCart = JSON.parse(localStorage.getItem(cartKey) || "[]");
            console.log("LocalStorage cart key:", cartKey);
            console.log("LocalStorage cart:", localStorageCart);
          }, 2000);
        });
    </script> -->

    <script>
    (function () {
      // Provide a single, canonical add-to-cart flow for the product page
      // that defers to cart.js when ready, with a minimal safe fallback.

      // Build a normalized product object compatible with cart.js
      function buildProductFromTemplate() {
        try {
          const idRaw = (typeof productData?.id !== 'undefined') ? productData.id : undefined;
          const id = isNaN(Number(idRaw)) ? idRaw : Number(idRaw);
          const name = productData?.name || 'Product';
          const price = isNaN(Number(productData?.price)) ? 0 : Number(productData.price);
          const image = (Array.isArray(window.productImages) && window.productImages[window.currentImageIndex]) || productData?.image || '';

          let quantity = 1;
          const qtyEl = document.getElementById('quantity');
          if (qtyEl && qtyEl.value) quantity = Math.max(1, parseInt(qtyEl.value, 10) || 1);

          return { id, name, price, image, quantity, added_at: new Date().toISOString() };
        } catch (e) {
          console.warn('Failed to build product, using minimal fallback', e);
          return { id: productData?.id, name: productData?.name || 'Product', price: Number(productData?.price) || 0, image: productData?.image || '', quantity: 1, added_at: new Date().toISOString() };
        }
      }

      // Wait briefly for cart.js addToCart to become available
      function waitForCartAddFunction(deadlineMs = 1200, intervalMs = 100) {
        const start = performance.now();
        return new Promise((resolve) => {
          const step = () => {
            if (typeof window._mainAddToCart === 'function') return resolve(window._mainAddToCart);
            if (typeof window.addToCart === 'function' && window.addToCart !== window.addToCartProductPage) return resolve(window.addToCart);
            if (performance.now() - start >= deadlineMs) return resolve(null);
            setTimeout(step, intervalMs);
          };
          step();
        });
      }

      async function addToCartCanonical(evt) {
        try {
          if (evt) {
            evt.preventDefault?.();
            evt.stopPropagation?.();
            evt.stopImmediatePropagation?.();
          }

          // Build product payload
          const product = buildProductFromTemplate();
          const addFn = await waitForCartAddFunction();

          if (addFn) {
            // Delegate to cart.js so cart page stays in sync
            addFn(product);
            // Light-touch UI refresh if cart.js exposes it
            if (typeof window.updateCartUI === 'function') setTimeout(window.updateCartUI, 50);
            return;
          }

          // Minimal safe fallback to localStorage if cart.js not ready
          const userId = window.currentUserId;
          const cartKey = userId ? `cart_user_${userId}` : 'cart_guest';
          const cart = JSON.parse(localStorage.getItem(cartKey) || '[]');
          const idx = cart.findIndex((i) => i.id === product.id);
          if (idx >= 0) {
            cart[idx].quantity = Number(cart[idx].quantity || 0) + Number(product.quantity || 1);
          } else {
            cart.push(product);
          }
          localStorage.setItem(cartKey, JSON.stringify(cart));
          if (typeof window.updateCartUI === 'function') setTimeout(window.updateCartUI, 50);
        } catch (err) {
          console.error('addToCartCanonical failed:', err);
          alert('Unable to add to cart. Please try again.');
        }
      }

      // Hijack CTA clicks in capture phase so this always runs even if others exist
      document.addEventListener('click', (e) => {
        const btn = e.target && e.target.closest && e.target.closest('#add-to-cart-btn');
        if (!btn) return;
        addToCartCanonical(e);
      }, true);

      // Expose for debugging if needed
      window.addToCartCanonical = addToCartCanonical;
    })();
    </script>
    
    <!-- Order Guarantee Modal -->
    <div id="orderGuaranteeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
      <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 16px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
        <button onclick="closeOrderGuaranteeModal()" style="position: absolute; top: 12px; right: 12px; background: transparent; border: none; color: #999; font-size: 24px; cursor: pointer; z-index: 1;">Ã—</button>
        <div style="padding: 24px;">
          <h2 style="color: #25d366; margin: 0 0 20px 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-shield-alt"></i>
            Order Guarantee
          </h2>
          
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(37, 211, 102, 0.1); border-radius: 8px; border-left: 3px solid #25d366;">
              <i class="fas fa-undo" style="color: #25d366; margin-top: 2px;"></i>
              <div>
                <h3 style="color: #fff; margin: 0 0 4px 0; font-size: 1rem;">30-Day Return Policy</h3>
                <p style="color: #ccc; margin: 0; font-size: 0.9rem;">Return any item within 30 days for a full refund. No questions asked.</p>
              </div>
            </div>
            
            <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(37, 211, 102, 0.1); border-radius: 8px; border-left: 3px solid #25d366;">
              <i class="fas fa-truck" style="color: #25d366; margin-top: 2px;"></i>
              <div>
                <h3 style="color: #fff; margin: 0 0 4px 0; font-size: 1rem;">Free Shipping Protection</h3>
                <p style="color: #ccc; margin: 0; font-size: 0.9rem;">If your order is lost or damaged during shipping, we'll replace it at no cost.</p>
              </div>
            </div>
            
            <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(37, 211, 102, 0.1); border-radius: 8px; border-left: 3px solid #25d366;">
              <i class="fas fa-award" style="color: #25d366; margin-top: 2px;"></i>
              <div>
                <h3 style="color: #fff; margin: 0 0 4px 0; font-size: 1rem;">Quality Assurance</h3>
                <p style="color: #ccc; margin: 0; font-size: 0.9rem;">All products are tested and verified before shipping. Defective items replaced immediately.</p>
              </div>
            </div>
            
            <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(37, 211, 102, 0.1); border-radius: 8px; border-left: 3px solid #25d366;">
              <i class="fas fa-headset" style="color: #25d366; margin-top: 2px;"></i>
              <div>
                <h3 style="color: #fff; margin: 0 0 4px 0; font-size: 1rem;">24/7 Customer Support</h3>
                <p style="color: #ccc; margin: 0; font-size: 0.9rem;">Our support team is available around the clock to help with any issues.</p>
              </div>
            </div>
            
            <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(37, 211, 102, 0.1); border-radius: 8px; border-left: 3px solid #25d366;">
              <i class="fas fa-lock" style="color: #25d366; margin-top: 2px;"></i>
              <div>
                <h3 style="color: #fff; margin: 0 0 4px 0; font-size: 1rem;">Secure Payment Protection</h3>
                <p style="color: #ccc; margin: 0; font-size: 0.9rem;">Your payment information is encrypted and protected. We never store your card details.</p>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 20px; padding: 16px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center;">
            <p style="color: #25d366; margin: 0; font-weight: 600; font-size: 0.9rem;">
              <i class="fas fa-check-circle" style="margin-right: 6px;"></i>
              Shop with confidence - Your satisfaction is our priority!
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      function openOrderGuaranteeModal() {
        document.getElementById('orderGuaranteeModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
      
      function closeOrderGuaranteeModal() {
        document.getElementById('orderGuaranteeModal').style.display = 'none';
        document.body.style.overflow = 'auto';
      }
      
      // Close modal when clicking outside
      document.getElementById('orderGuaranteeModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeOrderGuaranteeModal();
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeOrderGuaranteeModal();
        }
      });
    </script>
  </body>
</html>
