<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Become an Affiliate - MobileGaming</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
      body { background: #101010; color: #fff; }
      .container { max-width: 900px; margin: 40px auto; padding: 20px; }
      .card { background:#181818; border:1px solid #333; border-radius:16px; padding:24px; }
      .title { font-size: 1.8rem; font-weight: 800; margin-bottom: 8px; }
      .subtitle { color:#ccc; margin-bottom: 18px; }
      .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
      .form-group { margin-bottom: 14px; }
      label { display:block; margin-bottom:6px; color:#25d366; font-weight:600; }
      input, textarea, select { width:100%; padding:12px 14px; background:#23272b; border:1.5px solid #333; border-radius:8px; color:#fff; }
      button { padding:12px 18px; border-radius:10px; border:none; background: linear-gradient(135deg, #25d366, #128c7e); color:#111; font-weight:800; cursor:pointer; }
      .note { color:#aaa; font-size:0.95rem; }
      .success { color:#25d366; margin-top: 10px; }
      .error { color:#ff4757; margin-top: 10px; }
      .cta-row { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
      .pill { background:#222; border:1px solid #333; padding:8px 12px; border-radius:999px; color:#ccc; font-size:0.9rem; }
      @media (max-width: 680px) { .grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="cta-row">
        <a href="index.html" class="pill"><i class="fas fa-arrow-left"></i> Back to Home</a>
        <a href="profile.html" class="pill"><i class="fas fa-user"></i> Profile</a>
      </div>
      <div class="card">
        <div class="title">Become an Affiliate</div>
        <div class="subtitle">Earn commissions by promoting MobileGaming. Submit your application below.</div>
        <form id="affiliate-form">
          <div class="grid">
            <div class="form-group">
              <label for="full_name">Full Name</label>
              <input id="full_name" name="full_name" required />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" required />
            </div>
          </div>
          <div class="grid">
            <div class="form-group">
              <label for="social_handle">Primary Social/Channel</label>
              <input id="social_handle" name="social_handle" placeholder="@yourhandle or channel URL" required />
            </div>
            <div class="form-group">
              <label for="audience_size">Audience Size</label>
              <input id="audience_size" name="audience_size" placeholder="e.g. 15,000" />
            </div>
          </div>
          <div class="form-group">
            <label for="website">Website (optional)</label>
            <input id="website" name="website" placeholder="https://..." />
          </div>
          <div class="form-group">
            <label for="promo_plan">How will you promote us?</label>
            <textarea id="promo_plan" name="promo_plan" rows="4" required></textarea>
          </div>
          <div class="form-group">
            <label for="preferred_code">Preferred Referral Code (optional)</label>
            <input id="preferred_code" name="preferred_code" placeholder="e.g. MAXXI" />
          </div>
          <button type="submit" id="submit-btn"><i class="fas fa-paper-plane"></i> Submit Application</button>
          <div id="status" class="note"></div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      const SUPABASE_URL = "https://kokntkhxkymllafuubun.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtva250a2h4a3ltbGxhZnV1YnVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3NzYxODcsImV4cCI6MjA2ODM1MjE4N30.Ekc6HLszFSYTIgsvzTdKJWr85nFMUH2HQBQrg_uqXRc";
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      document.getElementById('affiliate-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submit-btn');
        const status = document.getElementById('status');
        status.textContent = '';
        btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
        try {
          const form = new FormData(e.target);
          const payload = {
            full_name: form.get('full_name').trim(),
            email: form.get('email').trim(),
            social_handle: form.get('social_handle').trim(),
            audience_size: form.get('audience_size').trim(),
            website: form.get('website').trim(),
            promo_plan: form.get('promo_plan').trim(),
            preferred_code: form.get('preferred_code').trim() || null
          };
          const res = await fetch('/affiliates/apply', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if(!res.ok){ throw new Error(data.error || 'Submission failed'); }
          status.className = 'success';
          status.textContent = 'Application submitted! We will review and email you.';
          e.target.reset();
        } catch (err) {
          status.className = 'error';
          status.textContent = err.message;
        } finally {
          btn.disabled = false; btn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Application';
        }
      });
    </script>
  </body>
</html>
