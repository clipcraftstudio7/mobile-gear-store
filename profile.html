<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile | Mobile Gear Hub</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="assets/js/messages.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #111;
        color: white;
        line-height: 1.6;
      }

      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(10px);
        padding: 15px 40px;
        z-index: 1000;
        border-bottom: 1px solid #333;
        transition: all 0.3s ease;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
      }

      .navbar.scrolled {
        background: rgba(10, 10, 10, 0.98);
        backdrop-filter: blur(15px);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
      }

      .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
      }

      .nav-left {
        flex: 1;
      }

      .nav-right {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .nav-logo a {
        font-size: 1.8rem;
        font-weight: 800;
        color: #25d366;
        text-decoration: none;
      }

      .nav-logo a:hover {
        color: #128c7e;
      }

      .profile-container {
        max-width: 1400px;
        margin: 100px auto 40px;
        padding: 0 20px;
        background: transparent;
      }

      .profile-grid {
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 25px;
        min-height: calc(100vh - 140px);
      }

      .profile-sidebar {
        background: linear-gradient(145deg, #1a1a1a, #222);
        border-radius: 20px;
        padding: 30px;
        border: 1px solid #333;
        height: fit-content;
        position: sticky;
        top: 120px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(15px);
        transition: all 0.3s ease;
      }

      .profile-sidebar:hover {
        border-color: #25d366;
        box-shadow: 0 15px 50px rgba(37, 211, 102, 0.1);
      }

      /* Side panel navigation */
      .side-nav {
        margin-top: 25px;
        border-top: 1px solid #333;
        padding-top: 20px;
      }

      .side-nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        margin-bottom: 8px;
        border-radius: 10px;
        color: #ccc;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .side-nav-item:hover {
        background: rgba(37, 211, 102, 0.1);
        color: #25d366;
        transform: translateX(5px);
      }

      .side-nav-item.active {
        background: rgba(37, 211, 102, 0.15);
        color: #25d366;
        border-left: 3px solid #25d366;
      }

      .side-nav-item i {
        width: 20px;
        text-align: center;
      }

      .profile-main {
        background: linear-gradient(145deg, #1a1a1a, #222);
        border-radius: 20px;
        border: 1px solid #333;
        overflow: hidden;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        transition: all 0.3s ease;
      }

      .profile-tabs {
        display: flex;
        background: linear-gradient(145deg, #1f1f1f, #2a2a2a);
        border-bottom: 1px solid #333;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .profile-tabs::-webkit-scrollbar {
        display: none;
      }

      .profile-tab {
        flex: 1;
        min-width: 120px;
        padding: 18px 16px;
        text-align: center;
        background: transparent;
        border: none;
        color: #ccc;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
        white-space: nowrap;
        font-size: 0.9rem;
      }

      .profile-tab.active {
        color: #25d366;
        border-bottom-color: #25d366;
        background: rgba(37, 211, 102, 0.1);
        box-shadow: 0 2px 8px rgba(37, 211, 102, 0.2);
      }

      .profile-tab:hover {
        color: #25d366;
        background: rgba(37, 211, 102, 0.05);
        transform: translateY(-1px);
      }

      .tab-content {
        padding: 30px;
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .profile-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px 0;
      }

      .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #25d366, #128c7e);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        margin: 0 auto 15px;
        color: #111;
        box-shadow: 0 8px 24px rgba(37, 211, 102, 0.3);
        border: 3px solid rgba(37, 211, 102, 0.2);
        transition: all 0.3s ease;
      }

      .profile-avatar:hover {
        transform: scale(1.05);
        box-shadow: 0 12px 32px rgba(37, 211, 102, 0.4);
      }

      .profile-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 8px;
        color: #fff;
        background: linear-gradient(135deg, #25d366, #128c7e);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .profile-subtitle {
        color: #aaa;
        font-size: 1rem;
        opacity: 0.8;
      }

      .profile-form {
        display: grid;
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .form-group label {
        font-weight: 600;
        color: #ccc;
        font-size: 0.95rem;
      }

      .form-group input,
      .form-group textarea {
        padding: 14px 16px;
        border: 2px solid #333;
        border-radius: 12px;
        background: linear-gradient(145deg, #1f1f1f, #2a2a2a);
        color: #fff;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #25d366;
        background: linear-gradient(145deg, #2a2a2a, #333);
        box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1),
          inset 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.2);
      }

      .btn-primary {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: white;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #128c7e, #0d6b5f);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
      }

      .btn-secondary {
        background: transparent;
        color: #25d366;
        border: 2px solid #25d366;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.1);
      }

      .btn-secondary:hover {
        background: #25d366;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ff4757, #ff3742);
        color: white;
        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.2);
      }

      .btn-danger:hover {
        background: linear-gradient(135deg, #ff3742, #ff2d3a);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 71, 87, 0.3);
      }

      .profile-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 25px;
      }

      .profile-actions .btn {
        width: 100%;
        justify-content: flex-start;
        padding: 12px 16px;
        border-radius: 10px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .profile-actions .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .profile-actions .btn:hover::before {
        left: 100%;
      }

      .profile-actions .btn:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin: 25px 0;
      }

      .stat-card {
        background: linear-gradient(145deg, #1f1f1f, #2a2a2a);
        padding: 20px 16px;
        border-radius: 16px;
        text-align: center;
        border: 1px solid #333;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, #25d366, #128c7e);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(37, 211, 102, 0.1);
        border-color: #25d366;
      }

      .stat-card:hover::before {
        opacity: 1;
      }

      .stat-card.clickable {
        cursor: pointer;
      }

      .stat-card.clickable:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(37, 211, 102, 0.2);
        border-color: #25d366;
      }

      .stat-card.clickable:active {
        transform: translateY(-1px);
      }

      .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        color: #25d366;
        margin-bottom: 4px;
        text-shadow: 0 2px 4px rgba(37, 211, 102, 0.3);
      }

      .stat-label {
        color: #aaa;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .message {
        padding: 12px 16px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }

      .message.success {
        background: rgba(37, 211, 102, 0.1);
        color: #25d366;
        border: 1px solid #25d366;
      }

      .message.error {
        background: rgba(255, 71, 87, 0.1);
        color: #ff4757;
        border: 1px solid #ff4757;
      }

      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .order-item {
        background: #222;
        border-radius: 12px;
        padding: 18px 20px;
        margin-bottom: 18px;
        border: 1px solid #333;
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .order-id {
        font-weight: 600;
        color: #25d366;
      }

      .order-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .order-status.delivered {
        background: rgba(37, 211, 102, 0.2);
        color: #25d366;
      }

      .order-status.shipped {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
      }

      .order-status.pending {
        background: rgba(255, 71, 87, 0.2);
        color: #ff4757;
      }

      .order-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        color: #ccc;
        font-size: 0.9rem;
      }

      .order-actions {
        display: flex;
        gap: 10px;
      }

      .settings-section {
        margin-bottom: 30px;
      }

      .settings-section h3 {
        color: #25d366;
        margin-bottom: 15px;
        font-size: 1.1rem;
      }

      .setting-item {
        margin-bottom: 12px;
      }

      .setting-item label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        color: #ccc;
        font-size: 0.95rem;
      }

      .setting-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #25d366;
      }

      @media (max-width: 1024px) {
        .profile-grid {
          grid-template-columns: 280px 1fr;
          gap: 20px;
        }

        .profile-sidebar {
          padding: 20px;
        }

        .profile-tab {
          padding: 16px 12px;
          font-size: 0.85rem;
        }
      }

      /* Hide mobile elements by default */
      .mobile-side-panel {
        display: none;
        position: fixed;
        top: 0;
        left: -280px;
        width: 280px;
        height: 100vh;
        background: linear-gradient(145deg, #1a1a1a, #222);
        border-right: 1px solid #333;
        z-index: 10000;
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
        padding: 20px;
        will-change: left;
      }

      .mobile-side-panel-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          visibility 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        background: #25d366;
        border: none;
        color: #111;
        padding: 12px;
        border-radius: 50%;
        cursor: pointer;
        z-index: 10001;
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
      }

      @media (max-width: 768px) {
        .profile-container {
          margin: 80px 15px 30px;
          padding: 0;
        }

        .profile-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .profile-sidebar {
          position: static;
          top: auto;
          order: 2;
          display: none; /* Hide desktop sidebar on mobile */
        }

        .profile-main {
          order: 1;
        }

        .profile-tabs {
          flex-wrap: wrap;
        }

        .profile-tab {
          min-width: 100px;
          padding: 14px 10px;
          font-size: 0.8rem;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .profile-actions {
          flex-direction: row;
          flex-wrap: wrap;
          gap: 8px;
        }

        .profile-actions .btn {
          width: auto;
          flex: 1;
          min-width: 120px;
        }

        /* Show mobile toggle button on mobile */
        .mobile-menu-toggle {
          display: block;
        }

        /* Mobile side panel styles */
        .mobile-side-panel {
          display: block;
        }

        .mobile-side-panel.open {
          left: 0;
        }

        .mobile-side-panel-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 30px;
          padding-bottom: 20px;
          border-bottom: 1px solid #333;
        }

        .mobile-side-panel-close {
          background: none;
          border: none;
          color: #fff;
          font-size: 24px;
          cursor: pointer;
          padding: 5px;
        }

        .mobile-side-panel-overlay {
          display: block;
        }

        .mobile-side-panel-overlay.open {
          opacity: 1;
          visibility: visible;
        }

        .mobile-side-nav-item {
          display: flex;
          align-items: center;
          gap: 15px;
          padding: 15px 20px;
          margin-bottom: 10px;
          border-radius: 12px;
          color: #ccc;
          text-decoration: none;
          transition: all 0.3s ease;
          cursor: pointer;
          font-size: 1rem;
        }

        .mobile-side-nav-item:hover {
          background: rgba(37, 211, 102, 0.1);
          color: #25d366;
          transform: translateX(5px);
        }

        .mobile-side-nav-item.active {
          background: rgba(37, 211, 102, 0.15);
          color: #25d366;
          border-left: 3px solid #25d366;
        }

        .mobile-side-nav-item i {
          width: 24px;
          text-align: center;
          font-size: 1.1rem;
        }
      }

      @media (max-width: 480px) {
        .profile-container {
          margin: 60px 8px 20px;
          padding: 0;
        }

        .profile-grid {
          gap: 15px;
        }

        .profile-sidebar {
          padding: 15px;
          border-radius: 12px;
        }

        .profile-header {
          margin-bottom: 20px;
          padding: 15px 0;
        }

        .profile-avatar {
          width: 80px;
          height: 80px;
          font-size: 2rem;
          margin-bottom: 12px;
        }

        .profile-title {
          font-size: 1.4rem;
          margin-bottom: 6px;
        }

        .profile-subtitle {
          font-size: 0.9rem;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
          margin: 20px 0;
        }

        .stat-card {
          padding: 12px 8px;
          border-radius: 10px;
        }

        .stat-number {
          font-size: 1.4rem;
          margin-bottom: 3px;
        }

        .stat-label {
          font-size: 0.75rem;
        }

        .profile-actions {
          flex-direction: column;
          gap: 8px;
          margin-top: 20px;
        }

        .profile-actions .btn {
          width: 100%;
          padding: 12px 16px;
          font-size: 0.85rem;
        }

        .profile-tabs {
          flex-wrap: wrap;
        }

        .profile-tab {
          min-width: 80px;
          padding: 12px 8px;
          font-size: 0.75rem;
        }

        .tab-content {
          padding: 15px;
        }

        .form-group input,
        .form-group textarea {
          padding: 12px 14px;
          font-size: 0.9rem;
        }

        .btn {
          padding: 10px 16px;
          font-size: 0.85rem;
        }

        .order-item {
          padding: 12px;
          margin-bottom: 10px;
        }

        .order-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 6px;
        }

        .order-actions {
          flex-direction: column;
          gap: 6px;
        }

        /* Side navigation mobile styles */
        .side-nav {
          margin-top: 20px;
          padding-top: 15px;
        }

        .side-nav-item {
          padding: 10px 12px;
          font-size: 0.9rem;
        }

        .side-nav-item i {
          width: 16px;
          font-size: 0.9rem;
        }

        /* Mobile navbar improvements */
        .navbar {
          padding: 10px 15px !important;
        }

        .nav-container {
          max-width: 100% !important;
        }

        .nav-logo a {
          font-size: 1.4rem !important;
        }

        .search-container {
          margin: 0 15px !important;
        }

        .search-input {
          padding: 8px 16px 8px 40px !important;
          font-size: 14px !important;
        }

        .search-icon {
          left: 12px !important;
          font-size: 16px !important;
        }
      }

      @media (max-width: 900px) {
        .profile-sidebar {
          position: fixed;
          top: 0;
          left: 0;
          height: 100vh;
          width: 80vw;
          max-width: 320px;
          background: linear-gradient(145deg, #1a1a1a, #222);
          z-index: 2000;
          box-shadow: 2px 0 24px rgba(0, 0, 0, 0.25);
          transform: translateX(-100%);
          transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          display: block;
          overflow-y: auto;
        }
        .profile-sidebar.open {
          transform: translateX(0);
        }
        .close-sidebar-btn {
          display: block !important;
          position: absolute;
          top: 18px;
          right: 18px;
          background: none;
          border: none;
          color: #fff;
          font-size: 1.5rem;
          z-index: 2100;
          cursor: pointer;
        }
        .mobile-sidebar-toggle {
          display: flex !important;
          align-items: center;
          justify-content: center;
          position: fixed;
          top: 18px;
          left: 18px;
          z-index: 2101;
          background: #181c1b;
          border-radius: 8px;
          width: 44px;
          height: 44px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.13);
          color: #25d366;
          font-size: 1.6rem;
          border: none;
          cursor: pointer;
        }
        .profile-grid {
          grid-template-columns: 1fr !important;
        }
        .profile-sidebar:not(.open) {
          pointer-events: none;
        }
      }
      /* Remove loose/redundant max-width: none for .footer-section in mobile queries */
      @media (max-width: 768px) {
        .footer-section {
          text-align: center;
          /* max-width: none; <-- removed */
        }
      }
    </style>

    <!-- Footer Styles - Enhanced with Color Theme (Desktop & Mobile) -->
    <style>
      .footer {
        background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
        border-top: 1px solid #333;
        margin-top: 60px;
        padding: 40px 0 20px;
      }

      .footer-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 60px;
        align-items: start;
      }

      .footer-section {
        text-align: left;
      }

      @media (max-width: 1024px) {
        .footer-container {
          grid-template-columns: repeat(2, 1fr);
          gap: 40px;
        }
      }

      .footer-section h3 {
        color: #25d366;
        margin-bottom: 15px;
        font-size: 1.3rem;
        font-weight: 700;
      }

      .footer-section h4 {
        color: #25d366;
        margin-bottom: 15px;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .footer-section p {
        color: #ccc;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .social-links {
        display: flex;
        gap: 15px;
        justify-content: flex-start;
      }

      .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: white;
        border-radius: 50%;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 18px;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.2);
      }

      .social-link:hover {
        background: linear-gradient(135deg, #128c7e, #0d6b5f);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
      }

      .contact-info {
        margin-top: 20px;
      }

      .email-link {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #ccc;
        text-decoration: none;
        transition: color 0.3s ease;
        font-size: 0.9rem;
        padding: 8px 0;
      }

      .email-link:hover {
        color: #25d366;
        transform: translateX(5px);
      }

      .email-link i {
        color: #25d366;
        font-size: 1rem;
      }

      .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .footer-links li {
        margin-bottom: 12px;
      }

      .footer-links a {
        color: #ccc;
        text-decoration: none;
        transition: all 0.3s ease;
        padding: 5px 0;
        display: inline-block;
        position: relative;
      }

      .footer-links a:hover {
        color: #25d366;
        transform: translateX(5px);
      }

      .footer-links a::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: 0;
        left: 0;
        background: linear-gradient(135deg, #25d366, #128c7e);
        transition: width 0.3s ease;
      }

      .footer-links a:hover::after {
        width: 100%;
      }

      .footer-bottom {
        border-top: 1px solid #333;
        margin-top: 30px;
        padding-top: 20px;
      }

      .footer-bottom-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .footer-bottom p {
        color: #999;
        margin: 0;
        font-size: 0.9rem;
      }

      .payment-methods {
        display: flex;
        gap: 15px;
        color: #666;
        font-size: 1.4rem;
      }

      .payment-methods i {
        transition: all 0.3s ease;
        padding: 8px;
        border-radius: 8px;
        background: rgba(37, 211, 102, 0.1);
      }

      .payment-methods i:hover {
        color: #25d366;
        background: rgba(37, 211, 102, 0.2);
        transform: translateY(-2px);
      }

      @media (max-width: 768px) {
        .footer {
          padding: 30px 0 15px;
        }

        .footer-container {
          display: grid;
          grid-template-columns: 1fr;
          gap: 25px;
          padding: 0 15px;
          text-align: center;
        }

        .footer-section {
          max-width: none;
          text-align: center;
        }

        .footer-bottom-content {
          flex-direction: column;
          text-align: center;
          padding: 0 15px;
        }

        .social-links {
          justify-content: center;
        }

        .social-link {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }
      }

      /* Gamification Styles */
      .gamification-card {
        background: linear-gradient(135deg, #2a1a3a 0%, #3a2a4a 100%);
        border: 1px solid #4a3a5a;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
      }

      .gamification-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
      }

      .points-display {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .points-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: conic-gradient(#25d366 0deg, #25d366 252deg, #333 252deg);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .points-circle::before {
        content: '';
        position: absolute;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: #1a1a1a;
      }

      .points-text {
        position: relative;
        z-index: 1;
        font-weight: bold;
        color: #25d366;
        font-size: 0.9rem;
      }

      .level-badge {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-weight: bold;
        font-size: 0.8rem;
      }

      .progress-bar {
        background: #333;
        height: 6px;
        border-radius: 3px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #25d366, #00d4aa);
        width: 70%;
        transition: width 0.3s ease;
      }

      .achievements {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 12px;
        margin-top: 15px;
      }

      .achievement {
        background: rgba(37, 211, 102, 0.1);
        border: 1px solid rgba(37, 211, 102, 0.3);
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .achievement:hover {
        transform: translateY(-3px);
      }

      .achievement.unlocked {
        background: rgba(37, 211, 102, 0.2);
        border-color: #25d366;
      }

      .achievement.unlocked .achievement-icon {
        color: #25d366;
      }

      .achievement.locked .achievement-icon {
        color: #666;
      }

      .achievement-icon {
        font-size: 1.5rem;
        margin-bottom: 8px;
        display: block;
      }

      .behavioral-section {
        background: linear-gradient(135deg, #1a2a3a 0%, #2a3a4a 100%);
        border: 1px solid #3a4a5a;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .user-type-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 15px;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 0.9rem;
      }

      .user-type-new {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
        color: white;
      }

      .user-type-returning {
        background: linear-gradient(45deg, #45b7d1, #96c93d);
        color: white;
      }

      .user-type-vip {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        color: white;
      }

      .recommendations {
        margin-top: 15px;
      }

      .recommendation-item {
        background: rgba(69, 183, 209, 0.1);
        border: 1px solid rgba(69, 183, 209, 0.3);
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .recommendation-icon {
        color: #45b7d1;
        font-size: 1.2rem;
      }

      /* Exit Intent Popup Styles */
      .exit-intent-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .popup-content {
        background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        border-radius: 20px;
        padding: 40px;
        max-width: 500px;
        width: 90%;
        border: 1px solid #333;
        position: relative;
        text-align: center;
        animation: popupSlideIn 0.3s ease-out;
      }
      
      @keyframes popupSlideIn {
        from {
          opacity: 0;
          transform: scale(0.8) translateY(-50px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      
      .close-popup {
        position: absolute;
        top: 15px;
        right: 20px;
        background: none;
        border: none;
        color: #ccc;
        font-size: 2rem;
        cursor: pointer;
        transition: color 0.3s ease;
      }
      
      .close-popup:hover {
        color: #ff4757;
      }
      
      .popup-header h2 {
        color: #25d366;
        margin-bottom: 10px;
        font-size: 1.8rem;
      }
      
      .popup-header p {
        color: #ccc;
        margin-bottom: 20px;
      }
      
      .discount-code {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        font-size: 1.2rem;
        font-weight: bold;
      }
      
      .popup-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
      }
      
      .popup-actions .btn {
        flex: 1;
        max-width: 150px;
        background: linear-gradient(45deg, #25d366, #00d4aa);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      
      .popup-actions .btn:hover {
        transform: translateY(-2px);
      }
      
      .popup-actions .btn-secondary {
        background: linear-gradient(45deg, #666, #888);
      }

      @media (max-width: 480px) {
        .footer {
          padding: 20px 0 10px;
        }

        .footer-container {
          gap: 20px;
          padding: 0 10px;
        }

        .footer-section h3 {
          font-size: 1.1rem;
        }

        .footer-section h4 {
          font-size: 1rem;
        }

        .footer-section p {
          font-size: 0.9rem;
        }

        .social-link {
          width: 35px;
          height: 35px;
          font-size: 14px;
        }

        .payment-methods {
          gap: 10px;
          font-size: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-left">
          <!-- Empty for now, can add logo later -->
        </div>
        <div class="nav-right">
          <a href="index.html" class="btn btn-secondary">
            <i class="fas fa-home"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>

    <!-- Mobile Back Home Button -->
    <div class="mobile-back-home">
      <a href="index.html" class="mobile-back-btn">
        <i class="fas fa-home"></i>
        <span>Back Home</span>
      </a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileSidePanel()">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Mobile Side Panel Overlay -->
    <div
      class="mobile-side-panel-overlay"
      onclick="closeMobileSidePanel()"
    ></div>

    <!-- Mobile Side Panel -->
    <div class="mobile-side-panel" id="mobile-side-panel">
      <div class="mobile-side-panel-header">
        <h3 style="color: #25d366; margin: 0">Menu</h3>
        <button
          class="mobile-side-panel-close"
          onclick="closeMobileSidePanel()"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Mobile Stats -->
      <div class="stats-grid">
        <div
          class="stat-card clickable"
          onclick="showTab('orders'); closeMobileSidePanel();"
        >
          <div class="stat-number" id="mobile-orders-count">0</div>
          <div class="stat-label">Orders</div>
        </div>
        <div
          class="stat-card clickable"
          onclick="showTab('wishlist'); closeMobileSidePanel();"
        >
          <div class="stat-number" id="mobile-wishlist-count">0</div>
          <div class="stat-label">Wishlist</div>
        </div>
        <div
          class="stat-card clickable"
          onclick="showTab('messages'); closeMobileSidePanel();"
        >
          <div class="stat-number" id="mobile-messages-count">0</div>
          <div class="stat-label">Messages</div>
        </div>
        <div
          class="stat-card clickable"
          onclick="showTab('reviews'); closeMobileSidePanel();"
        >
          <div class="stat-number" id="mobile-reviews-count">0</div>
          <div class="stat-label">Reviews</div>
        </div>
      </div>

      <!-- Mobile Side Navigation -->
      <div class="side-nav">
        <div
          class="mobile-side-nav-item active"
          onclick="showTab('profile'); closeMobileSidePanel();"
        >
          <i class="fas fa-user-edit"></i>
          <span>Edit Profile</span>
        </div>
        <div
          class="mobile-side-nav-item"
          onclick="showTab('orders'); closeMobileSidePanel();"
        >
          <i class="fas fa-shopping-bag"></i>
          <span>My Orders</span>
        </div>
        <div
          class="mobile-side-nav-item"
          onclick="showTab('messages'); closeMobileSidePanel();"
        >
          <i class="fas fa-bell"></i>
          <span>Messages</span>
        </div>
        <div
          class="mobile-side-nav-item"
          onclick="showTab('wishlist'); closeMobileSidePanel();"
        >
          <i class="fas fa-heart"></i>
          <span>Wishlist</span>
        </div>
        <div
          class="mobile-side-nav-item"
          onclick="showTab('settings'); closeMobileSidePanel();"
        >
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </div>
      </div>
    </div>

    <div class="profile-container">
      <div class="profile-grid">
        <!-- Profile Sidebar -->
        <div class="profile-sidebar" id="profile-sidebar">
          <button
            class="close-sidebar-btn"
            id="close-sidebar-btn"
            style="display: none"
          >
            <i class="fas fa-times"></i>
          </button>
          <div class="profile-header">
            <div class="profile-avatar" id="profile-avatar">
              <i class="fas fa-user"></i>
            </div>
            <h1 class="profile-title" id="profile-name">My Profile</h1>
            <p class="profile-subtitle" id="profile-email">Loading...</p>
          </div>

          <!-- Gamification Section -->
          <div class="gamification-card">
            <h3 style="color: #25d366; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-trophy"></i> Gaming Profile
            </h3>
            
            <div class="points-display">
              <div class="points-circle">
                <span class="points-text" id="user-points">2,450</span>
              </div>
              <div>
                <div class="level-badge" id="user-level">Pro Gamer</div>
                <p style="color: #ccc; margin-top: 5px; font-size: 0.9rem;">Level 7</p>
              </div>
            </div>
            
            <div class="progress-section">
              <p style="color: #ccc; margin-bottom: 10px; font-size: 0.9rem;">Progress to next level</p>
              <div class="progress-bar">
                <div class="progress-fill" id="level-progress" style="width: 70%;"></div>
              </div>
              <p style="color: #25d366; font-size: 0.8rem; margin-top: 5px;">550 points to Level 8</p>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="stats-grid">
            <div class="stat-card clickable" onclick="showTab('orders')">
              <div class="stat-number" id="orders-count">0</div>
              <div class="stat-label">Orders</div>
            </div>
            <div class="stat-card clickable" onclick="showTab('wishlist')">
              <div class="stat-number" id="wishlist-count">0</div>
              <div class="stat-label">Wishlist</div>
            </div>
            <div class="stat-card clickable" onclick="showTab('messages')">
              <div class="stat-number" id="messages-count">0</div>
              <div class="stat-label">Messages</div>
            </div>
            <div class="stat-card clickable" onclick="showTab('reviews')">
              <div class="stat-number" id="reviews-count">0</div>
              <div class="stat-label">Reviews</div>
            </div>
          </div>

          <!-- Side Navigation -->
          <div class="side-nav">
            <div class="side-nav-item active" onclick="showTab('profile')">
              <i class="fas fa-user-edit"></i>
              <span>Edit Profile</span>
            </div>
            <div class="side-nav-item" onclick="showTab('orders')">
              <i class="fas fa-shopping-bag"></i>
              <span>My Orders</span>
            </div>
            <div class="side-nav-item" onclick="showTab('messages')">
              <i class="fas fa-bell"></i>
              <span>Messages</span>
            </div>
            <div class="side-nav-item" onclick="showTab('wishlist')">
              <i class="fas fa-heart"></i>
              <span>Wishlist</span>
            </div>
            <div class="side-nav-item" onclick="showTab('settings')">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </div>
          </div>
        </div>

        <!-- Profile Main Content -->
        <div class="profile-main">
          <div class="profile-tabs">
            <button class="profile-tab active" onclick="showTab('profile')">
              <i class="fas fa-user"></i> Profile
            </button>
            <button class="profile-tab" onclick="showTab('orders')">
              <i class="fas fa-shopping-bag"></i> Orders
            </button>
            <button class="profile-tab" onclick="showTab('messages')">
              <i class="fas fa-bell"></i> Messages
            </button>
            <button class="profile-tab" onclick="showTab('wishlist')">
              <i class="fas fa-heart"></i> Wishlist
            </button>
            <button class="profile-tab" onclick="showTab('settings')">
              <i class="fas fa-cog"></i> Settings
            </button>
            <button class="profile-tab" onclick="showTab('reviews')">
              <i class="fas fa-star"></i> Reviews
            </button>
            <button class="profile-tab" onclick="showTab('achievements')">
              <i class="fas fa-trophy"></i> Achievements
            </button>
            <button class="profile-tab" onclick="showTab('loyalty')">
              <i class="fas fa-medal"></i> Loyalty
            </button>
          </div>

          <!-- Tab Contents -->
          <div id="profile-tab" class="tab-content active">
            <form id="profile-form" class="profile-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="name">Full Name</label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    placeholder="Enter your full name"
                  />
                </div>
                <div class="form-group">
                  <label for="username">Username</label>
                  <input
                    type="text"
                    id="username"
                    name="username"
                    placeholder="Choose a username"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" readonly />
              </div>
              <div class="form-group">
                <label for="bio">Bio</label>
                <textarea
                  id="bio"
                  name="bio"
                  rows="3"
                  placeholder="Tell us about yourself..."
                ></textarea>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    placeholder="Enter your phone number"
                  />
                </div>
                <div class="form-group">
                  <label for="location">Location</label>
                  <input
                    type="text"
                    id="location"
                    name="location"
                    placeholder="Enter your location"
                  />
                </div>
              </div>
              <div class="profile-actions">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Save Changes
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="resetForm()"
                >
                  <i class="fas fa-undo"></i> Reset
                </button>
              </div>
              
              
              <div id="affiliate-panel" style="margin-top:16px;background:#222;border:1px solid #333;border-radius:12px;padding:14px;">
                <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
                  <div>
                    <div style="color:#25d366;font-weight:700;">Affiliate Program</div>
                    <div id="affiliate-status" style="color:#ccc;font-size:0.95rem;">Loading...</div>
                  </div>
                  <div>
                    <a href="affiliate.html" id="affiliate-apply-btn" class="btn btn-secondary">Apply to Become Affiliate</a>
                    <button id="copy-aff-link" class="btn btn-primary" style="display:none;">Copy Referral Link</button>
                  </div>
                </div>
              </div>
            </form>
          </div>

          <div id="orders-tab" class="tab-content">
            <h2>My Orders</h2>
            <div id="orders-list">
              <div class="order-item">
                <div class="order-header">
                  <div class="order-id">Order #12345</div>
                  <div class="order-status delivered">Delivered</div>
                </div>
                <div class="order-details">
                  <div class="order-date">March 15, 2024</div>
                  <div class="order-total">$89.99</div>
                </div>
                <div class="order-actions">
                  <button class="btn btn-secondary">View Details</button>
                  <button class="btn btn-primary">Track Order</button>
                </div>
              </div>
            </div>
          </div>

          <div id="messages-tab" class="tab-content">
            <h2 style="color: #25d366; margin-bottom: 18px">Messages</h2>
            <div id="messages-list">
              <!-- Messages will be loaded here -->
            </div>
          </div>

          <div id="wishlist-tab" class="tab-content">
            <h2>My Wishlist</h2>
            <div id="wishlist-items">
              <!-- Wishlist items will be loaded here -->
            </div>
          </div>

          <div id="settings-tab" class="tab-content">
            <h2>Account Settings</h2>
            <div class="settings-section">
              <h3>Notifications</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" checked /> Email notifications
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="checkbox" checked /> SMS notifications
                </label>
              </div>
              <div class="setting-item">
                <label> <input type="checkbox" /> Push notifications </label>
              </div>
            </div>
            <div class="settings-section">
              <h3>Privacy</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" checked /> Public profile
                </label>
              </div>
              <div class="setting-item">
                <label> <input type="checkbox" /> Show online status </label>
              </div>
            </div>
            <div class="profile-actions">
              <button class="btn btn-danger" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </div>
          </div>

          <div id="reviews-tab" class="tab-content">
            <h2 style="color: #25d366; margin-bottom: 18px">My Reviews</h2>
            <div id="reviews-list" style="color: #ccc">
              No reviews yet. Start reviewing products you've purchased!
            </div>
          </div>

          <div id="achievements-tab" class="tab-content">
            <h2 style="color: #25d366; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-trophy"></i> Achievements
            </h2>
            
            <!-- Behavioral Targeting Section -->
            <div class="behavioral-section">
              <div class="user-type-badge user-type-returning" id="behavioral-badge">
                Returning Gamer
              </div>
              
              <div class="recommendations">
                <h3 style="color: #45b7d1; margin-bottom: 15px;">Recommended for You</h3>
                
                <div class="recommendation-item">
                  <i class="fas fa-mobile-alt recommendation-icon"></i>
                  <div>
                    <strong>Mobile Gaming Setup</strong>
                    <p style="color: #ccc; font-size: 0.9rem;">Based on your controller purchases</p>
                  </div>
                </div>
                
                <div class="recommendation-item">
                  <i class="fas fa-snowflake recommendation-icon"></i>
                  <div>
                    <strong>Cooling Accessories</strong>
                    <p style="color: #ccc; font-size: 0.9rem;">Perfect for long gaming sessions</p>
                  </div>
                </div>
                
                <div class="recommendation-item">
                  <i class="fas fa-headset recommendation-icon"></i>
                  <div>
                    <strong>Audio Gear</strong>
                    <p style="color: #ccc; font-size: 0.9rem;">Complete your gaming setup</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Achievements Grid -->
            <div class="achievements">
              <div class="achievement unlocked">
                <i class="fas fa-shopping-cart achievement-icon"></i>
                <div>First Purchase</div>
              </div>
              <div class="achievement unlocked">
                <i class="fas fa-star achievement-icon"></i>
                <div>5-Star Review</div>
              </div>
              <div class="achievement unlocked">
                <i class="fas fa-fire achievement-icon"></i>
                <div>Hot Streak</div>
              </div>
              <div class="achievement locked">
                <i class="fas fa-crown achievement-icon"></i>
                <div>VIP Status</div>
              </div>
              <div class="achievement locked">
                <i class="fas fa-gem achievement-icon"></i>
                <div>Big Spender</div>
              </div>
              <div class="achievement locked">
                <i class="fas fa-shield-alt achievement-icon"></i>
                <div>Loyalty Master</div>
              </div>
            </div>
          </div>

          <div id="loyalty-tab" class="tab-content">
            <h2 style="color: #25d366; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-medal"></i> Loyalty Program
            </h2>
            
            <div class="gamification-card">
              <h3 style="color: #ff6b6b; margin-bottom: 15px;">VIP Status Progress</h3>
              <div class="progress-section">
                <p style="color: #ccc; margin-bottom: 10px;">$153 to VIP Status</p>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 85%; background: linear-gradient(90deg, #ff6b6b, #ff8e53);"></div>
                </div>
                <p style="color: #ff6b6b; font-size: 0.9rem; margin-top: 5px;">VIP Benefits: Free shipping, exclusive deals, early access</p>
              </div>
            </div>
            
            <div style="margin-top: 20px;">
              <h3 style="color: #25d366; margin-bottom: 15px;">Loyalty Rewards</h3>
              <div class="achievements">
                <div class="achievement unlocked">
                  <i class="fas fa-shipping-fast achievement-icon"></i>
                  <div>Free Shipping</div>
                </div>
                <div class="achievement unlocked">
                  <i class="fas fa-percentage achievement-icon"></i>
                  <div>5% Cashback</div>
                </div>
                <div class="achievement locked">
                  <i class="fas fa-gift achievement-icon"></i>
                  <div>Birthday Gift</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Exit Intent Popup -->
    <div id="exit-intent-popup" class="exit-intent-popup" style="display: none;">
      <div class="popup-content">
        <button class="close-popup" onclick="closeExitIntent()">&times;</button>
        <div class="popup-header">
          <h2> Wait! Don't Leave Empty Handed!</h2>
          <p>Get 15% off your next gaming setup!</p>
        </div>
        <div class="popup-body">
          <div class="discount-code">
            <span>Use code: <strong>GAMER15</strong></span>
          </div>
          <p>Join thousands of pro gamers who trust our gear!</p>
          <div class="popup-actions">
            <button class="btn" onclick="applyDiscount()">Claim Discount</button>
            <button class="btn btn-secondary" onclick="closeExitIntent()">Maybe Later</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add hamburger icon for mobile sidebar toggle -->
    <div
      class="mobile-sidebar-toggle"
      id="mobile-sidebar-toggle"
      style="display: none"
    >
      <i class="fas fa-bars"></i>
    </div>

    <script>
      let supabase;
      let currentUser;
      let ordersLoaded = false;

      // Initialize Supabase
      document.addEventListener("DOMContentLoaded", function () {
        if (typeof window.supabase !== "undefined") {
          supabase = window.supabase.createClient(
            "https://kokntkhxkymllafuubun.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtva250a2h4a3ltbGxhZnV1YnVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3NzYxODcsImV4cCI6MjA2ODM1MjE4N30.Ekc6HLszFSYTIgsvzTdKJWr85nFMUH2HQBQrg_uqXRc"
          );
          loadProfile();
        } else {
          showMessage("Supabase not loaded. Please refresh the page.", "error");
        }
      });

      async function loadProfile() {
        try {
          const {
            data: { user },
            error,
          } = await supabase.auth.getUser();

          if (error || !user) {
            window.location.href = "login.html";
            return;
          }

          currentUser = user;

          // Load profile data
          let { data: profile, error: profileError } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", user.id)
            .single();

          if (profileError && profileError.code === "PGRST116") {
            // Profile doesn't exist, create one
            console.log("Profile not found, creating new profile...");
            const { data: newProfile, error: createError } = await supabase
              .from("profiles")
              .insert([
                {
                  id: user.id,
                  email: user.email,
                  created_at: new Date().toISOString(),
                  updated_at: new Date().toISOString(),
                },
              ])
              .select()
              .single();

            if (createError) {
              console.error("Error creating profile:", createError);
              // Continue with empty profile
            } else {
              profile = newProfile;
            }
          } else if (profileError) {
            console.error("Error loading profile:", profileError);
          }

          // Populate form fields
          document.getElementById("email").value = user.email || "";
          document.getElementById("name").value = profile?.name || "";
          document.getElementById("username").value = profile?.username || "";
          document.getElementById("bio").value = profile?.bio || "";
          document.getElementById("phone").value = profile?.phone || "";
          document.getElementById("location").value = profile?.location || "";

          // Update profile display
          await updateProfileDisplay(user, profile);

          // Load affiliate status (by email)
          try {
            let affCode = null;
            try {
              const { data: aff } = await supabase
                .from('affiliates')
                .select('code,email')
                .eq('email', user.email)
                .maybeSingle();
              affCode = aff?.code || null;
            } catch {}
            const statusEl = document.getElementById('affiliate-status');
            const applyBtn = document.getElementById('affiliate-apply-btn');
            const copyBtn = document.getElementById('copy-aff-link');
            if (affCode){
              statusEl.textContent = `You are an active affiliate. Code: ${affCode}`;
              applyBtn.style.display = 'none';
              copyBtn.style.display = '';
              copyBtn.onclick = ()=>{
                const link = window.location.origin + '/index.html?ref=' + encodeURIComponent(affCode);
                navigator.clipboard.writeText(link).then(()=>{
                  alert('Referral link copied!');
                });
              };
            } else {
              statusEl.textContent = 'Not an affiliate yet. Apply below.';
              applyBtn.style.display = '';
              copyBtn.style.display = 'none';
            }
          } catch {}
        } catch (error) {
          console.error("Error loading profile:", error);
          showMessage("Error loading profile data.", "error");
        }
      }

      // Handle form submission
      document
        .getElementById("profile-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const form = e.target;
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.innerHTML;

          // Show loading state
          submitBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Saving...';
          submitBtn.disabled = true;
          form.classList.add("loading");

          try {
            const formData = new FormData(form);
            const profileData = {
              id: currentUser.id,
              name: formData.get("name"),
              username: formData.get("username"),
              bio: formData.get("bio"),
              phone: formData.get("phone"),
              location: formData.get("location"),
              updated_at: new Date().toISOString(),
            };

            const { error } = await supabase
              .from("profiles")
              .upsert(profileData);

            if (error) {
              throw error;
            }

            showMessage("Profile updated successfully!", "success");

            // Update avatar if name changed
            if (profileData.name) {
              const initials = profileData.name
                .split(" ")
                .map((n) => n[0])
                .join("")
                .toUpperCase();
              document.querySelector(".profile-avatar").innerHTML = initials;
            }
          } catch (error) {
            console.error("Error updating profile:", error);
            showMessage("Error updating profile. Please try again.", "error");
          } finally {
            // Reset button state
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            form.classList.remove("loading");
          }
        });

      function changePassword() {
        // Redirect to password change page or show modal
        showMessage("Password change feature coming soon!", "error");
      }

      async function logout() {
        try {
          const { error } = await supabase.auth.signOut();
          if (error) {
            throw error;
          }
          window.location.href = "index.html";
        } catch (error) {
          console.error("Error logging out:", error);
          showMessage("Error logging out. Please try again.", "error");
        }
      }

      function showMessage(message, type) {
        const container = document.getElementById("message-container");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${type}`;
        messageDiv.textContent = message;

        container.innerHTML = "";
        container.appendChild(messageDiv);

        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        }, 5000);
      }

      function showTab(tab) {
        // Hide all tab contents
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });

        // Remove active class from all tabs
        document.querySelectorAll(".profile-tab").forEach((tabBtn) => {
          tabBtn.classList.remove("active");
        });

        // Remove active class from all side nav items
        document.querySelectorAll(".side-nav-item").forEach((navItem) => {
          navItem.classList.remove("active");
        });

        // Remove active class from all mobile side nav items
        document
          .querySelectorAll(".mobile-side-nav-item")
          .forEach((navItem) => {
            navItem.classList.remove("active");
          });

        // Show selected tab content
        const selectedTab = document.getElementById(tab + "-tab");
        if (selectedTab) {
          selectedTab.classList.add("active");
        }

        // Add active class to selected tab button
        const selectedTabBtn = document.querySelector(
          `[onclick="showTab('${tab}')"]`
        );
        if (selectedTabBtn) {
          selectedTabBtn.classList.add("active");
        }

        // Load specific content based on tab
        if (tab === "orders" && !ordersLoaded) {
          loadOrders();
        } else if (tab === "messages") {
          loadMessages();
        } else if (tab === "wishlist") {
          loadWishlist();
        }
      }

      async function loadOrders() {
        if (!supabase || !currentUser) return;
        const ordersList = document.getElementById("orders-list");
        ordersList.innerHTML =
          '<div style="color:#aaa;">Loading orders...</div>';
        try {
          const { data: orders, error } = await supabase
            .from("orders")
            .select("*")
            .eq("user_id", currentUser.id)
            .order("created_at", { ascending: false });
          if (error) throw error;
          if (!orders || orders.length === 0) {
            ordersList.innerHTML =
              '<div style="color:#aaa;">No orders found.</div>';
            return;
          }
          ordersList.innerHTML = orders
            .map(
              (order) => `
            <div style="background:#222;border-radius:12px;padding:18px 20px;margin-bottom:18px;border:1px solid #333;">
              <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
                <div>
                  <div style="font-weight:600;color:#25d366;">Order #${
                    order.id
                  }</div>
                  <div style="color:#ccc;font-size:0.97em;">${new Date(
                    order.created_at
                  ).toLocaleString()}</div>
                  <div style="margin-top:6px;font-size:0.98em;">Status: <span style="color:${
                    order.status === "delivered"
                      ? "#25d366"
                      : order.status === "shipped"
                      ? "#fbbf24"
                      : "#ff4757"
                  };font-weight:600;">${order.status || "pending"}</span></div>
                </div>
                <div style="text-align:right;min-width:120px;">
                  <div style="font-weight:700;color:#fff;">$${
                    order.total?.toFixed(2) || "0.00"
                  }</div>
                  <button class="btn btn-secondary" style="margin-top:8px;" onclick="viewOrderDetails('${
                    order.id
                  }')">View Details</button>
                </div>
              </div>
            </div>
          `
            )
            .join("");
          ordersLoaded = true;
        } catch (err) {
          ordersList.innerHTML =
            '<div style="color:#ff4757;">Error loading orders.</div>';
        }
      }

      function viewOrderDetails(orderId) {
        showOrderDetailsModal();
        loadOrderDetails(orderId);
      }
      function showOrderDetailsModal() {
        document.getElementById("order-details-modal").style.display = "flex";
      }
      function closeOrderDetailsModal() {
        document.getElementById("order-details-modal").style.display = "none";
      }
      async function loadOrderDetails(orderId) {
        const body = document.getElementById("order-details-body");
        body.innerHTML = "Loading...";
        try {
          const { data: order, error } = await supabase
            .from("orders")
            .select("*")
            .eq("id", orderId)
            .single();
          if (error || !order) {
            body.innerHTML =
              '<div style="color:#ff4757;">Order not found.</div>';
            return;
          }
          // Render order details
          let productsHtml = "";
          if (order.items && Array.isArray(order.items)) {
            productsHtml = order.items
              .map(
                (item) => `
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
                <img src="${item.image || ""}" alt="${
                  item.name
                }" style="width:48px;height:48px;object-fit:cover;border-radius:8px;border:1px solid #333;" />
                <div style="flex:1;">
                  <div style="font-weight:600;">${item.name}</div>
                  <div style="color:#888;font-size:0.95em;">$${item.price.toFixed(
                    2
                  )} x ${item.quantity}</div>
                </div>
                <div style="font-weight:700;color:#25d366;">$${(
                  item.price * item.quantity
                ).toFixed(2)}</div>
              </div>
            `
              )
              .join("");
          }
          body.innerHTML = `
            <h3 style="color:#25d366;margin-bottom:10px;">Order #${
              order.id
            }</h3>
            <div style="color:#ccc;font-size:0.97em;margin-bottom:8px;">${new Date(
              order.created_at
            ).toLocaleString()}</div>
            <div style="margin-bottom:10px;font-size:0.98em;">Status: <span style="color:${
              order.status === "delivered"
                ? "#25d366"
                : order.status === "shipped"
                ? "#fbbf24"
                : "#ff4757"
            };font-weight:600;">${order.status || "pending"}</span></div>
            <div style="margin-bottom:14px;">Tracking: <span style="color:#fff;">${
              order.tracking_number || "N/A"
            }</span></div>
            <div style="margin-bottom:18px;">Shipping to:<br><span style="color:#fff;">${
              order.shipping?.full_name || ""
            }, ${order.shipping?.address || ""}, ${
            order.shipping?.city || ""
          }, ${order.shipping?.country || ""}, ${
            order.shipping?.postal_code || ""
          }</span></div>
            <div style="margin-bottom:18px;">Delivery: <span style="color:#25d366;">${
              order.shipping?.delivery_method || ""
            }</span></div>
            <div style="margin-bottom:18px;">Order Total: <span style="color:#25d366;font-weight:700;">$${
              order.total?.toFixed(2) || "0.00"
            }</span></div>
            <div style="margin-bottom:18px;"><strong>Products:</strong><br>${productsHtml}</div>
            <button class="btn btn-primary" style="width:100%;margin-top:10px;" onclick="openOrderMessages('${
              order.id
            }')"><i class="fas fa-comments"></i> Contact Seller</button>
            <div id="order-messages-section" style="margin-top:18px;display:none;"></div>
          `;
        } catch (err) {
          body.innerHTML =
            '<div style="color:#ff4757;">Error loading order details.</div>';
        }
      }
      function openOrderMessages(orderId) {
        const section = document.getElementById("order-messages-section");
        section.style.display = "";
        section.innerHTML = `
          <div style="margin-bottom:10px;font-weight:600;color:#25d366;">Messages with Seller</div>
          <div id="messages-list" style="max-height:220px;overflow-y:auto;background:#181818;border-radius:8px;padding:12px 10px 12px 10px;margin-bottom:10px;border:1px solid #333;"></div>
          <form id="send-message-form" style="display:flex;gap:8px;">
            <input type="text" id="message-input" placeholder="Type your message..." style="flex:1;padding:10px 12px;border-radius:8px;border:1.5px solid #333;background:#23272b;color:#fff;font-size:1rem;" autocomplete="off" />
            <button type="submit" class="btn btn-primary" style="padding:10px 18px;">Send</button>
          </form>
        `;
        loadOrderMessages(orderId);
        // Send message handler
        document.getElementById("send-message-form").onsubmit = async function (
          e
        ) {
          e.preventDefault();
          const input = document.getElementById("message-input");
          const msg = input.value.trim();
          if (!msg) return;
          input.value = "";
          await sendOrderMessage(orderId, msg);
          loadOrderMessages(orderId);
        };
        // Auto-refresh messages every 10 seconds
        if (window._orderMsgInterval) clearInterval(window._orderMsgInterval);
        window._orderMsgInterval = setInterval(
          () => loadOrderMessages(orderId),
          10000
        );
      }
      async function loadOrderMessages(orderId) {
        const list = document.getElementById("messages-list");
        if (!list) return;
        list.innerHTML = '<div style="color:#aaa;">Loading messages...</div>';
        try {
          const { data: messages, error } = await supabase
            .from("messages")
            .select("*")
            .eq("order_id", orderId)
            .order("timestamp", { ascending: true });
          if (error) throw error;
          if (!messages || messages.length === 0) {
            list.innerHTML = '<div style="color:#aaa;">No messages yet.</div>';
            return;
          }
          list.innerHTML = messages
            .map(
              (msg) => `
            <div style="display:flex;justify-content:${
              msg.sender_id === currentUser.id ? "flex-end" : "flex-start"
            };margin-bottom:6px;">
              <div style="background:${
                msg.sender_id === currentUser.id ? "#25d366" : "#333"
              };color:${
                msg.sender_id === currentUser.id ? "#111" : "#fff"
              };padding:8px 14px;border-radius:14px;max-width:70%;word-break:break-word;font-size:0.98em;">
                ${msg.message}
                <div style="font-size:0.85em;color:#aaa;margin-top:2px;text-align:right;">${new Date(
                  msg.timestamp
                ).toLocaleTimeString([], {
                  hour: "2-digit",
                  minute: "2-digit",
                })}</div>
              </div>
            </div>
          `
            )
            .join("");
          list.scrollTop = list.scrollHeight;
        } catch (err) {
          list.innerHTML =
            '<div style="color:#ff4757;">Error loading messages.</div>';
        }
      }
      async function sendOrderMessage(orderId, message) {
        if (!supabase || !currentUser) return;
        // For demo, assume seller_id is 'SELLER' (replace with real seller id if available)
        const sellerId = "SELLER";
        await supabase.from("messages").insert([
          {
            order_id: orderId,
            sender_id: currentUser.id,
            receiver_id: sellerId,
            message: message,
            timestamp: new Date().toISOString(),
          },
        ]);
      }

      // Load messages from Supabase
      async function loadMessages() {
        const messagesList = document.getElementById("messages-list");
        if (!messagesList) return;

        try {
          // Show loading state
          messagesList.innerHTML =
            '<div style="color:#ccc;text-align:center;padding:20px;">Loading messages...</div>';

          // Fetch messages from Supabase
          console.log("Loading messages for user:", currentUser.id);
          const { data: messages, error } = await supabase
            .from("messages")
            .select("*")
            .eq("receiver_id", currentUser.id)
            .order("created_at", { ascending: false });

          console.log("Messages found:", messages);
          console.log("Messages error:", error);

          if (error) {
            console.error("Error loading messages:", error);
            messagesList.innerHTML =
              '<div style="color:#ff4757;text-align:center;padding:20px;">Error loading messages. Please try again.</div>';
            return;
          }

          if (!messages || messages.length === 0) {
            messagesList.innerHTML = `
               <div style="color:#ccc;text-align:center;padding:40px;">
                 <i class="fas fa-inbox" style="font-size:3rem;margin-bottom:15px;opacity:0.5;"></i>
                 <p>No messages yet</p>
                 <p style="font-size:0.9rem;opacity:0.7;">You'll see important updates here</p>
               </div>
             `;
            return;
          }

          // Render messages
          messagesList.innerHTML = messages
            .map(
              (message) => `
             <div class="message-item" style="background:#222;border-radius:12px;padding:18px 20px;margin-bottom:15px;border:1px solid #333;">
               <div class="message-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                 <div class="message-sender" style="font-weight:600;color:#25d366;">
                   ${
                     message.sender_id === "admin" ||
                     message.sender_id === "SELLER" ||
                     message.sender_id ===
                       "b34bceb9-af1a-48f3-9460-f0d83d89b10b"
                       ? " Mobile Gear Hub"
                       : message.sender_id === currentUser.id
                       ? "You"
                       : "System"
                   }
                 </div>
                 <div class="message-date" style="font-size:0.8rem;color:#999;">
                   ${new Date(message.created_at).toLocaleDateString()}
                 </div>
               </div>
               <div class="message-content" style="color:#ccc;line-height:1.5;">
                 ${message.content}
               </div>
               <div class="message-type" style="margin-top:8px;">
                 <span style="background:rgba(37,211,102,0.2);color:#25d366;padding:4px 8px;border-radius:12px;font-size:0.7rem;">
                   ${message.message_type || "Notification"}
                 </span>
               </div>
             </div>
           `
            )
            .join("");
        } catch (error) {
          console.error("Error loading messages:", error);
          messagesList.innerHTML =
            '<div style="color:#ff4757;text-align:center;padding:20px;">Error loading messages. Please try again.</div>';
        }
      }

      // Load wishlist items
      function loadWishlist() {
        const wishlistItems = document.getElementById("wishlist-items");
        if (!wishlistItems) return;

        const wishlist = JSON.parse(
          localStorage.getItem("wishlistItems") || "[]"
        );

        if (wishlist.length === 0) {
          wishlistItems.innerHTML =
            '<div style="color:#ccc;">Your wishlist is empty.</div>';
          return;
        }

        wishlistItems.innerHTML = wishlist
          .map(
            (item) => `
           <div style="background:#222;border-radius:12px;padding:18px 20px;margin-bottom:18px;border:1px solid #333;">
             <div style="display:flex;align-items:center;gap:15px;">
               <img src="${item.image}" alt="${item.name}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;" />
               <div style="flex:1;">
                 <div style="font-weight:600;color:#fff;">${item.name}</div>
                 <div style="color:#25d366;font-weight:700;">$${item.price}</div>
               </div>
               <button class="btn btn-primary" onclick="addToCartFromWishlist('${item.id}')">
                 <i class="fas fa-shopping-cart"></i> Add to Cart
               </button>
               <button class="btn btn-danger" onclick="removeFromWishlist('${item.id}')">
                 <i class="fas fa-trash"></i>
               </button>
             </div>
           </div>
         `
          )
          .join("");
      }

      // Add to cart from wishlist
      function addToCartFromWishlist(itemId) {
        if (window.addToCart) {
          const wishlist = JSON.parse(
            localStorage.getItem("wishlistItems") || "[]"
          );
          const item = wishlist.find((w) => w.id === itemId);
          if (item) {
            window.addToCart(item);
            showMessage("Item added to cart!", "success");
          }
        }
      }

      // Remove from wishlist
      function removeFromWishlist(itemId) {
        const wishlist = JSON.parse(
          localStorage.getItem("wishlistItems") || "[]"
        );
        const updatedWishlist = wishlist.filter((w) => w.id !== itemId);
        localStorage.setItem("wishlistItems", JSON.stringify(updatedWishlist));
        loadWishlist();
        showMessage("Item removed from wishlist!", "success");
      }

      // Reset form
      function resetForm() {
        document.getElementById("profile-form").reset();
        showMessage("Form reset!", "success");
      }

      // Update profile display
      async function updateProfileDisplay(user, profile) {
        const profileName = document.getElementById("profile-name");
        const profileEmail = document.getElementById("profile-email");
        const profileAvatar = document.getElementById("profile-avatar");

        if (profileName) {
          profileName.textContent =
            profile?.name || user?.email?.split("@")[0] || "My Profile";
        }

        if (profileEmail) {
          profileEmail.textContent = user?.email || "Loading...";
        }

        if (profileAvatar) {
          if (profile?.name) {
            const initials = profile.name
              .split(" ")
              .map((n) => n[0])
              .join("")
              .toUpperCase();
            profileAvatar.innerHTML = initials;
          } else {
            profileAvatar.innerHTML = '<i class="fas fa-user"></i>';
          }
        }

        // Update stats
        await updateStats();

        // Initialize gamification and behavioral targeting
        updateGamification();
        updateBehavioralTargeting();

        // Also update mobile side panel
        updateMobileProfileDisplay(user, profile);
        await updateMobileStats();
      }

      // Update stats
      async function updateStats() {
        const ordersCount = document.getElementById("orders-count");
        const wishlistCount = document.getElementById("wishlist-count");
        const messagesCount = document.getElementById("messages-count");
        const reviewsCount = document.getElementById("reviews-count");

        if (ordersCount) {
          ordersCount.textContent = "0"; // Placeholder
        }

        if (wishlistCount) {
          const wishlist = JSON.parse(
            localStorage.getItem("wishlistItems") || "[]"
          );
          wishlistCount.textContent = wishlist.length;
        }

        if (messagesCount) {
          // Count messages from Supabase
          try {
            const { data: messages, error } = await supabase
              .from("messages")
              .select("id")
              .eq("receiver_id", currentUser.id);

            if (!error && messages) {
              messagesCount.textContent = messages.length;
            } else {
              messagesCount.textContent = "0";
            }
          } catch (error) {
            console.error("Error counting messages:", error);
            messagesCount.textContent = "0";
          }
        }

        if (reviewsCount) {
          reviewsCount.textContent = "0"; // Placeholder
        }
      }

      // Update mobile profile display
      function updateMobileProfileDisplay(user, profile) {
        const mobileProfileName = document.getElementById(
          "mobile-profile-name"
        );
        const mobileProfileEmail = document.getElementById(
          "mobile-profile-email"
        );
        const mobileProfileAvatar = document.getElementById(
          "mobile-profile-avatar"
        );

        if (mobileProfileName) {
          mobileProfileName.textContent =
            profile?.name || user?.email?.split("@")[0] || "My Profile";
        }

        if (mobileProfileEmail) {
          mobileProfileEmail.textContent = user?.email || "Loading...";
        }

        if (mobileProfileAvatar) {
          if (profile?.name) {
            const initials = profile.name
              .split(" ")
              .map((n) => n[0])
              .join("")
              .toUpperCase();
            mobileProfileAvatar.innerHTML = initials;
          } else {
            mobileProfileAvatar.innerHTML = '<i class="fas fa-user"></i>';
          }
        }
      }

      // Update mobile stats
      async function updateMobileStats() {
        const mobileOrdersCount = document.getElementById(
          "mobile-orders-count"
        );
        const mobileWishlistCount = document.getElementById(
          "mobile-wishlist-count"
        );
        const mobileMessagesCount = document.getElementById(
          "mobile-messages-count"
        );
        const mobileReviewsCount = document.getElementById(
          "mobile-reviews-count"
        );

        if (mobileOrdersCount) {
          mobileOrdersCount.textContent = "0"; // Placeholder
        }

        if (mobileWishlistCount) {
          const wishlist = JSON.parse(
            localStorage.getItem("wishlistItems") || "[]"
          );
          mobileWishlistCount.textContent = wishlist.length;
        }

        if (mobileMessagesCount) {
          // Use the same method as desktop - count messages from Supabase
          try {
            const { data: messages, error } = await supabase
              .from("messages")
              .select("id")
              .eq("receiver_id", currentUser.id);

            if (!error && messages) {
              mobileMessagesCount.textContent = messages.length;
            } else {
              mobileMessagesCount.textContent = "0";
            }
          } catch (error) {
            console.error("Error counting mobile messages:", error);
            mobileMessagesCount.textContent = "0";
          }
        }

        if (mobileReviewsCount) {
          mobileReviewsCount.textContent = "0"; // Placeholder
        }
      }

      // Mobile side panel functions with improved timing
      function toggleMobileSidePanel() {
        const panel = document.getElementById("mobile-side-panel");
        const overlay = document.querySelector(".mobile-side-panel-overlay");

        if (!panel || !overlay) {
          console.error("Mobile side panel elements not found");
          return;
        }

        if (panel.classList.contains("open")) {
          closeMobileSidePanel();
        } else {
          openMobileSidePanel();
        }
      }

      function openMobileSidePanel() {
        const panel = document.getElementById("mobile-side-panel");
        const overlay = document.querySelector(".mobile-side-panel-overlay");

        if (!panel || !overlay) {
          console.error("Mobile side panel elements not found");
          return;
        }

        // Ensure smooth animation
        requestAnimationFrame(() => {
          panel.classList.add("open");
          overlay.classList.add("open");
          document.body.style.overflow = "hidden";
        });
      }

      function closeMobileSidePanel() {
        const panel = document.getElementById("mobile-side-panel");
        const overlay = document.querySelector(".mobile-side-panel-overlay");

        if (!panel || !overlay) {
          console.error("Mobile side panel elements not found");
          return;
        }

        // Ensure smooth animation
        requestAnimationFrame(() => {
          panel.classList.remove("open");
          overlay.classList.remove("open");
          document.body.style.overflow = "";
        });
      }

      // Navbar scroll effect
      window.addEventListener("scroll", function () {
        const navbar = document.querySelector(".navbar");
        if (window.scrollY > 50) {
          navbar.classList.add("scrolled");
        } else {
          navbar.classList.remove("scrolled");
        }
      });

      // Initialize profile page
      document.addEventListener("DOMContentLoaded", function () {
        // Show profile tab by default
        showTab("profile");

        // Ensure mobile side panel is properly initialized
        const panel = document.getElementById("mobile-side-panel");
        const overlay = document.querySelector(".mobile-side-panel-overlay");

        if (panel && overlay) {
          // Reset any existing states
          panel.classList.remove("open");
          overlay.classList.remove("open");
          document.body.style.overflow = "";
        }

        // Add touch support for mobile
        if ("ontouchstart" in window) {
          let startX = 0;
          let currentX = 0;

          document.addEventListener("touchstart", function (e) {
            startX = e.touches[0].clientX;
          });

          document.addEventListener("touchmove", function (e) {
            currentX = e.touches[0].clientX;
          });

          document.addEventListener("touchend", function (e) {
            const diff = startX - currentX;
            const panel = document.getElementById("mobile-side-panel");

            // Swipe right to open panel (if closed)
            if (diff < -50 && panel && !panel.classList.contains("open")) {
              openMobileSidePanel();
            }
            // Swipe left to close panel (if open)
            else if (diff > 50 && panel && panel.classList.contains("open")) {
              closeMobileSidePanel();
            }
          });
        }
      });

      // Sidebar toggle for mobile
      document.addEventListener("DOMContentLoaded", function () {
        var sidebar = document.getElementById("profile-sidebar");
        var openBtn = document.getElementById("mobile-sidebar-toggle");
        var closeBtn = document.getElementById("close-sidebar-btn");
        function openSidebar() {
          sidebar.classList.add("open");
          document.body.style.overflow = "hidden";
        }
        function closeSidebar() {
          sidebar.classList.remove("open");
          document.body.style.overflow = "";
        }
        if (openBtn && sidebar) {
          openBtn.addEventListener("click", openSidebar);
        }
        if (closeBtn && sidebar) {
          closeBtn.addEventListener("click", closeSidebar);
        }
        // Hide sidebar by default on mobile
        if (window.innerWidth <= 900) {
          sidebar.classList.remove("open");
        }
        // Show/hide hamburger icon on resize
        function updateSidebarToggle() {
          if (window.innerWidth <= 900) {
            openBtn.style.display = "flex";
            closeBtn.style.display = "block";
            sidebar.classList.remove("open");
          } else {
            openBtn.style.display = "none";
            closeBtn.style.display = "none";
            sidebar.classList.remove("open");
          }
        }
        window.addEventListener("resize", updateSidebarToggle);
        updateSidebarToggle();
      });

      // Gamification System
      function updateGamification() {
        const points = 2450;
        const level = Math.floor(points / 500) + 1;
        const progress = (points % 500) / 500 * 100;
        
        const pointsElement = document.getElementById('user-points');
        const levelElement = document.getElementById('user-level');
        const progressElement = document.getElementById('level-progress');
        
        if (pointsElement) pointsElement.textContent = points.toLocaleString();
        if (levelElement) levelElement.textContent = getLevelName(level);
        if (progressElement) progressElement.style.width = `${progress}%`;
        
        // Update achievements based on user data
        updateAchievements();
      }

      function getLevelName(level) {
        const levelNames = {
          1: 'Rookie',
          2: 'Novice', 
          3: 'Gamer',
          4: 'Pro Gamer',
          5: 'Expert',
          6: 'Master',
          7: 'Pro Gamer',
          8: 'Elite',
          9: 'Legend',
          10: 'Champion'
        };
        return levelNames[level] || 'Pro Gamer';
      }

      function updateAchievements() {
        const orders = parseInt(document.getElementById('orders-count')?.textContent || '0');
        const spent = 847; // Simulated total spent
        
        // Unlock achievements based on user data
        if (orders >= 1) unlockAchievement('first-purchase');
        if (orders >= 5) unlockAchievement('hot-streak');
        if (spent >= 1000) unlockAchievement('big-spender');
      }

      function unlockAchievement(achievementId) {
        const achievement = document.querySelector(`[data-achievement="${achievementId}"]`);
        if (achievement) {
          achievement.classList.remove('locked');
          achievement.classList.add('unlocked');
        }
      }

      // Behavioral Targeting
      function updateBehavioralTargeting() {
        const userType = getUserType();
        const badge = document.getElementById('behavioral-badge');
        const recommendations = document.querySelector('.recommendations');
        
        if (badge) {
          badge.className = `user-type-badge user-type-${userType}`;
          badge.textContent = getUserTypeLabel(userType);
        }
        
        updateRecommendations(userType);
      }

      function getUserType() {
        // Simulate user behavior analysis
        const orders = parseInt(document.getElementById('orders-count')?.textContent || '0');
        const spent = 847; // Simulated total spent
        
        if (orders === 0) return 'new';
        if (spent > 1000) return 'vip';
        return 'returning';
      }

      function getUserTypeLabel(type) {
        const labels = {
          'new': 'New Gamer',
          'returning': 'Returning Gamer', 
          'vip': 'VIP Gamer'
        };
        return labels[type];
      }

      function updateRecommendations(userType) {
        const recommendations = document.querySelectorAll('.recommendation-item');
        
        // Clear existing recommendations
        recommendations.forEach(rec => rec.remove());
        
        const recContainer = document.querySelector('.recommendations');
        if (!recContainer) return;
        
        const newRecommendations = getRecommendationsForUserType(userType);
        
        newRecommendations.forEach(rec => {
          const recElement = document.createElement('div');
          recElement.className = 'recommendation-item';
          recElement.innerHTML = `
            <i class="${rec.icon} recommendation-icon"></i>
            <div>
              <strong>${rec.title}</strong>
              <p style="color: #ccc; font-size: 0.9rem;">${rec.description}</p>
            </div>
          `;
          recContainer.appendChild(recElement);
        });
      }

      function getRecommendationsForUserType(userType) {
        const recommendations = {
          'new': [
            { icon: 'fas fa-gamepad', title: 'Starter Gaming Kit', description: 'Perfect for new gamers' },
            { icon: 'fas fa-mobile-alt', title: 'Mobile Gaming Essentials', description: 'Everything you need to start' },
            { icon: 'fas fa-gift', title: 'Welcome Bundle', description: 'Special offer for new members' }
          ],
          'returning': [
            { icon: 'fas fa-mobile-alt', title: 'Mobile Gaming Setup', description: 'Based on your controller purchases' },
            { icon: 'fas fa-snowflake', title: 'Cooling Accessories', description: 'Perfect for long gaming sessions' },
            { icon: 'fas fa-headset', title: 'Audio Gear', description: 'Complete your gaming setup' }
          ],
          'vip': [
            { icon: 'fas fa-crown', title: 'VIP Exclusive Gear', description: 'Limited edition items' },
            { icon: 'fas fa-gem', title: 'Premium Accessories', description: 'High-end gaming equipment' },
            { icon: 'fas fa-star', title: 'Early Access', description: 'Be the first to get new products' }
          ]
        };
        
        return recommendations[userType] || recommendations['returning'];
      }

      // Notification System
      function showNotification(message) {
        // Create notification element
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 100px;
          right: 20px;
          background: linear-gradient(45deg, #ff6b6b, #ff8e53);
          color: white;
          padding: 15px 20px;
          border-radius: 10px;
          box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
          z-index: 10001;
          transform: translateX(400px);
          transition: transform 0.3s ease;
          max-width: 300px;
        `;
        notification.innerHTML = `<i class="fas fa-trophy"></i> ${message}`;
        
        document.body.appendChild(notification);
        
        // Show notification
        setTimeout(() => {
          notification.style.transform = 'translateX(0)';
        }, 100);
        
        // Hide notification
        setTimeout(() => {
          notification.style.transform = 'translateX(400px)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      // Simulate achievement unlock after 3 seconds
      setTimeout(() => {
        showNotification('Achievement Unlocked: Loyalty Master! ');
      }, 3000);

      // Exit Intent Detection
      let exitIntentShown = false;
      
      document.addEventListener('mouseleave', function(e) {
        if (e.clientY <= 0 && !exitIntentShown) {
          showExitIntent();
        }
      });

      function showExitIntent() {
        exitIntentShown = true;
        document.getElementById('exit-intent-popup').style.display = 'block';
        document.body.style.overflow = 'hidden';
      }

      function closeExitIntent() {
        document.getElementById('exit-intent-popup').style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      function applyDiscount() {
        // Simulate applying discount
        showNotification('Discount code GAMER15 applied! ');
        closeExitIntent();
        
        // Redirect to shop with discount
        setTimeout(() => {
          window.location.href = 'index.html?discount=GAMER15';
        }, 2000);
      }
    </script>
  

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-section">
          <h3> Mobile Gear Hub</h3>
          <p>
            Your ultimate destination for premium mobile gaming accessories and
            gear.
          </p>
          <div class="social-links">
            <a
              href="https://www.facebook.com/share/1EtKUXckLm/"
              target="_blank"
              class="social-link"
              ><i class="fab fa-facebook"></i
            ></a>
            <a
              href="https://www.tiktok.com/@mobilegear.hub?_t=ZM-8yVp0OzGZqH&_r=1"
              target="_blank"
              class="social-link"
              ><i class="fab fa-tiktok"></i
            ></a>
            <a
              href="https://www.instagram.com/mobile.gearhub?igsh=MXFyMWI1enlwMzBydQ=="
              target="_blank"
              class="social-link"
              ><i class="fab fa-instagram"></i
            ></a>
            <a
              href="https://youtube.com/@mobilegearhub?si=fWzMZvcXYKcIGo0q"
              target="_blank"
              class="social-link"
              ><i class="fab fa-youtube"></i
            ></a>
          </div>
        </div>

        <div class="footer-section">
          <h4>Contact Us</h4>
          <div class="contact-info">
            <a href="mailto:mobilegearstore06@gmail.com" class="email-link">
              <i class="fas fa-envelope"></i> mobilegearstore06@gmail.com
            </a>
          </div>
          <div class="contact-info" style="margin-top: 15px">
            <p style="color: #ccc; font-size: 0.9rem; margin: 0">
              <i
                class="fas fa-clock"
                style="color: #25d366; margin-right: 8px"
              ></i>
              Support Hours: Mon-Fri 9AM-6PM
            </p>
          </div>
        </div>

        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul class="footer-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="profile.html">My Account</a></li>
            <li><a href="#about">About Us</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <div class="footer-bottom-content">
          <p>&copy; 2024 Mobile Gear Hub. All rights reserved.</p>
          <div class="payment-methods">
            <i class="fab fa-cc-visa"></i>
            <i class="fab fa-cc-mastercard"></i>
            <i class="fab fa-cc-paypal"></i>
            <i class="fab fa-bitcoin"></i>
          </div>
        </div>
      </div>
    </footer>

    <!-- Flash Sale Teaser -->
    <div id="flash-sales-teaser"></div>
    <!-- Site Banner System -->
    <script src="components/site-banner.js"></script>
  </body>
</html>
